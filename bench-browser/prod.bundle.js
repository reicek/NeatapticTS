"use strict";(()=>{var Jo=Object.create;var fe=Object.defineProperty;var Vo=Object.getOwnPropertyDescriptor;var Ko=Object.getOwnPropertyNames;var Xo=Object.getPrototypeOf,Yo=Object.prototype.hasOwnProperty;var Zo=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var Y=(n,t)=>()=>(n&&(t=n(n=0)),t);var Qt=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),vt=(n,t)=>{for(var e in t)fe(n,e,{get:t[e],enumerable:!0})},An=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ko(t))!Yo.call(n,o)&&o!==e&&fe(n,o,{get:()=>t[o],enumerable:!(i=Vo(t,o))||i.enumerable});return n};var Qo=(n,t,e)=>(e=n!=null?Jo(Xo(n)):{},An(t||!n||!n.__esModule?fe(e,"default",{value:n,enumerable:!0}):e,n)),ct=n=>An(fe({},"__esModule",{value:!0}),n);var Wt,te,Ot,Bt=Y(()=>{"use strict";Wt=Symbol("connGain"),te=class n{constructor(t,e,i){this.from=t,this.to=e,this.weight=i??Math.random()*.2-.1,this.gater=null,this.eligibility=0,this.previousDeltaWeight=0,this.totalDeltaWeight=0,this.xtrace={nodes:[],values:[]},this._flags=3,this.innovation=n._nextInnovation++}toJSON(){var t,e;let i={from:(t=this.from.index)!==null&&t!==void 0?t:void 0,to:(e=this.to.index)!==null&&e!==void 0?e:void 0,weight:this.weight,gain:this.gain,innovation:this.innovation,enabled:this.enabled};return this.gater&&typeof this.gater.index<"u"&&(i.gater=this.gater.index),i}static innovationID(t,e){return .5*(t+e)*(t+e+1)+e}static resetInnovationCounter(t=1){n._nextInnovation=t}static acquire(t,e,i){let o;return n._pool.length?(o=n._pool.pop(),o.from=t,o.to=e,o.weight=i??Math.random()*.2-.1,o[Wt]!==void 0&&delete o[Wt],o.gater=null,o.eligibility=0,o.previousDeltaWeight=0,o.totalDeltaWeight=0,o.xtrace.nodes.length=0,o.xtrace.values.length=0,o._flags=3,o.lookaheadShadowWeight=void 0,o.innovation=n._nextInnovation++):o=new n(t,e,i),o}static release(t){n._pool.push(t)}get enabled(){return(this._flags&1)!==0}set enabled(t){this._flags=t?this._flags|1:this._flags&-2}get dcMask(){return this._flags&2?1:0}set dcMask(t){this._flags=t?this._flags|2:this._flags&-3}get gain(){return this[Wt]===void 0?1:this[Wt]}set gain(t){t===1?this[Wt]!==void 0&&delete this[Wt]:this[Wt]=t}get opt_m(){return this.firstMoment}set opt_m(t){this.firstMoment=t}get opt_v(){return this.secondMoment}set opt_v(t){this.secondMoment=t}get opt_cache(){return this.gradientAccumulator}set opt_cache(t){this.gradientAccumulator=t}get opt_vhat(){return this.maxSecondMoment}set opt_vhat(t){this.maxSecondMoment=t}get opt_u(){return this.infinityNorm}set opt_u(t){this.infinityNorm=t}get opt_m2(){return this.secondMomentum}set opt_m2(t){this.secondMomentum=t}get _la_shadowWeight(){return this.lookaheadShadowWeight}set _la_shadowWeight(t){this.lookaheadShadowWeight=t}get dropConnectActiveMask(){return this.dcMask}set dropConnectActiveMask(t){this.dcMask=t}};te._nextInnovation=1;te._pool=[];Ot=te});var at,Dt=Y(()=>{"use strict";at={warnings:!1,float32Mode:!1,deterministicChainMode:!1,enableGatingTraces:!0}});var We={};vt(We,{EPSILON:()=>jt,EXTRA_CONNECTION_PROBABILITY:()=>Re,NORM_EPSILON:()=>es,PROB_EPSILON:()=>Gt});var jt,Gt,es,Re,Ft=Y(()=>{"use strict";jt=1e-9,Gt=1e-15,es=1e-5,Re=.5});var Et,On=Y(()=>{"use strict";Ft();Et=class{static crossEntropy(t,e){let i=0,o=1e-15;if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");for(let s=0;s<e.length;s++){let r=t[s],a=e[s],c=Math.max(o,Math.min(1-o,a));r===1?i-=Math.log(c):r===0?i-=Math.log(1-c):i-=r*Math.log(c)+(1-r)*Math.log(1-c)}return i/e.length}static softmaxCrossEntropy(t,e){if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");let i=e.length,o=0;for(let d of t)o+=d;let s=o>0?t.map(d=>d/o):t.slice(),r=Math.max(...e),a=e.map(d=>Math.exp(d-r)),c=a.reduce((d,f)=>d+f,0)||1,l=a.map(d=>d/c),u=0,h=1e-15;for(let d=0;d<i;d++){let f=Math.min(1-h,Math.max(h,l[d])),m=s[d];u-=m*Math.log(f)}return u}static mse(t,e){if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");let i=0;return e.forEach((o,s)=>{i+=Math.pow(t[s]-o,2)}),i/e.length}static binary(t,e){if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");let i=0;return e.forEach((o,s)=>{i+=Math.round(t[s])!==Math.round(o)?1:0}),i/e.length}static mae(t,e){if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");let i=0;return e.forEach((o,s)=>{i+=Math.abs(t[s]-o)}),i/e.length}static mape(t,e){if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");let i=0,o=1e-15;return e.forEach((s,r)=>{let a=t[r];i+=Math.abs((a-s)/Math.max(Math.abs(a),o))}),i/e.length}static msle(t,e){if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");let i=0;return e.forEach((o,s)=>{let r=t[s],a=Math.log(Math.max(r,0)+1),c=Math.log(Math.max(o,0)+1);i+=Math.pow(a-c,2)}),i/e.length}static hinge(t,e){if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");let i=0;return e.forEach((o,s)=>{let r=t[s];i+=Math.max(0,1-r*o)}),i/e.length}static focalLoss(t,e,i=2,o=.25){let s=0,r=1e-15;if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");for(let a=0;a<e.length;a++){let c=t[a],l=Math.max(r,Math.min(1-r,e[a])),u=c===1?l:1-l,h=c===1?o:1-o;s+=-h*Math.pow(1-u,i)*Math.log(u)}return s/e.length}static labelSmoothing(t,e,i=.1){let o=0,s=1e-15;if(t.length!==e.length)throw new Error("Target and output arrays must have the same length.");for(let r=0;r<e.length;r++){let a=t[r]*(1-i)+.5*i,c=Math.max(s,Math.min(1-s,e[r]));o-=a*Math.log(c)+(1-a)*Math.log(1-c)}return o/e.length}}});var ee,En=Y(()=>{"use strict";ee=class{static fixed(){return(e,i)=>e}static step(t=.9,e=100){return(o,s)=>Math.max(0,o*Math.pow(t,Math.floor(s/e)))}static exp(t=.999){return(i,o)=>i*Math.pow(t,o)}static inv(t=.001,e=2){return(o,s)=>o/(1+t*Math.pow(s,e))}static cosineAnnealing(t=1e3,e=0){return(o,s)=>{let r=s%t,a=.5*(1+Math.cos(r/t*Math.PI));return e+(o-e)*a}}static cosineAnnealingWarmRestarts(t=1e3,e=0,i=1){let o=t,s=0,r=o;return(a,c)=>{for(;c>=r;)s=r,o=Math.max(1,Math.round(o*i)),r=s+o;let l=c-s,u=.5*(1+Math.cos(l/o*Math.PI));return e+(a-e)*u}}static linearWarmupDecay(t,e,i=0){if(t<=0)throw new Error("totalSteps must be > 0");let o=Math.min(e??Math.max(1,Math.floor(t*.1)),t-1);return(s,r)=>{if(r<=o)return s*(r/Math.max(1,o));if(r>=t)return i;let a=t-o,c=(r-o)/a;return i+(s-i)*(1-c)}}static reduceOnPlateau(t){let{factor:e=.5,patience:i=10,minDelta:o=1e-4,cooldown:s=0,minRate:r=0,verbose:a=!1}=t||{},c,l,u=0,h=-1;return(d,f,m)=>{if(c===void 0&&(c=d),m!==void 0){if(l===void 0||m<l-o)l=m,u=f;else if(f-u>=i&&f>=h){let g=Math.max(r,c*e);g<c&&(c=g,h=f+s,u=f)}}return c}}}});var ns,st,Be=Y(()=>{"use strict";ns={logistic:(n,t=!1)=>{let e=1/(1+Math.exp(-n));return t?e*(1-e):e},sigmoid:(n,t=!1)=>{let e=1/(1+Math.exp(-n));return t?e*(1-e):e},tanh:(n,t=!1)=>t?1-Math.pow(Math.tanh(n),2):Math.tanh(n),identity:(n,t=!1)=>t?1:n,step:(n,t=!1)=>t?0:n>0?1:0,relu:(n,t=!1)=>t?n>0?1:0:n>0?n:0,softsign:(n,t=!1)=>{let e=1+Math.abs(n);return t?1/Math.pow(e,2):n/e},sinusoid:(n,t=!1)=>t?Math.cos(n):Math.sin(n),gaussian:(n,t=!1)=>{let e=Math.exp(-Math.pow(n,2));return t?-2*n*e:e},bentIdentity:(n,t=!1)=>{let e=Math.sqrt(Math.pow(n,2)+1);return t?n/(2*e)+1:(e-1)/2+n},bipolar:(n,t=!1)=>t?0:n>0?1:-1,bipolarSigmoid:(n,t=!1)=>{let e=2/(1+Math.exp(-n))-1;return t?.5*(1+e)*(1-e):e},hardTanh:(n,t=!1)=>t?n>-1&&n<1?1:0:Math.max(-1,Math.min(1,n)),absolute:(n,t=!1)=>t?n<0?-1:1:Math.abs(n),inverse:(n,t=!1)=>t?-1:1-n,selu:(n,t=!1)=>{let e=1.6732632423543772,i=1.0507009873554805,o=n>0?n:e*Math.exp(n)-e;return t?n>0?i:(o+e)*i:o*i},softplus:(n,t=!1)=>{let e=1/(1+Math.exp(-n));return t?e:n>30?n:n<-30?Math.exp(n):Math.max(0,n)+Math.log(1+Math.exp(-Math.abs(n)))},swish:(n,t=!1)=>{let e=1/(1+Math.exp(-n));if(t){let i=n*e;return i+e*(1-i)}else return n*e},gelu:(n,t=!1)=>{let e=.5*(1+Math.tanh(Math.sqrt(2/Math.PI)*(n+.044715*Math.pow(n,3))));if(t){let i=Math.sqrt(2/Math.PI)*(1+.134145*n*n),o=Math.sqrt(2/Math.PI)*(n+.044715*Math.pow(n,3)),s=1/Math.cosh(o),r=s*s;return e+n*.5*i*r}else return n*e},mish:(n,t=!1)=>{let e;n>30?e=n:n<-30?e=Math.exp(n):e=Math.max(0,n)+Math.log(1+Math.exp(-Math.abs(n)));let i=Math.tanh(e);if(t){let o=1/(1+Math.exp(-n)),s=1/Math.cosh(e),r=s*s;return i+n*r*o}else return n*i}},st=ns});var St,Cn=Y(()=>{"use strict";St={OUTPUT:{name:"OUTPUT"},INPUT:{name:"INPUT"},SELF:{name:"SELF"}}});var it,zt,me=Y(()=>{"use strict";Be();it={ADD_NODE:{name:"ADD_NODE"},SUB_NODE:{name:"SUB_NODE",keep_gates:!0},ADD_CONN:{name:"ADD_CONN"},SUB_CONN:{name:"SUB_CONN"},MOD_WEIGHT:{name:"MOD_WEIGHT",min:-1,max:1},MOD_BIAS:{name:"MOD_BIAS",min:-1,max:1},MOD_ACTIVATION:{name:"MOD_ACTIVATION",mutateOutput:!0,allowed:[st.logistic,st.tanh,st.relu,st.identity,st.step,st.softsign,st.sinusoid,st.gaussian,st.bentIdentity,st.bipolar,st.bipolarSigmoid,st.hardTanh,st.absolute,st.inverse,st.selu,st.softplus,st.swish,st.gelu,st.mish]},ADD_SELF_CONN:{name:"ADD_SELF_CONN"},SUB_SELF_CONN:{name:"SUB_SELF_CONN"},ADD_GATE:{name:"ADD_GATE"},SUB_GATE:{name:"SUB_GATE"},ADD_BACK_CONN:{name:"ADD_BACK_CONN"},SUB_BACK_CONN:{name:"SUB_BACK_CONN"},SWAP_NODES:{name:"SWAP_NODES",mutateOutput:!0},REINIT_WEIGHT:{name:"REINIT_WEIGHT",min:-1,max:1},BATCH_NORM:{name:"BATCH_NORM"},ADD_LSTM_NODE:{name:"ADD_LSTM_NODE"},ADD_GRU_NODE:{name:"ADD_GRU_NODE"},ALL:[],FFW:[]};it.ALL=[it.ADD_NODE,it.SUB_NODE,it.ADD_CONN,it.SUB_CONN,it.MOD_WEIGHT,it.MOD_BIAS,it.MOD_ACTIVATION,it.ADD_GATE,it.SUB_GATE,it.ADD_SELF_CONN,it.SUB_SELF_CONN,it.ADD_BACK_CONN,it.SUB_BACK_CONN,it.SWAP_NODES,it.REINIT_WEIGHT,it.BATCH_NORM,it.ADD_LSTM_NODE,it.ADD_GRU_NODE];it.FFW=[it.ADD_NODE,it.SUB_NODE,it.ADD_CONN,it.SUB_CONN,it.MOD_WEIGHT,it.MOD_BIAS,it.MOD_ACTIVATION,it.SWAP_NODES,it.REINIT_WEIGHT,it.BATCH_NORM];zt=it});var Lt,Ge=Y(()=>{"use strict";Lt={FITNESS_PROPORTIONATE:{name:"FITNESS_PROPORTIONATE"},POWER:{name:"POWER",power:4},TOURNAMENT:{name:"TOURNAMENT",size:5,probability:.5}}});var ne,In=Y(()=>{"use strict";ne={SINGLE_POINT:{name:"SINGLE_POINT",config:[.4]},TWO_POINT:{name:"TWO_POINT",config:[.4,.9]},UNIFORM:{name:"UNIFORM"},AVERAGE:{name:"AVERAGE"}}});var is,ut,Tn=Y(()=>{"use strict";is=Object.freeze({ALL_TO_ALL:Object.freeze({name:"ALL_TO_ALL"}),ALL_TO_ELSE:Object.freeze({name:"ALL_TO_ELSE"}),ONE_TO_ONE:Object.freeze({name:"ONE_TO_ONE"})}),ut=is});var wt={};vt(wt,{Activation:()=>st,Cost:()=>Et,Rate:()=>ee,crossover:()=>ne,gating:()=>St,groupConnection:()=>ut,mutation:()=>it,selection:()=>Lt});var Mt=Y(()=>{"use strict";On();En();Be();Cn();me();Ge();In();Tn()});var ge={};vt(ge,{default:()=>pt});var ie,pt,Nt=Y(()=>{"use strict";Bt();Dt();Mt();ie=class n{constructor(t="hidden",e,i=Math.random){this.bias=t==="input"?0:i()*.2-.1,this.squash=e||st.logistic||(o=>o),this.type=t,this.activation=0,this.state=0,this.old=0,this.mask=1,this.previousDeltaBias=0,this.totalDeltaBias=0,this.connections={in:[],out:[],gated:[],self:[]},this.error={responsibility:0,projected:0,gated:0},typeof this.index>"u"&&(this.index=n._globalNodeIndex++),this.geneId=n._nextGeneId++}setActivation(t){this.squash=t}activate(t){return this._activateCore(!0,t)}noTraceActivate(t){return this._activateCore(!1,t)}_activateCore(t,e){if(this.mask===0)return this.activation=0,0;if(typeof e<"u"){if(this.type==="input")return this.activation=e,this.activation;this.state=e,this.activation=this.squash(this.state)*this.mask,this.derivative=this.squash(this.state,!0);for(let o of this.connections.gated)o.gain=this.activation;if(t)for(let o of this.connections.in)o.eligibility=o.from.activation;return this.activation}this.old=this.state;let i=this.bias;if(this.connections.self.length)for(let o of this.connections.self)o.dcMask!==0&&(i+=o.gain*o.weight*this.old);if(this.connections.in.length)for(let o of this.connections.in)o.dcMask===0||o.enabled===!1||(i+=o.from.activation*o.weight*o.gain);if(this.state=i,typeof this.squash!="function"&&(at.warnings&&console.warn("Invalid activation function; using identity."),this.squash=st.identity),typeof this.mask!="number"&&(this.mask=1),this.activation=this.squash(this.state)*this.mask,this.derivative=this.squash(this.state,!0),this.connections.gated.length)for(let o of this.connections.gated)o.gain=this.activation;if(t)for(let o of this.connections.in)o.eligibility=o.from.activation;return this.activation}get gates(){return at.warnings&&console.warn("Node.gates is deprecated; use node.connections.gated"),this.connections.gated}set gates(t){this.connections.gated=t||[]}get nodes(){return[]}set nodes(t){}propagate(t,e,i,o=0,s){if(i&&e>0){for(let c of this.connections.in)c.weight+=e*c.previousDeltaWeight,c.eligibility+=1e-12;this.bias+=e*this.previousDeltaBias}let r=0;if(this.type==="output")this.error.responsibility=this.error.projected=s-this.activation;else{for(let c of this.connections.out)r+=c.to.error.responsibility*c.weight*c.gain;this.error.projected=this.derivative*r,r=0;for(let c of this.connections.gated){let l=c.to,u=l.connections.self.reduce((h,d)=>h+(d.gater===this?l.old:0),0);u+=c.weight*c.from.activation,r+=l.error.responsibility*u}this.error.gated=this.derivative*r,this.error.responsibility=this.error.projected+this.error.gated}if(this.type==="constant")return;for(let c of this.connections.in){if(c.dcMask===0){c.totalDeltaWeight+=0;continue}let l=this.error.projected*c.eligibility;for(let d=0;d<c.xtrace.nodes.length;d++){let f=c.xtrace.nodes[d],m=c.xtrace.values[d];l+=f.error.responsibility*m}let u=0;typeof o=="function"?u=o(c.weight):typeof o=="object"&&o!==null?o.type==="L1"?u=o.lambda*Math.sign(c.weight):o.type==="L2"&&(u=o.lambda*c.weight):u=o*c.weight;let h=t*(l*this.mask-u);if(Number.isFinite(h)?Math.abs(h)>1e3&&(h=Math.sign(h)*1e3):(console.warn("deltaWeight is not finite, clamping to 0",{node:this.index,connection:c,deltaWeight:h}),h=0),c.totalDeltaWeight+=h,Number.isFinite(c.totalDeltaWeight)||(console.warn("totalDeltaWeight became NaN/Infinity, resetting to 0",{node:this.index,connection:c}),c.totalDeltaWeight=0),i){let d=c.totalDeltaWeight+e*c.previousDeltaWeight;Number.isFinite(d)?Math.abs(d)>1e3&&(d=Math.sign(d)*1e3):(console.warn("currentDeltaWeight is not finite, clamping to 0",{node:this.index,connection:c,currentDeltaWeight:d}),d=0),e>0&&(c.weight-=e*c.previousDeltaWeight),c.weight+=d,Number.isFinite(c.weight)?Math.abs(c.weight)>1e6&&(c.weight=Math.sign(c.weight)*1e6):(console.warn(`Weight update produced invalid value: ${c.weight}. Resetting to 0.`,{node:this.index,connection:c}),c.weight=0),c.previousDeltaWeight=d,c.totalDeltaWeight=0}}for(let c of this.connections.self){if(c.dcMask===0){c.totalDeltaWeight+=0;continue}let l=this.error.projected*c.eligibility;for(let d=0;d<c.xtrace.nodes.length;d++){let f=c.xtrace.nodes[d],m=c.xtrace.values[d];l+=f.error.responsibility*m}let u=0;typeof o=="function"?u=o(c.weight):typeof o=="object"&&o!==null?o.type==="L1"?u=o.lambda*Math.sign(c.weight):o.type==="L2"&&(u=o.lambda*c.weight):u=o*c.weight;let h=t*(l*this.mask-u);if(Number.isFinite(h)?Math.abs(h)>1e3&&(h=Math.sign(h)*1e3):(console.warn("self deltaWeight is not finite, clamping to 0",{node:this.index,connection:c,deltaWeight:h}),h=0),c.totalDeltaWeight+=h,Number.isFinite(c.totalDeltaWeight)||(console.warn("self totalDeltaWeight became NaN/Infinity, resetting to 0",{node:this.index,connection:c}),c.totalDeltaWeight=0),i){let d=c.totalDeltaWeight+e*c.previousDeltaWeight;Number.isFinite(d)?Math.abs(d)>1e3&&(d=Math.sign(d)*1e3):(console.warn("self currentDeltaWeight is not finite, clamping to 0",{node:this.index,connection:c,currentDeltaWeight:d}),d=0),e>0&&(c.weight-=e*c.previousDeltaWeight),c.weight+=d,Number.isFinite(c.weight)?Math.abs(c.weight)>1e6&&(c.weight=Math.sign(c.weight)*1e6):(console.warn("self weight update produced invalid value, resetting to 0",{node:this.index,connection:c}),c.weight=0),c.previousDeltaWeight=d,c.totalDeltaWeight=0}}let a=t*this.error.responsibility;if(Number.isFinite(a)?Math.abs(a)>1e3&&(a=Math.sign(a)*1e3):(console.warn("deltaBias is not finite, clamping to 0",{node:this.index,deltaBias:a}),a=0),this.totalDeltaBias+=a,Number.isFinite(this.totalDeltaBias)||(console.warn("totalDeltaBias became NaN/Infinity, resetting to 0",{node:this.index}),this.totalDeltaBias=0),i){let c=this.totalDeltaBias+e*this.previousDeltaBias;Number.isFinite(c)?Math.abs(c)>1e3&&(c=Math.sign(c)*1e3):(console.warn("currentDeltaBias is not finite, clamping to 0",{node:this.index,currentDeltaBias:c}),c=0),e>0&&(this.bias-=e*this.previousDeltaBias),this.bias+=c,Number.isFinite(this.bias)?Math.abs(this.bias)>1e6&&(this.bias=Math.sign(this.bias)*1e6):(console.warn("bias update produced invalid value, resetting to 0",{node:this.index}),this.bias=0),this.previousDeltaBias=c,this.totalDeltaBias=0}}toJSON(){return{index:this.index,bias:this.bias,type:this.type,squash:this.squash?this.squash.name:null,mask:this.mask}}static fromJSON(t){let e=new n(t.type);if(e.bias=t.bias,e.mask=t.mask,t.squash){let i=st[t.squash];typeof i=="function"?e.squash=i:(console.warn(`fromJSON: Unknown or invalid squash function '${t.squash}' for node. Using identity.`),e.squash=st.identity)}return e}isConnectedTo(t){return this.connections.out.some(e=>e.to===t)}mutate(t){var e,i,o,s;if(!t)throw new Error("Mutation method cannot be null or undefined.");if(!(t.name in it))throw new Error(`Unknown mutation method: ${t.name}`);switch(t){case it.MOD_ACTIVATION:if(!t.allowed||t.allowed.length===0){console.warn("MOD_ACTIVATION mutation called without allowed functions specified.");return}let r=t.allowed,a=r.indexOf(this.squash),c=a;r.length>1&&(c=(a+Math.floor(Math.random()*(r.length-1))+1)%r.length),this.squash=r[c];break;case it.MOD_BIAS:let l=(e=t.min)!==null&&e!==void 0?e:-1,u=(i=t.max)!==null&&i!==void 0?i:1,h=Math.random()*(u-l)+l;this.bias+=h;break;case it.REINIT_WEIGHT:let d=(o=t.min)!==null&&o!==void 0?o:-1,f=(s=t.max)!==null&&s!==void 0?s:1;for(let m of this.connections.in)m.weight=Math.random()*(f-d)+d;for(let m of this.connections.out)m.weight=Math.random()*(f-d)+d;for(let m of this.connections.self)m.weight=Math.random()*(f-d)+d;break;case it.BATCH_NORM:this.batchNorm=!0;break;default:throw new Error(`Unsupported mutation method: ${t.name}`)}}connect(t,e){let i=[];if(!t)throw new Error("Cannot connect to an undefined target.");if("bias"in t){let o=t;if(o===this){if(this.connections.self.length===0){let s=Ot.acquire(this,this,e??1);this.connections.self.push(s),i.push(s)}}else{let s=Ot.acquire(this,o,e);o.connections.in.push(s),this.connections.out.push(s),i.push(s)}}else if("nodes"in t&&Array.isArray(t.nodes))for(let o of t.nodes){let s=Ot.acquire(this,o,e);o.connections.in.push(s),this.connections.out.push(s),i.push(s)}else throw new Error("Invalid target type for connection. Must be a Node or a group { nodes: Node[] }.");return i}disconnect(t,e=!1){if(this===t){this.connections.self=[];return}this.connections.out=this.connections.out.filter(i=>i.to===t?(t.connections.in=t.connections.in.filter(o=>o!==i),i.gater&&i.gater.ungate(i),!1):!0),e&&t.disconnect(this,!1)}gate(t){Array.isArray(t)||(t=[t]);for(let e of t){if(!e||!e.from||!e.to){console.warn("Attempted to gate an invalid or incomplete connection.");continue}if(e.gater===this){console.warn("Node is already gating this connection.");continue}if(e.gater!==null){console.warn("Connection is already gated by another node. Ungate first.");continue}this.connections.gated.push(e),e.gater=this}}ungate(t){Array.isArray(t)||(t=[t]);for(let e of t){if(!e)continue;let i=this.connections.gated.indexOf(e);i!==-1&&(this.connections.gated.splice(i,1),e.gater=null,e.gain=1)}}clear(){for(let t of this.connections.in)t.eligibility=0,t.xtrace={nodes:[],values:[]};for(let t of this.connections.self)t.eligibility=0,t.xtrace={nodes:[],values:[]};for(let t of this.connections.gated)t.gain=0;this.error={responsibility:0,projected:0,gated:0},this.old=this.state=this.activation=0}isProjectingTo(t){return t===this&&this.connections.self.length>0?!0:this.connections.out.some(e=>e.to===t)}isProjectedBy(t){return t===this&&this.connections.self.length>0?!0:this.connections.in.some(e=>e.from===t)}applyBatchUpdates(t){return this.applyBatchUpdatesWithOptimizer({type:"sgd",momentum:t})}applyBatchUpdatesWithOptimizer(t){var e,i,o,s,r,a,c,l,u,h,d,f,m;let g=t.type||"sgd",w=g==="lookahead"?t.baseType||"sgd":g,M=(e=t.momentum)!==null&&e!==void 0?e:0,_=(i=t.beta1)!==null&&i!==void 0?i:.9,v=(o=t.beta2)!==null&&o!==void 0?o:.999,b=(s=t.eps)!==null&&s!==void 0?s:1e-8,A=(r=t.weightDecay)!==null&&r!==void 0?r:0,p=(a=t.lrScale)!==null&&a!==void 0?a:1,S=Math.max(1,Math.floor((c=t.t)!==null&&c!==void 0?c:1));g==="lookahead"&&(this._la_k=this._la_k||t.la_k||5,this._la_alpha=this._la_alpha||t.la_alpha||.5,this._la_step=(this._la_step||0)+1,this._la_shadowBias||(this._la_shadowBias=this.bias));let x=y=>{var N,k,L,I,E,T,P,R,$,W,K,B,Z,G,tt,F;let C=y.totalDeltaWeight||0;switch(Number.isFinite(C)||(C=0),w){case"rmsprop":{y.gradientAccumulator=((N=y.gradientAccumulator)!==null&&N!==void 0?N:0)*.9+.1*(C*C);let j=C/(Math.sqrt(y.gradientAccumulator)+b);this._safeUpdateWeight(y,j*p);break}case"adagrad":{y.gradientAccumulator=((k=y.gradientAccumulator)!==null&&k!==void 0?k:0)+C*C;let j=C/(Math.sqrt(y.gradientAccumulator)+b);this._safeUpdateWeight(y,j*p);break}case"adam":case"adamw":case"amsgrad":{y.firstMoment=((L=y.firstMoment)!==null&&L!==void 0?L:0)*_+(1-_)*C,y.secondMoment=((I=y.secondMoment)!==null&&I!==void 0?I:0)*v+(1-v)*(C*C),w==="amsgrad"&&(y.maxSecondMoment=Math.max((E=y.maxSecondMoment)!==null&&E!==void 0?E:0,(T=y.secondMoment)!==null&&T!==void 0?T:0));let j=w==="amsgrad"?y.maxSecondMoment:y.secondMoment,V=y.firstMoment/(1-Math.pow(_,S)),O=j/(1-Math.pow(v,S)),q=V/(Math.sqrt(O)+b)*p;w==="adamw"&&A!==0&&(q-=A*(y.weight||0)),this._safeUpdateWeight(y,q);break}case"adamax":{y.firstMoment=((P=y.firstMoment)!==null&&P!==void 0?P:0)*_+(1-_)*C,y.infinityNorm=Math.max(((R=y.infinityNorm)!==null&&R!==void 0?R:0)*v,Math.abs(C));let V=y.firstMoment/(1-Math.pow(_,S))/(y.infinityNorm||1e-12)*p;this._safeUpdateWeight(y,V);break}case"nadam":{y.firstMoment=(($=y.firstMoment)!==null&&$!==void 0?$:0)*_+(1-_)*C,y.secondMoment=((W=y.secondMoment)!==null&&W!==void 0?W:0)*v+(1-v)*(C*C);let j=y.firstMoment/(1-Math.pow(_,S)),V=y.secondMoment/(1-Math.pow(v,S)),O=j*_+(1-_)*C/(1-Math.pow(_,S));this._safeUpdateWeight(y,O/(Math.sqrt(V)+b)*p);break}case"radam":{y.firstMoment=((K=y.firstMoment)!==null&&K!==void 0?K:0)*_+(1-_)*C,y.secondMoment=((B=y.secondMoment)!==null&&B!==void 0?B:0)*v+(1-v)*(C*C);let j=y.firstMoment/(1-Math.pow(_,S)),V=y.secondMoment/(1-Math.pow(v,S)),O=2/(1-v)-1,q=O-2*S*Math.pow(v,S)/(1-Math.pow(v,S));if(q>4){let et=Math.sqrt((q-4)*(q-2)*O/((O-4)*(O-2)*q));this._safeUpdateWeight(y,et*j/(Math.sqrt(V)+b)*p)}else this._safeUpdateWeight(y,j*p);break}case"lion":{y.firstMoment=((Z=y.firstMoment)!==null&&Z!==void 0?Z:0)*_+(1-_)*C,y.secondMomentum=((G=y.secondMomentum)!==null&&G!==void 0?G:0)*v+(1-v)*C;let j=Math.sign((y.firstMoment||0)+(y.secondMomentum||0));this._safeUpdateWeight(y,-j*p);break}case"adabelief":{y.firstMoment=((tt=y.firstMoment)!==null&&tt!==void 0?tt:0)*_+(1-_)*C;let j=C-y.firstMoment;y.secondMoment=((F=y.secondMoment)!==null&&F!==void 0?F:0)*v+(1-v)*(j*j);let V=y.firstMoment/(1-Math.pow(_,S)),O=y.secondMoment/(1-Math.pow(v,S));this._safeUpdateWeight(y,V/(Math.sqrt(O)+b+1e-12)*p);break}default:{let j=C+M*(y.previousDeltaWeight||0);Number.isFinite(j)||(j=0),Math.abs(j)>1e3&&(j=Math.sign(j)*1e3),this._safeUpdateWeight(y,j*p),y.previousDeltaWeight=j}}w==="adamw"&&A!==0&&this._safeUpdateWeight(y,-A*(y.weight||0)*p),y.totalDeltaWeight=0};for(let y of this.connections.in)x(y);for(let y of this.connections.self)x(y);if(this.type!=="input"&&this.type!=="constant"){let y=this.totalDeltaBias||0;if(Number.isFinite(y)||(y=0),["adam","adamw","amsgrad","adamax","nadam","radam","lion","adabelief"].includes(w)){this.opt_mB=((l=this.opt_mB)!==null&&l!==void 0?l:0)*_+(1-_)*y,w==="lion"&&(this.opt_mB2=((u=this.opt_mB2)!==null&&u!==void 0?u:0)*v+(1-v)*y),this.opt_vB=((h=this.opt_vB)!==null&&h!==void 0?h:0)*v+(1-v)*(w==="adabelief"?Math.pow(y-this.opt_mB,2):y*y),w==="amsgrad"&&(this.opt_vhatB=Math.max((d=this.opt_vhatB)!==null&&d!==void 0?d:0,(f=this.opt_vB)!==null&&f!==void 0?f:0));let N=w==="amsgrad"?this.opt_vhatB:this.opt_vB,k=this.opt_mB/(1-Math.pow(_,S)),L=N/(1-Math.pow(v,S)),I;if(w==="adamax")this.opt_uB=Math.max(((m=this.opt_uB)!==null&&m!==void 0?m:0)*v,Math.abs(y)),I=k/(this.opt_uB||1e-12)*p;else if(w==="nadam")I=(k*_+(1-_)*y/(1-Math.pow(_,S)))/(Math.sqrt(L)+b)*p;else if(w==="radam"){let T=2/(1-v)-1,P=T-2*S*Math.pow(v,S)/(1-Math.pow(v,S));P>4?I=Math.sqrt((P-4)*(P-2)*T/((T-4)*(T-2)*P))*k/(Math.sqrt(L)+b)*p:I=k*p}else w==="lion"?I=-Math.sign(this.opt_mB+this.opt_mB2)*p:w==="adabelief"?I=k/(Math.sqrt(L)+b+1e-12)*p:I=k/(Math.sqrt(L)+b)*p;w==="adamw"&&A!==0&&(I-=A*(this.bias||0)*p);let E=this.bias+I;Number.isFinite(E)||(E=0),Math.abs(E)>1e6&&(E=Math.sign(E)*1e6),this.bias=E}else{let N=y+M*(this.previousDeltaBias||0);Number.isFinite(N)||(N=0),Math.abs(N)>1e3&&(N=Math.sign(N)*1e3);let k=this.bias+N*p;Number.isFinite(k)||(k=0),Math.abs(k)>1e6&&(k=Math.sign(k)*1e6),this.bias=k,this.previousDeltaBias=N}this.totalDeltaBias=0}else this.previousDeltaBias=0,this.totalDeltaBias=0;if(g==="lookahead"){let y=this._la_k||5,N=this._la_alpha||.5;if(this._la_step%y===0){this._la_shadowBias=(1-N)*this._la_shadowBias+N*this.bias,this.bias=this._la_shadowBias;let k=L=>{L.lookaheadShadowWeight||(L.lookaheadShadowWeight=L.weight),L.lookaheadShadowWeight=(1-N)*L.lookaheadShadowWeight+N*L.weight,L.weight=L.lookaheadShadowWeight};for(let L of this.connections.in)k(L);for(let L of this.connections.self)k(L)}}}_safeUpdateWeight(t,e){let i=t.weight+e;Number.isFinite(i)||(i=0),Math.abs(i)>1e6&&(i=Math.sign(i)*1e6),t.weight=i}};ie._globalNodeIndex=0;ie._nextGeneId=1;pt=ie});var Fe,xt,oe=Y(()=>{"use strict";Dt();Fe=class{constructor(){this.buckets=new Map,this.created=0,this.reused=0,this.maxPerBucket=Number.POSITIVE_INFINITY}acquire(t){let e=this.buckets.get(t);if(e&&e.length>0){this.reused++;let i=e.pop();return i.fill(0),i}return this.created++,at.float32Mode?new Float32Array(t):new Array(t).fill(0)}release(t){let e=t.length>>>0;this.buckets.has(e)||this.buckets.set(e,[]);let i=this.buckets.get(e);i.length<this.maxPerBucket&&i.push(t)}clear(){this.buckets.clear(),this.created=0,this.reused=0}stats(){return{created:this.created,reused:this.reused,bucketCount:this.buckets.size}}setMaxPerBucket(t){typeof t=="number"&&t>=0&&(this.maxPerBucket=t)}prewarm(t,e){let i=Math.max(0,Math.floor(e));this.buckets.has(t)||this.buckets.set(t,[]);let o=this.buckets.get(t);for(let s=0;s<i&&o.length<this.maxPerBucket;s++){let r=at.float32Mode?new Float32Array(t):new Array(t).fill(0);o.push(r),this.created++}}bucketSize(t){var e,i;return(i=(e=this.buckets.get(t))===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0}},xt=new Fe});var Dn=Qt((ra,os)=>{os.exports={name:"@reicek/neataptic-ts",version:"0.1.10",description:"Architecture-free neural network library with genetic algorithm implementations",main:"./dist/neataptic.js",module:"./dist/neataptic.js",types:"./dist/neataptic.d.ts",type:"module",scripts:{test:"jest --no-cache --coverage --collect-coverage --runInBand --testPathIgnorePatterns=.e2e.test.ts --verbose","test:bench":"jest --no-cache --runInBand --verbose --testPathPattern=benchmark","test:silent":"jest --no-cache --coverage --collect-coverage --runInBand --testPathIgnorePatterns=.e2e.test.ts --silent",deploy:"npm run build && npm run test:dist && npm publish",build:"npm run build:webpack && npm run build:ts","build:ts":"tsc","build:webpack":"webpack --config webpack.config.js","start:ts":"ts-node src/neataptic.ts","test:e2e":"cross-env FORCE_COLOR=true jest e2e.test.ts --no-cache --runInBand","test:e2e:logs":"npx jest e2e.test.ts --verbose --runInBand --no-cache","test:dist":"npm run build:ts && jest --no-cache --coverage --collect-coverage --runInBand --testPathIgnorePatterns=.e2e.test.ts","docs:build-scripts":"tsc -p tsconfig.docs.json && node scripts/write-dist-docs-pkg.cjs","docs:folders":"npm run docs:build-scripts && node ./dist-docs/scripts/generate-docs.js","docs:html":"npm run docs:build-scripts && node ./dist-docs/scripts/render-docs-html.js","build:ascii-maze":"npx esbuild test/examples/asciiMaze/browser-entry.ts --bundle --outfile=docs/assets/ascii-maze.bundle.js --platform=browser --format=iife --sourcemap --external:fs --external:child_process","docs:examples":"node scripts/copy-examples.cjs",prettier:"npx prettier --write .",docs:"npm run build:ascii-maze && npm run docs:examples && npm run docs:build-scripts && node ./dist-docs/scripts/generate-docs.js && node ./dist-docs/scripts/render-docs-html.js","onnx:export":"node scripts/export-onnx.cjs"},exports:{".":{types:"./dist/neataptic.d.ts",import:"./dist/neataptic.js"}},devDependencies:{"@types/chai":"^5.2.1","@types/fs-extra":"^11.0.4","@types/jest":"^29.5.11","@types/node":"^20.19.10","@types/seedrandom":"^3.0.8","@types/webpack":"^5.28.5","@types/webpack-dev-server":"^4.7.2",chai:"^4.3.4","copy-webpack-plugin":"^8.1.0","cross-env":"^7.0.3","fast-glob":"^3.3.3","fs-extra":"^11.3.1",husky:"^6.0.0",jest:"^29.7.0","jsdoc-to-markdown":"^9.1.1",marked:"^12.0.2",mkdocs:"^0.0.1","ts-jest":"^29.1.1","ts-loader":"^9.5.2","ts-morph":"^22.0.0","ts-node":"^10.9.2",typescript:"^5.6.3","undici-types":"^7.8.0",webpack:"^5.99.5","webpack-cli":"^6.0.1",esbuild:"^0.23.0",puppeteer:"^23.3.0"},repository:{type:"git",url:"https://github.com/reicek/NeatapticTS.git"},keywords:["neural network","machine learning","genetic algorithm","mutation","neat"],author:{name:"Cesar Anton",email:"reicek@gmail.com"},license:"MIT",publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},bugs:{url:"https://github.com/reicek/NeatapticTS/issues",email:"reicek@gmail.com"},homepage:"https://reicek.github.io/NeatapticTS/",engines:{node:">=14.0.0"},prettier:{singleQuote:!0},dependencies:{build:"^0.1.4",child_process:"^1.0.2",os:"^0.1.2",path:"^0.12.7",seedrandom:"^3.0.5",undici:"^5.0.0","undici-types":"^7.8.0"}}});function ss(n){let t=new Set;n.nodes.forEach(e=>{var i;return(i=e.connections)===null||i===void 0?void 0:i.out.forEach(o=>t.add(o))}),n.connections=Array.from(t)}function se(n){let t=(n?.name||"").toUpperCase();return t.includes("TANH")?"Tanh":t.includes("LOGISTIC")||t.includes("SIGMOID")?"Sigmoid":t.includes("RELU")?"Relu":(n&&console.warn(`Unsupported activation function ${n.name} for ONNX export, defaulting to Identity.`),"Identity")}function rs(n){let t=n.nodes.filter(a=>a.type==="input"),e=n.nodes.filter(a=>a.type==="output"),i=n.nodes.filter(a=>a.type==="hidden");if(i.length===0)return[t,e];let o=[...i],s=t,r=[];for(;o.length;){let a=o.filter(c=>c.connections.in.every(l=>s.includes(l.from)));if(!a.length)throw new Error("Invalid network structure for ONNX export: cannot resolve layered ordering.");r.push(s),s=a,o=o.filter(c=>!a.includes(c))}return r.push(s),r.push(e),r}function as(n,t,e){for(let i=1;i<n.length;i++){let o=n[i-1],s=n[i],r=new Set(s.map(a=>a.squash&&a.squash.name));if(r.size>1&&!e.allowMixedActivations)throw new Error(`ONNX export error: Mixed activation functions detected in layer ${i}. (enable allowMixedActivations to decompose layer)`);r.size>1&&e.allowMixedActivations&&console.warn(`Warning: Mixed activations in layer ${i}; exporting per-neuron Gemm + Activation (+Concat) baseline.`);for(let a of s)for(let c of o)if(!a.connections.in.some(u=>u.from===c)&&!e.allowPartialConnectivity)throw new Error(`ONNX export error: Missing connection from node ${c.index} to node ${a.index} in layer ${i}. (enable allowPartialConnectivity)`)}}function cs(n,t,e={}){var i,o,s,r;let{includeMetadata:a=!1,opset:c=18,batchDimension:l=!1,legacyNodeOrdering:u=!1,producerName:h="neataptic-ts",producerVersion:d,docString:f}=e,m=t[0],g=t[t.length-1],w=l?[{dim_param:"N"},{dim_value:m.length}]:[{dim_value:m.length}],M=l?[{dim_param:"N"},{dim_value:g.length}]:[{dim_value:g.length}],_={graph:{inputs:[{name:"input",type:{tensor_type:{elem_type:1,shape:{dim:w}}}}],outputs:[{name:"output",type:{tensor_type:{elem_type:1,shape:{dim:M}}}}],initializer:[],node:[]}};if(a){let p=(()=>{try{return Dn().version}catch{return"0.0.0"}})();_.ir_version=9,_.opset_import=[{version:c,domain:""}],_.producer_name=h,_.producer_version=d||p,_.doc_string=f||"Exported from NeatapticTS ONNX exporter (phases 1-2 baseline)"}let v="input",b=[];if(e.allowRecurrent&&e.recurrentSingleStep)for(let p=1;p<t.length-1;p++){let S=t[p];if(S.some(x=>x.connections.self.length>0)){b.push(p);let x=p===1?"hidden_prev":`hidden_prev_l${p}`;_.graph.inputs.push({name:x,type:{tensor_type:{elem_type:1,shape:{dim:l?[{dim_param:"N"},{dim_value:S.length}]:[{dim_value:S.length}]}}}})}}let A=[];for(let p=1;p<t.length;p++){let S=t[p-1],x=t[p],y=p===t.length-1;y||A.push(x.length);let N=(i=e.conv2dMappings)===null||i===void 0?void 0:i.find(L=>L.layerIndex===p);if(N){let L=N.inHeight*N.inWidth*N.inChannels,I=S.length,E=N.outChannels*N.outHeight*N.outWidth,T=x.length,P=[N.padTop||0,N.padLeft||0,N.padBottom||0,N.padRight||0];if(!(L===I&&E===T))console.warn(`Conv2D mapping for layer ${p} skipped: dimension mismatch (expected prev=${L} got ${I}; expected this=${E} got ${T}).`);else{let $=[],W=[];for(let V=0;V<N.outChannels;V++){let O=V*N.outHeight*N.outWidth,q=x[O];W.push(q.bias);for(let et=0;et<N.inChannels;et++)for(let D=0;D<N.kernelHeight;D++)for(let X=0;X<N.kernelWidth;X++){let U=et*(N.inHeight*N.inWidth)+D*N.inWidth+X,Q=S[U],z=q.connections.in.find(H=>H.from===Q);$.push(z?z.weight:0)}}let K=`ConvW${p-1}`,B=`ConvB${p-1}`;_.graph.initializer.push({name:K,data_type:1,dims:[N.outChannels,N.inChannels,N.kernelHeight,N.kernelWidth],float_data:$}),_.graph.initializer.push({name:B,data_type:1,dims:[N.outChannels],float_data:W});let Z=`Conv_${p}`;_.graph.node.push({op_type:"Conv",input:[v,K,B],output:[Z],name:`conv_l${p}`,attributes:[{name:"kernel_shape",type:"INTS",ints:[N.kernelHeight,N.kernelWidth]},{name:"strides",type:"INTS",ints:[N.strideHeight,N.strideWidth]},{name:"pads",type:"INTS",ints:P}]});let G=N.activation||se(x[0].squash),tt=`Layer_${p}`;_.graph.node.push({op_type:G,input:[Z],output:[tt],name:`act_conv_l${p}`}),v=tt;let F=(o=e.pool2dMappings)===null||o===void 0?void 0:o.find(V=>V.afterLayerIndex===p);if(F){let V=[F.kernelHeight,F.kernelWidth],O=[F.strideHeight,F.strideWidth],q=[F.padTop||0,F.padLeft||0,F.padBottom||0,F.padRight||0],et=`Pool_${p}`;if(_.graph.node.push({op_type:F.type,input:[v],output:[et],name:`pool_after_l${p}`,attributes:[{name:"kernel_shape",type:"INTS",ints:V},{name:"strides",type:"INTS",ints:O},{name:"pads",type:"INTS",ints:q}]}),v=et,e.flattenAfterPooling){let U=`PoolFlat_${p}`;_.graph.node.push({op_type:"Flatten",input:[v],output:[U],name:`flatten_after_l${p}`,attributes:[{name:"axis",type:"INT",i:1}]}),v=U,_.metadata_props=_.metadata_props||[];let Q=_.metadata_props.find(z=>z.key==="flatten_layers");if(Q)try{let z=JSON.parse(Q.value);Array.isArray(z)&&!z.includes(p)&&(z.push(p),Q.value=JSON.stringify(z))}catch{Q.value=JSON.stringify([p])}else _.metadata_props.push({key:"flatten_layers",value:JSON.stringify([p])})}_.metadata_props=_.metadata_props||[];let D=_.metadata_props.find(U=>U.key==="pool2d_layers");if(D)try{let U=JSON.parse(D.value);Array.isArray(U)&&!U.includes(p)&&(U.push(p),D.value=JSON.stringify(U))}catch{D.value=JSON.stringify([p])}else _.metadata_props.push({key:"pool2d_layers",value:JSON.stringify([p])});let X=_.metadata_props.find(U=>U.key==="pool2d_specs");if(X)try{let U=JSON.parse(X.value);Array.isArray(U)&&(U.push(Object.assign({},F)),X.value=JSON.stringify(U))}catch{X.value=JSON.stringify([F])}else _.metadata_props.push({key:"pool2d_specs",value:JSON.stringify([F])})}_.metadata_props=_.metadata_props||[];let C=_.metadata_props.find(V=>V.key==="conv2d_layers");if(C)try{let V=JSON.parse(C.value);Array.isArray(V)&&!V.includes(p)&&(V.push(p),C.value=JSON.stringify(V))}catch{C.value=JSON.stringify([p])}else _.metadata_props.push({key:"conv2d_layers",value:JSON.stringify([p])});let j=_.metadata_props.find(V=>V.key==="conv2d_specs");if(j)try{let V=JSON.parse(j.value);Array.isArray(V)&&(V.push(Object.assign({},N)),j.value=JSON.stringify(V))}catch{j.value=JSON.stringify([N])}else _.metadata_props.push({key:"conv2d_specs",value:JSON.stringify([N])});continue}}let k=e.allowMixedActivations&&new Set(x.map(L=>L.squash&&L.squash.name)).size>1;if(b.includes(p)&&!y){if(k)throw new Error(`Recurrent export does not yet support mixed activations in hidden layer ${p}.`);let L=[],I=new Array(x.length).fill(0);for(let W=0;W<x.length;W++){let K=x[W];I[W]=K.bias;for(let B=0;B<S.length;B++){let Z=S[B],G=K.connections.in.find(tt=>tt.from===Z);L.push(G?G.weight:0)}}let E=`W${p-1}`,T=`B${p-1}`;_.graph.initializer.push({name:E,data_type:1,dims:[x.length,S.length],float_data:L}),_.graph.initializer.push({name:T,data_type:1,dims:[x.length],float_data:I});let P=[];for(let W=0;W<x.length;W++)for(let K=0;K<x.length;K++)if(W===K){let B=x[W].connections.self[0];P.push(B?B.weight:0)}else P.push(0);let R=`R${p-1}`;_.graph.initializer.push({name:R,data_type:1,dims:[x.length,x.length],float_data:P}),_.graph.node.push({op_type:"Gemm",input:[v,E,T],output:[`Gemm_in_${p}`],name:`gemm_in_l${p}`,attributes:[{name:"alpha",type:"FLOAT",f:1},{name:"beta",type:"FLOAT",f:1},{name:"transB",type:"INT",i:1}]});let $=p===1?"hidden_prev":`hidden_prev_l${p}`;_.graph.node.push({op_type:"Gemm",input:[$,R],output:[`Gemm_rec_${p}`],name:`gemm_rec_l${p}`,attributes:[{name:"alpha",type:"FLOAT",f:1},{name:"beta",type:"FLOAT",f:1},{name:"transB",type:"INT",i:1}]}),_.graph.node.push({op_type:"Add",input:[`Gemm_in_${p}`,`Gemm_rec_${p}`],output:[`RecurrentSum_${p}`],name:`add_recurrent_l${p}`}),_.graph.node.push({op_type:se(x[0].squash),input:[`RecurrentSum_${p}`],output:[`Layer_${p}`],name:`act_l${p}`}),v=`Layer_${p}`}else if(k){let L=[];x.forEach((T,P)=>{let R=[];for(let Z=0;Z<S.length;Z++){let G=S[Z],tt=T.connections.in.find(F=>F.from===G);R.push(tt?tt.weight:0)}let $=`W${p-1}_n${P}`,W=`B${p-1}_n${P}`,K=`Gemm_${p}_n${P}`,B=`Layer_${p}_n${P}`;_.graph.initializer.push({name:$,data_type:1,dims:[1,S.length],float_data:R}),_.graph.initializer.push({name:W,data_type:1,dims:[1],float_data:[T.bias]}),_.graph.node.push({op_type:"Gemm",input:[v,$,W],output:[K],name:`gemm_l${p}_n${P}`,attributes:[{name:"alpha",type:"FLOAT",f:1},{name:"beta",type:"FLOAT",f:1},{name:"transB",type:"INT",i:1}]}),_.graph.node.push({op_type:se(T.squash),input:[K],output:[B],name:`act_l${p}_n${P}`}),L.push(B)});let I=`Layer_${p}`;_.graph.node.push({op_type:"Concat",input:L,output:[I],name:`concat_l${p}`,attributes:[{name:"axis",type:"INT",i:l?1:0}]}),v=I;let E=(r=e.pool2dMappings)===null||r===void 0?void 0:r.find(T=>T.afterLayerIndex===p);if(E){let T=[E.kernelHeight,E.kernelWidth],P=[E.strideHeight,E.strideWidth],R=[E.padTop||0,E.padLeft||0,E.padBottom||0,E.padRight||0],$=`Pool_${p}`;if(_.graph.node.push({op_type:E.type,input:[v],output:[$],name:`pool_after_l${p}`,attributes:[{name:"kernel_shape",type:"INTS",ints:T},{name:"strides",type:"INTS",ints:P},{name:"pads",type:"INTS",ints:R}]}),v=$,e.flattenAfterPooling){let B=`PoolFlat_${p}`;_.graph.node.push({op_type:"Flatten",input:[v],output:[B],name:`flatten_after_l${p}`,attributes:[{name:"axis",type:"INT",i:1}]}),v=B,_.metadata_props=_.metadata_props||[];let Z=_.metadata_props.find(G=>G.key==="flatten_layers");if(Z)try{let G=JSON.parse(Z.value);Array.isArray(G)&&!G.includes(p)&&(G.push(p),Z.value=JSON.stringify(G))}catch{Z.value=JSON.stringify([p])}else _.metadata_props.push({key:"flatten_layers",value:JSON.stringify([p])})}_.metadata_props=_.metadata_props||[];let W=_.metadata_props.find(B=>B.key==="pool2d_layers");if(W)try{let B=JSON.parse(W.value);Array.isArray(B)&&!B.includes(p)&&(B.push(p),W.value=JSON.stringify(B))}catch{W.value=JSON.stringify([p])}else _.metadata_props.push({key:"pool2d_layers",value:JSON.stringify([p])});let K=_.metadata_props.find(B=>B.key==="pool2d_specs");if(K)try{let B=JSON.parse(K.value);Array.isArray(B)&&(B.push(Object.assign({},E)),K.value=JSON.stringify(B))}catch{K.value=JSON.stringify([E])}else _.metadata_props.push({key:"pool2d_specs",value:JSON.stringify([E])})}}else{let L=[],I=new Array(x.length).fill(0);for(let W=0;W<x.length;W++){let K=x[W];I[W]=K.bias;for(let B=0;B<S.length;B++){let Z=S[B],G=K.connections.in.find(tt=>tt.from===Z);L.push(G?G.weight:0)}}let E=`W${p-1}`,T=`B${p-1}`,P=`Gemm_${p}`,R=`Layer_${p}`;_.graph.initializer.push({name:E,data_type:1,dims:[x.length,S.length],float_data:L}),_.graph.initializer.push({name:T,data_type:1,dims:[x.length],float_data:I}),u?(_.graph.node.push({op_type:se(x[0].squash),input:[P],output:[R],name:`act_l${p}`}),_.graph.node.push({op_type:"Gemm",input:[v,E,T],output:[P],name:`gemm_l${p}`,attributes:[{name:"alpha",type:"FLOAT",f:1},{name:"beta",type:"FLOAT",f:1},{name:"transB",type:"INT",i:1}]})):(_.graph.node.push({op_type:"Gemm",input:[v,E,T],output:[P],name:`gemm_l${p}`,attributes:[{name:"alpha",type:"FLOAT",f:1},{name:"beta",type:"FLOAT",f:1},{name:"transB",type:"INT",i:1}]}),_.graph.node.push({op_type:se(x[0].squash),input:[P],output:[R],name:`act_l${p}`})),v=R;let $=(s=e.pool2dMappings)===null||s===void 0?void 0:s.find(W=>W.afterLayerIndex===p);if($){let W=[$.kernelHeight,$.kernelWidth],K=[$.strideHeight,$.strideWidth],B=[$.padTop||0,$.padLeft||0,$.padBottom||0,$.padRight||0],Z=`Pool_${p}`;if(_.graph.node.push({op_type:$.type,input:[v],output:[Z],name:`pool_after_l${p}`,attributes:[{name:"kernel_shape",type:"INTS",ints:W},{name:"strides",type:"INTS",ints:K},{name:"pads",type:"INTS",ints:B}]}),v=Z,e.flattenAfterPooling){let F=`PoolFlat_${p}`;_.graph.node.push({op_type:"Flatten",input:[v],output:[F],name:`flatten_after_l${p}`,attributes:[{name:"axis",type:"INT",i:1}]}),v=F,_.metadata_props=_.metadata_props||[];let C=_.metadata_props.find(j=>j.key==="flatten_layers");if(C)try{let j=JSON.parse(C.value);Array.isArray(j)&&!j.includes(p)&&(j.push(p),C.value=JSON.stringify(j))}catch{C.value=JSON.stringify([p])}else _.metadata_props.push({key:"flatten_layers",value:JSON.stringify([p])})}_.metadata_props=_.metadata_props||[];let G=_.metadata_props.find(F=>F.key==="pool2d_layers");if(G)try{let F=JSON.parse(G.value);Array.isArray(F)&&!F.includes(p)&&(F.push(p),G.value=JSON.stringify(F))}catch{G.value=JSON.stringify([p])}else _.metadata_props.push({key:"pool2d_layers",value:JSON.stringify([p])});let tt=_.metadata_props.find(F=>F.key==="pool2d_specs");if(tt)try{let F=JSON.parse(tt.value);Array.isArray(F)&&(F.push(Object.assign({},$)),tt.value=JSON.stringify(F))}catch{tt.value=JSON.stringify([$])}else _.metadata_props.push({key:"pool2d_specs",value:JSON.stringify([$])})}}}if(e.allowRecurrent)for(let p=1;p<t.length-1;p++){let S=t[p],x=S.length;if(_.metadata_props||(_.metadata_props=[]),x>=8&&x<10&&_.metadata_props.push({key:"rnn_pattern_fallback",value:JSON.stringify({layer:p,reason:"size_between_gru_lstm_thresholds"})}),x>=10&&x%5===0){let y=x/5,N=t[p-1],k=S.slice(0,y),L=S.slice(y,y*2),I=S.slice(y*2,y*3),E=S.slice(y*3,y*4),T=S.slice(y*4,y*5),P=[k,L,I,E],R=P.length,$=N.length,W=[],K=[],B=[];for(let G=0;G<R;G++){let tt=P[G];for(let F=0;F<y;F++){let C=tt[F];for(let j=0;j<$;j++){let V=N[j],O=C.connections.in.find(q=>q.from===V);W.push(O?O.weight:0)}for(let j=0;j<y;j++)if(tt===I&&j===F){let V=C.connections.self[0];K.push(V?V.weight:0)}else K.push(0);B.push(C.bias)}}_.graph.initializer.push({name:`LSTM_W${p-1}`,data_type:1,dims:[R*y,$],float_data:W}),_.graph.initializer.push({name:`LSTM_R${p-1}`,data_type:1,dims:[R*y,y],float_data:K}),_.graph.initializer.push({name:`LSTM_B${p-1}`,data_type:1,dims:[R*y],float_data:B}),_.graph.node.push({op_type:"LSTM",input:[v,`LSTM_W${p-1}`,`LSTM_R${p-1}`,`LSTM_B${p-1}`],output:[`Layer_${p}_lstm_hidden`],name:`lstm_l${p}`,attributes:[{name:"hidden_size",type:"INT",i:y},{name:"layout",type:"INT",i:0}]}),_.metadata_props=_.metadata_props||[];let Z=_.metadata_props.findIndex(G=>G.key==="lstm_emitted_layers");if(Z>=0)try{let G=JSON.parse(_.metadata_props[Z].value);Array.isArray(G)&&!G.includes(p)&&(G.push(p),_.metadata_props[Z].value=JSON.stringify(G))}catch{_.metadata_props[Z].value=JSON.stringify([p])}else _.metadata_props.push({key:"lstm_emitted_layers",value:JSON.stringify([p])})}if(x>=8&&x%4===0){let y=x/4,N=t[p-1],k=S.slice(0,y),L=S.slice(y,y*2),I=S.slice(y*2,y*3),E=S.slice(y*3,y*4),T=[k,L,I],P=T.length,R=N.length,$=[],W=[],K=[];for(let G=0;G<P;G++){let tt=T[G];for(let F=0;F<y;F++){let C=tt[F];for(let j=0;j<R;j++){let V=N[j],O=C.connections.in.find(q=>q.from===V);$.push(O?O.weight:0)}for(let j=0;j<y;j++)if(tt===I&&j===F){let V=C.connections.self[0];W.push(V?V.weight:0)}else W.push(0);K.push(C.bias)}}_.graph.initializer.push({name:`GRU_W${p-1}`,data_type:1,dims:[P*y,R],float_data:$}),_.graph.initializer.push({name:`GRU_R${p-1}`,data_type:1,dims:[P*y,y],float_data:W}),_.graph.initializer.push({name:`GRU_B${p-1}`,data_type:1,dims:[P*y],float_data:K});let B=p===1?"input":`Layer_${p-1}`;_.graph.node.push({op_type:"GRU",input:[B,`GRU_W${p-1}`,`GRU_R${p-1}`,`GRU_B${p-1}`],output:[`Layer_${p}_gru_hidden`],name:`gru_l${p}`,attributes:[{name:"hidden_size",type:"INT",i:y},{name:"layout",type:"INT",i:0}]}),_.metadata_props=_.metadata_props||[];let Z=_.metadata_props.findIndex(G=>G.key==="gru_emitted_layers");if(Z>=0)try{let G=JSON.parse(_.metadata_props[Z].value);Array.isArray(G)&&!G.includes(p)&&(G.push(p),_.metadata_props[Z].value=JSON.stringify(G))}catch{_.metadata_props[Z].value=JSON.stringify([p])}else _.metadata_props.push({key:"gru_emitted_layers",value:JSON.stringify([p])})}}if(a&&(_.metadata_props=_.metadata_props||[],_.metadata_props.push({key:"layer_sizes",value:JSON.stringify(A)}),b.length&&_.metadata_props.push({key:"recurrent_single_step",value:JSON.stringify(b)}),e.validateConvSharing&&e.conv2dMappings&&e.conv2dMappings.length)){let p=[],S=[];for(let x of e.conv2dMappings){let y=x.layerIndex,N=t[y-1],k=t[y];if(!k||!N)continue;let L=[],I=!0;for(let T=0;T<x.outChannels;T++){let P=T*(x.outHeight*x.outWidth),R=k[P],$=[];for(let W=0;W<x.inChannels;W++)for(let K=0;K<x.kernelHeight;K++)for(let B=0;B<x.kernelWidth;B++){let Z=W*(x.inHeight*x.inWidth)+K*x.inWidth+B,G=N[Z],tt=R.connections.in.find(F=>F.from===G);$.push(tt?tt.weight:0)}L.push($)}let E=1e-9;for(let T=0;T<x.outChannels&&I;T++)for(let P=0;P<x.outHeight&&I;P++)for(let R=0;R<x.outWidth&&I;R++){let $=T*(x.outHeight*x.outWidth)+P*x.outWidth+R,W=k[$];if(!W)continue;let K=0;for(let B=0;B<x.inChannels&&I;B++){let Z=P*x.strideHeight-(x.padTop||0),G=R*x.strideWidth-(x.padLeft||0);for(let tt=0;tt<x.kernelHeight&&I;tt++)for(let F=0;F<x.kernelWidth&&I;F++){let C=Z+tt,j=G+F;if(C<0||C>=x.inHeight||j<0||j>=x.inWidth){K++;continue}let V=B*(x.inHeight*x.inWidth)+C*x.inWidth+j,O=N[V],q=W.connections.in.find(D=>D.from===O),et=q?q.weight:0;Math.abs(et-L[T][K])>E&&(I=!1),K++}}if(!I)break}I?p.push(y):(S.push(y),console.warn(`Conv2D weight sharing mismatch detected in layer ${y}`))}p.length&&_.metadata_props.push({key:"conv2d_sharing_verified",value:JSON.stringify(p)}),S.length&&_.metadata_props.push({key:"conv2d_sharing_mismatch",value:JSON.stringify(S)})}return _}function kn(n,t={}){var e;if(ss(n),n.nodes.forEach((r,a)=>r.index=a),!n.connections||n.connections.length===0)throw new Error("ONNX export currently only supports simple MLPs");let i=rs(n),o=[];if(t.allowRecurrent)try{for(let r=1;r<i.length-1;r++){let a=i[r],c=a.length;if(c>=10&&c%5===0){let l=c/5;a.slice(l*2,l*3).every(d=>d.connections.self.length===1)&&o.push({layerIndex:r,unitSize:l})}}}catch{}as(i,n,t);let s=cs(n,i,t);if(t.includeMetadata){let r=[],a=[];for(let c=1;c<i.length-1;c++){let l=i[c-1].length,u=i[c].length,h=Math.sqrt(l);if(Math.abs(h-Math.round(h))>1e-9)continue;let d=Math.round(h);for(let f of[3,2]){if(f>=d)continue;let m=d-f+1;if(m*m===u){if((e=t.conv2dMappings)===null||e===void 0?void 0:e.some(w=>w.layerIndex===c))break;a.push(c),r.push({layerIndex:c,inHeight:d,inWidth:d,inChannels:1,kernelHeight:f,kernelWidth:f,strideHeight:1,strideWidth:1,outHeight:m,outWidth:m,outChannels:1,note:"heuristic_inferred_no_export_applied"});break}}}a.length&&(s.metadata_props=s.metadata_props||[],s.metadata_props.push({key:"conv2d_inferred_layers",value:JSON.stringify(a)}),s.metadata_props.push({key:"conv2d_inferred_specs",value:JSON.stringify(r)}))}return o.length&&(s.metadata_props=s.metadata_props||[],s.metadata_props.push({key:"lstm_groups_stub",value:JSON.stringify(o)})),s}var $e=Y(()=>{"use strict";Mt();Bt()});var jn=Y(()=>{"use strict";$e();$e()});function Pn(n){var t;if(!n.nodes.some(m=>m.type==="output"))throw new Error("Cannot create standalone function: network has no output nodes.");let e={},i=[],o={},s=0,r=[],a=[],c=[],l={logistic:"function logistic(x){ return 1 / (1 + Math.exp(-x)); }",tanh:"function tanh(x){ return Math.tanh(x); }",relu:"function relu(x){ return x > 0 ? x : 0; }",identity:"function identity(x){ return x; }",step:"function step(x){ return x > 0 ? 1 : 0; }",softsign:"function softsign(x){ return x / (1 + Math.abs(x)); }",sinusoid:"function sinusoid(x){ return Math.sin(x); }",gaussian:"function gaussian(x){ return Math.exp(-Math.pow(x, 2)); }",bentIdentity:"function bentIdentity(x){ return (Math.sqrt(Math.pow(x, 2) + 1) - 1) / 2 + x; }",bipolar:"function bipolar(x){ return x > 0 ? 1 : -1; }",bipolarSigmoid:"function bipolarSigmoid(x){ return 2 / (1 + Math.exp(-x)) - 1; }",hardTanh:"function hardTanh(x){ return Math.max(-1, Math.min(1, x)); }",absolute:"function absolute(x){ return Math.abs(x); }",inverse:"function inverse(x){ return 1 - x; }",selu:"function selu(x){ var a=1.6732632423543772,s=1.0507009873554805; var fx=x>0?x:a*Math.exp(x)-a; return fx*s; }",softplus:"function softplus(x){ if(x>30)return x; if(x<-30)return Math.exp(x); return Math.max(0,x)+Math.log(1+Math.exp(-Math.abs(x))); }",swish:"function swish(x){ var s=1/(1+Math.exp(-x)); return x*s; }",gelu:"function gelu(x){ var cdf=0.5*(1.0+Math.tanh(Math.sqrt(2.0/Math.PI)*(x+0.044715*Math.pow(x,3)))); return x*cdf; }",mish:"function mish(x){ var sp_x; if(x>30){sp_x=x;}else if(x<-30){sp_x=Math.exp(x);}else{sp_x=Math.log(1+Math.exp(x));} var tanh_sp_x=Math.tanh(sp_x); return x*tanh_sp_x; }"};n.nodes.forEach((m,g)=>{m.index=g,r.push(m.activation),a.push(m.state)}),c.push("for(var i = 0; i < input.length; i++) A[i] = input[i];");for(let m=n.input;m<n.nodes.length;m++){let g=n.nodes[m],w=g.squash,M=w.name||`anonymous_squash_${m}`;if(!(M in e)){let p;l[M]?(p=l[M],p.startsWith(`function ${M}`)||(p=`function ${M}${p.substring(p.indexOf("("))}`),p=Ln(p)):(p=w.toString(),p=Ln(p),p.startsWith("function")?p=`function ${M}${p.substring(p.indexOf("("))}`:p.includes("=>")?p=`function ${M}${p.substring(p.indexOf("("))}`:p=`function ${M}(x){ return x; }`),e[M]=p,i.push(p),o[M]=s++}let _=o[M],v=[];for(let p of g.connections.in){if(typeof p.from.index>"u")continue;let S=`A[${p.from.index}] * ${p.weight}`;p.gater&&typeof p.gater.index<"u"&&(S+=` * A[${p.gater.index}]`),v.push(S)}if(g.connections.self.length>0){let p=g.connections.self[0],S=`S[${m}] * ${p.weight}`;p.gater&&typeof p.gater.index<"u"&&(S+=` * A[${p.gater.index}]`),v.push(S)}let b=v.length>0?v.join(" + "):"0";c.push(`S[${m}] = ${b} + ${g.bias};`);let A=typeof g.mask=="number"&&g.mask!==1?g.mask:1;c.push(`A[${m}] = F[${_}](S[${m}])${A!==1?` * ${A}`:""};`)}let u=[];for(let m=n.nodes.length-n.output;m<n.nodes.length;m++)typeof((t=n.nodes[m])===null||t===void 0?void 0:t.index)<"u"&&u.push(n.nodes[m].index);c.push(`return [${u.map(m=>`A[${m}]`).join(",")}];`);let h=Object.entries(o).sort(([,m],[,g])=>m-g).map(([m])=>m).join(","),d=n._activationPrecision==="f32"?"Float32Array":"Float64Array",f="";return f+=`(function(){
`,f+=`${i.join(`
`)}
`,f+=`var F = [${h}];
`,f+=`var A = new ${d}([${r.join(",")}]);
`,f+=`var S = new ${d}([${a.join(",")}]);
`,f+=`function activate(input){
`,f+=`if (!input || input.length !== ${n.input}) { throw new Error('Invalid input size. Expected ${n.input}, got ' + (input ? input.length : 'undefined')); }
`,f+=c.join(`
`),f+=`}
`,f+=`return activate;
})();`,f}var Ln,Rn=Y(()=>{"use strict";Ln=n=>(n=n.replace(/\/\*\s*istanbul\s+ignore\s+[\s\S]*?\*\//g,""),n=n.replace(/cov_[\w$]+\(\)\.(s|f|b)\[\d+\](\[\d+\])?\+\+/g,""),n=n.replace(/cov_[\w$]+\(\)/g,""),n=n.replace(/^\s*\/\/ # sourceMappingURL=.*\s*$/gm,""),n=n.replace(/\(\s*,\s*/g,"( "),n=n.replace(/\s*,\s*\)/g," )"),n=n.trim(),n=n.replace(/^\s*;\s*$/gm,""),n=n.replace(/;{2,}/g,";"),n=n.replace(/^\s*[,;]?\s*$/gm,""),n)});function Wn(){let n=this;if(!n._enforceAcyclic){n._topoOrder=null,n._topoDirty=!1;return}let t=new Map;this.nodes.forEach(o=>t.set(o,0));for(let o of this.connections)o.from!==o.to&&t.set(o.to,(t.get(o.to)||0)+1);let e=[];this.nodes.forEach(o=>{(o.type==="input"||(t.get(o)||0)===0)&&e.push(o)});let i=[];for(;e.length;){let o=e.shift();i.push(o);for(let s of o.connections.out){if(s.to===o)continue;let r=(t.get(s.to)||0)-1;t.set(s.to,r),r===0&&e.push(s.to)}}n._topoOrder=i.length===this.nodes.length?i:this.nodes.slice(),n._topoDirty=!1}function Bn(n,t){if(n===t)return!0;let e=new Set,i=[n];for(;i.length;){let o=i.pop();if(o===t)return!0;if(!e.has(o)){e.add(o);for(let s of o.connections.out)s.to!==o&&i.push(s.to)}}return!1}var Gn=Y(()=>{"use strict"});function _e(n=!1){let t=this;if(!n&&!t._slabDirty)return;t._nodeIndexDirty&&$n.call(this);let e=this.connections.length,i=t._useFloat32Weights?new Float32Array(e):new Float64Array(e),o=new Uint32Array(e),s=new Uint32Array(e);for(let r=0;r<e;r++){let a=this.connections[r];i[r]=a.weight,o[r]=a.from.index>>>0,s[r]=a.to.index>>>0}t._connWeights=i,t._connFrom=o,t._connTo=s,t._slabDirty=!1,t._adjDirty=!0}function Fn(){_e.call(this);let n=this;return{weights:n._connWeights,from:n._connFrom,to:n._connTo}}function $n(){let n=this;for(let t=0;t<this.nodes.length;t++)this.nodes[t].index=t;n._nodeIndexDirty=!1}function ls(){let n=this;if(!n._connFrom||!n._connTo)return;let t=this.nodes.length,e=n._connFrom.length,i=new Uint32Array(t);for(let c=0;c<e;c++)i[n._connFrom[c]]++;let o=new Uint32Array(t+1),s=0;for(let c=0;c<t;c++)o[c]=s,s+=i[c];o[t]=s;let r=new Uint32Array(e),a=o.slice();for(let c=0;c<e;c++){let l=n._connFrom[c];r[a[l]++]=c}n._outStart=o,n._outOrder=r,n._adjDirty=!1}function hs(n){let t=this;return!n&&t._enforceAcyclic&&!t._topoDirty&&this.gates.length===0&&this.selfconns.length===0&&this.dropout===0&&t._weightNoiseStd===0&&t._weightNoisePerHidden.length===0&&t._stochasticDepth.length===0}function Hn(n){let t=this;if(_e.call(this),t._adjDirty&&ls.call(this),!t._connWeights||!t._connFrom||!t._connTo||!t._outStart||!t._outOrder)return this.activate(n,!1);t._topoDirty&&this._computeTopoOrder(),t._nodeIndexDirty&&$n.call(this);let e=t._topoOrder||this.nodes,i=this.nodes.length,o=t._activationPrecision==="f32";(!t._fastA||t._fastA.length!==i||o&&!(t._fastA instanceof Float32Array)||!o&&!(t._fastA instanceof Float64Array))&&(t._fastA=o?new Float32Array(i):new Float64Array(i)),(!t._fastS||t._fastS.length!==i||o&&!(t._fastS instanceof Float32Array)||!o&&!(t._fastS instanceof Float64Array))&&(t._fastS=o?new Float32Array(i):new Float64Array(i));let s=t._fastA,r=t._fastS;r.fill(0);for(let m=0;m<this.input;m++)s[m]=n[m],this.nodes[m].activation=n[m],this.nodes[m].state=0;let a=t._connWeights,c=t._connTo,l=t._outOrder,u=t._outStart;for(let m=0;m<e.length;m++){let g=e[m],w=g.index>>>0;if(w>=this.input){let b=r[w]+g.bias,A=g.squash(b);g.state=r[w],g.activation=A,s[w]=A}let M=u[w],_=u[w+1],v=s[w];for(let b=M;b<_;b++){let A=l[b];r[c[A]]+=v*a[A]}}let h=i-this.output,d=xt.acquire(this.output);for(let m=0;m<this.output;m++)d[m]=s[h+m];let f=Array.from(d);return xt.release(d),f}function qn(n){return hs.call(this,n)}var Un=Y(()=>{"use strict";oe()});function zn(n,t){let e=[...n];return t==="snip"?e.sort((i,o)=>{let s=Math.abs(i.totalDeltaWeight)||Math.abs(i.previousDeltaWeight)||0,r=Math.abs(o.totalDeltaWeight)||Math.abs(o.previousDeltaWeight)||0,a=s?Math.abs(i.weight)*s:Math.abs(i.weight),c=r?Math.abs(o.weight)*r:Math.abs(o.weight);return a-c}):e.sort((i,o)=>Math.abs(i.weight)-Math.abs(o.weight)),e}function us(n,t,e){let i=n,o=0;for(;n.connections.length<t&&o<e;){o++;let s=n.nodes[Math.floor(i._rand()*n.nodes.length)],r=n.nodes[Math.floor(i._rand()*n.nodes.length)];!s||!r||s===r||n.connections.some(a=>a.from===s&&a.to===r)||i._enforceAcyclic&&n.nodes.indexOf(s)>n.nodes.indexOf(r)||n.connect(s,r)}}function Jn(n){let t=this._pruningConfig;if(!t||n<t.start||n>t.end||t.lastPruneIter!=null&&n===t.lastPruneIter||(n-t.start)%(t.frequency||1)!==0)return;let e=this._initialConnectionCount;if(!e)return;let i=(n-t.start)/Math.max(1,t.end-t.start),o=t.targetSparsity*Math.min(1,Math.max(0,i)),s=Math.max(1,Math.floor(e*(1-o))),r=this.connections.length-s;if(r<=0){t.lastPruneIter=n;return}let c=zn(this.connections,t.method||"magnitude").slice(0,r);if(c.forEach(l=>this.disconnect(l.from,l.to)),t.regrowFraction&&t.regrowFraction>0){let l=Math.floor(c.length*t.regrowFraction);us(this,s,l*10)}t.lastPruneIter=n,this._topoDirty=!0}function Vn(n,t="magnitude"){if(n<=0)return;n>=1&&(n=.999);let e=this;e._evoInitialConnCount||(e._evoInitialConnCount=this.connections.length);let i=e._evoInitialConnCount,o=Math.max(1,Math.floor(i*(1-n))),s=this.connections.length-o;if(s<=0)return;zn(this.connections,t).slice(0,s).forEach(c=>this.disconnect(c.from,c.to)),e._topoDirty=!0}function Kn(){let n=this._initialConnectionCount;return n?1-this.connections.length/n:0}var Xn=Y(()=>{"use strict"});function Yn(n,t){if(!this.nodes.includes(n))throw new Error("Gating node must be part of the network to gate a connection!");if(t.gater){at.warnings&&console.warn("Connection is already gated. Skipping.");return}n.gate(t),this.gates.push(t)}function Zn(n){var t;let e=this.gates.indexOf(n);if(e===-1){at.warnings&&console.warn("Attempted to ungate a connection not in the gates list.");return}this.gates.splice(e,1),(t=n.gater)===null||t===void 0||t.ungate(n)}var Qn=Y(()=>{"use strict";me();Dt()});function ti(n){this._rngState=n>>>0,this._rand=()=>{this._rngState=this._rngState+1831565813>>>0;let t=Math.imul(this._rngState^this._rngState>>>15,1|this._rngState);return t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}function ei(){return{step:this._trainingStep,state:this._rngState}}function ni(n){this._rand=n,this._rngState=void 0}function ii(){return this._rngState}function oi(n){typeof n=="number"&&(this._rngState=n>>>0)}var si=Y(()=>{"use strict"});function ds(n){try{return globalThis.structuredClone?globalThis.structuredClone(n):JSON.parse(JSON.stringify(n))}catch{return JSON.parse(JSON.stringify(n))}}function ri(){let n=this._lastStats;return n?ds(n):null}var ai=Y(()=>{"use strict"});function ci(n){let t=this,e=this.nodes.indexOf(n);if(e===-1)throw new Error("Node not in network");if(n.type==="input"||n.type==="output")throw new Error("Cannot remove input or output node from the network.");this.gates=this.gates.filter(s=>s.gater===n?(s.gater=null,!1):!0);let i=n.connections.in.slice(),o=n.connections.out.slice();i.forEach(s=>this.disconnect(s.from,s.to)),o.forEach(s=>this.disconnect(s.from,s.to)),n.connections.self.slice().forEach(()=>this.disconnect(n,n)),this.nodes.splice(e,1),i.forEach(s=>{o.forEach(r=>{if(!s.from||!r.to||s.from===r.to)return;this.connections.some(c=>c.from===s.from&&c.to===r.to)||this.connect(s.from,r.to)})}),t._topoDirty=!0,t._nodeIndexDirty=!0,t._slabDirty=!0,t._adjDirty=!0}var li=Y(()=>{"use strict"});function hi(n,t,e){if(this._enforceAcyclic&&this.nodes.indexOf(n)>this.nodes.indexOf(t))return[];let i=n.connect(t,e);for(let o of i)if(n!==t)this.connections.push(o);else{if(this._enforceAcyclic)continue;this.selfconns.push(o)}return i.length&&(this._topoDirty=!0,this._slabDirty=!0),i}function ui(n,t){let e=n===t?this.selfconns:this.connections;for(let i=0;i<e.length;i++){let o=e[i];if(o.from===n&&o.to===t){o.gater&&this.ungate(o),e.splice(i,1);break}}n.disconnect(t),this._topoDirty=!0,this._slabDirty=!0}var di=Y(()=>{"use strict"});function pi(){this.nodes.forEach((r,a)=>r.index=a);let n=this.nodes.map(r=>r.activation),t=this.nodes.map(r=>r.state),e=this.nodes.map(r=>r.squash.name),i=this.connections.concat(this.selfconns).map(r=>({from:r.from.index,to:r.to.index,weight:r.weight,gater:r.gater?r.gater.index:null})),o=this.input,s=this.output;return[n,t,e,i,o,s]}function fi(n,t,e){let[i,o,s,r,a,c]=n,l=typeof t=="number"?t:a||0,u=typeof e=="number"?e:c||0,h=new(At(),ct($t)).default(l,u);return h.nodes=[],h.connections=[],h.selfconns=[],h.gates=[],i.forEach((d,f)=>{let m;f<l?m="input":f>=i.length-u?m="output":m="hidden";let g=new pt(m);g.activation=d,g.state=o[f];let w=s[f];st[w]||console.warn(`Unknown squash function '${String(w)}' encountered during deserialize. Falling back to identity.`),g.squash=st[w]||st.identity,g.index=f,h.nodes.push(g)}),r.forEach(d=>{if(d.from<h.nodes.length&&d.to<h.nodes.length){let f=h.nodes[d.from],m=h.nodes[d.to],g=h.connect(f,m,d.weight)[0];g&&d.gater!=null&&(d.gater<h.nodes.length?h.gate(h.nodes[d.gater],g):console.warn("Invalid gater index encountered during deserialize; skipping gater assignment."))}else console.warn("Invalid connection indices encountered during deserialize; skipping connection.")}),h}function mi(){let n={formatVersion:2,input:this.input,output:this.output,dropout:this.dropout,nodes:[],connections:[]};return this.nodes.forEach((t,e)=>{if(t.index=e,n.nodes.push({type:t.type,bias:t.bias,squash:t.squash.name,index:e,geneId:t.geneId}),t.connections.self.length>0){let i=t.connections.self[0];n.connections.push({from:e,to:e,weight:i.weight,gater:i.gater?i.gater.index:null,enabled:i.enabled!==!1})}}),this.connections.forEach(t=>{typeof t.from.index!="number"||typeof t.to.index!="number"||n.connections.push({from:t.from.index,to:t.to.index,weight:t.weight,gater:t.gater?t.gater.index:null,enabled:t.enabled!==!1})}),n}function gi(n){if(!n||typeof n!="object")throw new Error("Invalid JSON for network.");n.formatVersion!==2&&console.warn("fromJSONImpl: Unknown formatVersion, attempting import.");let t=new(At(),ct($t)).default(n.input,n.output);return t.dropout=n.dropout||0,t.nodes=[],t.connections=[],t.selfconns=[],t.gates=[],n.nodes.forEach((e,i)=>{let o=new pt(e.type);o.bias=e.bias,o.squash=st[e.squash]||st.identity,o.index=i,typeof e.geneId=="number"&&(o.geneId=e.geneId),t.nodes.push(o)}),n.connections.forEach(e=>{if(typeof e.from!="number"||typeof e.to!="number")return;let i=t.nodes[e.from],o=t.nodes[e.to],s=t.connect(i,o,e.weight)[0];s&&e.gater!=null&&typeof e.gater=="number"&&t.nodes[e.gater]&&t.gate(t.nodes[e.gater],s),s&&typeof e.enabled<"u"&&(s.enabled=e.enabled)}),t}var _i=Y(()=>{"use strict";Nt();Bt();Mt()});function yi(n,t,e=!1){if(n.input!==t.input||n.output!==t.output)throw new Error("Parent networks must have the same input and output sizes for crossover.");let i=new(At(),ct($t)).default(n.input,n.output);i.connections=[],i.nodes=[],i.selfconns=[],i.gates=[];let o=n.score||0,s=t.score||0,r=n.nodes.length,a=t.nodes.length,c;if(e||o===s){let g=Math.max(r,a),w=Math.min(r,a);c=Math.floor(Math.random()*(g-w+1)+w)}else c=o>s?r:a;let l=n.output;n.nodes.forEach((g,w)=>g.index=w),t.nodes.forEach((g,w)=>g.index=w);for(let g=0;g<c;g++){let w,M=g<r?n.nodes[g]:void 0,_=g<a?t.nodes[g]:void 0;if(g<n.input)w=M;else if(g>=c-l){let v=r-(c-g),b=a-(c-g),A=v>=n.input&&v<r?n.nodes[v]:void 0,p=b>=t.input&&b<a?t.nodes[b]:void 0;A&&p?w=(n._rand||Math.random)()>=.5?A:p:w=A||p}else M&&_?w=(n._rand||Math.random)()>=.5?M:_:M&&(o>=s||e)?w=M:_&&(s>=o||e)&&(w=_);if(w){let v=new pt(w.type);v.bias=w.bias,v.squash=w.squash,i.nodes.push(v)}}i.nodes.forEach((g,w)=>g.index=w);let u={},h={};n.connections.concat(n.selfconns).forEach(g=>{typeof g.from.index=="number"&&typeof g.to.index=="number"&&(u[Ot.innovationID(g.from.index,g.to.index)]={weight:g.weight,from:g.from.index,to:g.to.index,gater:g.gater?g.gater.index:-1,enabled:g.enabled!==!1})}),t.connections.concat(t.selfconns).forEach(g=>{typeof g.from.index=="number"&&typeof g.to.index=="number"&&(h[Ot.innovationID(g.from.index,g.to.index)]={weight:g.weight,from:g.from.index,to:g.to.index,gater:g.gater?g.gater.index:-1,enabled:g.enabled!==!1})});let d=[];Object.keys(u).forEach(g=>{var w,M,_;let v=u[g];if(h[g]){let b=h[g],A=(n._rand||Math.random)()>=.5?v:b;if(v.enabled===!1||b.enabled===!1){let p=(M=(w=n._reenableProb)!==null&&w!==void 0?w:t._reenableProb)!==null&&M!==void 0?M:.25;A.enabled=Math.random()<p}d.push(A),delete h[g]}else if(o>=s||e){if(v.enabled===!1){let b=(_=n._reenableProb)!==null&&_!==void 0?_:.25;v.enabled=Math.random()<b}d.push(v)}}),(s>=o||e)&&Object.keys(h).forEach(g=>{var w;let M=h[g];if(M.enabled===!1){let _=(w=t._reenableProb)!==null&&w!==void 0?w:.25;M.enabled=Math.random()<_}d.push(M)});let m=i.nodes.length;return d.forEach(g=>{if(g.from<m&&g.to<m){let w=i.nodes[g.from],M=i.nodes[g.to];if(g.from>=g.to)return;if(!w.isProjectingTo(M)){let _=i.connect(w,M)[0];_&&(_.weight=g.weight,_.enabled=g.enabled!==!1,g.gater!==-1&&g.gater<m&&i.gate(i.nodes[g.gater],_))}}}),i}var vi=Y(()=>{"use strict";Nt();Bt()});var ye={};vt(ye,{activateBatch:()=>ms,activateRaw:()=>fs,noTraceActivate:()=>ps});function ps(n){let t=this;if(t._enforceAcyclic&&t._topoDirty&&this._computeTopoOrder(),!Array.isArray(n)||n.length!==this.input)throw new Error(`Input size mismatch: expected ${this.input}, got ${n?n.length:"undefined"}`);if(this._canUseFastSlab(!1))try{return this._fastSlabActivate(n)}catch{}let e=xt.acquire(this.output),i=0;this.nodes.forEach((s,r)=>{s.type==="input"?s.noTraceActivate(n[r]):s.type==="output"?e[i++]=s.noTraceActivate():s.noTraceActivate()});let o=Array.from(e);return xt.release(e),o}function fs(n,t=!1,e=1e3){return this._reuseActivationArrays?this.activate(n,t,e):this.activate(n,t,e)}function ms(n,t=!1){if(!Array.isArray(n))throw new Error("inputs must be an array of input arrays");let e=new Array(n.length);for(let i=0;i<n.length;i++){let o=n[i];if(!Array.isArray(o)||o.length!==this.input)throw new Error(`Input[${i}] size mismatch: expected ${this.input}, got ${o?o.length:"undefined"}`);e[i]=this.activate(o,t)}return e}var ve=Y(()=>{"use strict";oe()});var mt,be=Y(()=>{"use strict";Nt();Jt();Dt();Mt();mt=class n{constructor(t){this.nodes=[],this.connections={in:[],out:[],self:[]};for(let e=0;e<t;e++)this.nodes.push(new pt)}activate(t){let e=[];if(t!==void 0&&t.length!==this.nodes.length)throw new Error("Array with values should be same as the amount of nodes!");for(let i=0;i<this.nodes.length;i++){let o=t===void 0?this.nodes[i].activate():this.nodes[i].activate(t[i]);e.push(o)}return e}propagate(t,e,i){if(i!==void 0&&i.length!==this.nodes.length)throw new Error("Array with values should be same as the amount of nodes!");for(let o=this.nodes.length-1;o>=0;o--)i===void 0?this.nodes[o].propagate(t,e,!0,0):this.nodes[o].propagate(t,e,!0,0,i[o])}connect(t,e,i){let o=[],s,r;if(t instanceof n){if(e===void 0&&(this!==t?(at.warnings&&console.warn("No group connection specified, using ALL_TO_ALL by default."),e=ut.ALL_TO_ALL):(at.warnings&&console.warn("Connecting group to itself, using ONE_TO_ONE by default."),e=ut.ONE_TO_ONE)),e===ut.ALL_TO_ALL||e===ut.ALL_TO_ELSE)for(s=0;s<this.nodes.length;s++)for(r=0;r<t.nodes.length;r++){if(e===ut.ALL_TO_ELSE&&this.nodes[s]===t.nodes[r])continue;let a=this.nodes[s].connect(t.nodes[r],i);this.connections.out.push(a[0]),t.connections.in.push(a[0]),o.push(a[0])}else if(e===ut.ONE_TO_ONE){if(this.nodes.length!==t.nodes.length)throw new Error("Cannot create ONE_TO_ONE connection: source and target groups must have the same size.");for(s=0;s<this.nodes.length;s++){let a=this.nodes[s].connect(t.nodes[s],i);this===t?this.connections.self.push(a[0]):(this.connections.out.push(a[0]),t.connections.in.push(a[0])),o.push(a[0])}}}else if(t instanceof Pt)o=t.input(this,e,i);else if(t instanceof pt)for(s=0;s<this.nodes.length;s++){let a=this.nodes[s].connect(t,i);this.connections.out.push(a[0]),o.push(a[0])}return o}gate(t,e){if(e===void 0)throw new Error("Please specify a gating method: Gating.INPUT, Gating.OUTPUT, or Gating.SELF");Array.isArray(t)||(t=[t]);let i=[],o=[],s,r;for(s=0;s<t.length;s++){let a=t[s];i.includes(a.from)||i.push(a.from),o.includes(a.to)||o.push(a.to)}switch(e){case St.INPUT:for(let a=0;a<t.length;a++){let c=t[a];this.nodes[a%this.nodes.length].gate(c)}break;case St.OUTPUT:for(s=0;s<i.length;s++){let a=i[s],c=this.nodes[s%this.nodes.length];for(r=0;r<a.connections.out.length;r++){let l=a.connections.out[r];t.includes(l)&&c.gate(l)}}break;case St.SELF:for(s=0;s<i.length;s++){let a=i[s],c=this.nodes[s%this.nodes.length],l=Array.isArray(a.connections.self)?a.connections.self[0]:a.connections.self;t.includes(l)&&c.gate(l)}break}}set(t){for(let e=0;e<this.nodes.length;e++)t.bias!==void 0&&(this.nodes[e].bias=t.bias),this.nodes[e].squash=t.squash||this.nodes[e].squash,this.nodes[e].type=t.type||this.nodes[e].type}disconnect(t,e=!1){let i,o,s;if(t instanceof n)for(i=0;i<this.nodes.length;i++)for(o=0;o<t.nodes.length;o++){for(this.nodes[i].disconnect(t.nodes[o],e),s=this.connections.out.length-1;s>=0;s--){let r=this.connections.out[s];if(r.from===this.nodes[i]&&r.to===t.nodes[o]){this.connections.out.splice(s,1);break}}if(e){for(s=this.connections.in.length-1;s>=0;s--){let r=this.connections.in[s];if(r.from===t.nodes[o]&&r.to===this.nodes[i]){this.connections.in.splice(s,1);break}}for(s=t.connections.out.length-1;s>=0;s--){let r=t.connections.out[s];if(r.from===t.nodes[o]&&r.to===this.nodes[i]){t.connections.out.splice(s,1);break}}for(s=t.connections.in.length-1;s>=0;s--){let r=t.connections.in[s];if(r.from===this.nodes[i]&&r.to===t.nodes[o]){t.connections.in.splice(s,1);break}}}}else if(t instanceof pt)for(i=0;i<this.nodes.length;i++){for(this.nodes[i].disconnect(t,e),o=this.connections.out.length-1;o>=0;o--){let r=this.connections.out[o];if(r.from===this.nodes[i]&&r.to===t){this.connections.out.splice(o,1);break}}if(e)for(o=this.connections.in.length-1;o>=0;o--){let r=this.connections.in[o];if(r.from===t&&r.to===this.nodes[i]){this.connections.in.splice(o,1);break}}}}clear(){for(let t=0;t<this.nodes.length;t++)this.nodes[t].clear()}toJSON(){return{size:this.nodes.length,nodeIndices:this.nodes.map(t=>t.index),connections:{in:this.connections.in.length,out:this.connections.out.length,self:this.connections.self.length}}}}});var He={};vt(He,{default:()=>Pt});var Pt,Jt=Y(()=>{"use strict";Nt();be();Mt();oe();Pt=class n{constructor(){this.dropout=0,this.output=null,this.nodes=[],this.connections={in:[],out:[],self:[]}}activate(t,e=!1){let i=xt.acquire(this.nodes.length);if(t!==void 0&&t.length!==this.nodes.length)throw new Error("Array with values should be same as the amount of nodes!");let o=1;e&&this.dropout>0?(o=Math.random()>=this.dropout?1:0,this.nodes.forEach(r=>{r.mask=o})):this.nodes.forEach(r=>{r.mask=1});for(let r=0;r<this.nodes.length;r++){let a;t===void 0?a=this.nodes[r].activate():a=this.nodes[r].activate(t[r]),i[r]=a}let s=Array.from(i);return xt.release(i),s}propagate(t,e,i){if(i!==void 0&&i.length!==this.nodes.length)throw new Error("Array with values should be same as the amount of nodes!");for(let o=this.nodes.length-1;o>=0;o--)i===void 0?this.nodes[o].propagate(t,e,!0,0):this.nodes[o].propagate(t,e,!0,0,i[o])}connect(t,e,i){if(!this.output)throw new Error("Layer output is not defined. Cannot connect from this layer.");let o=[];return t instanceof n?o=t.input(this,e,i):(t instanceof mt||t instanceof pt)&&(o=this.output.connect(t,e,i)),o}gate(t,e){if(!this.output)throw new Error("Layer output is not defined. Cannot gate from this layer.");this.output.gate(t,e)}set(t){for(let e=0;e<this.nodes.length;e++){let i=this.nodes[e];i instanceof pt?(t.bias!==void 0&&(i.bias=t.bias),i.squash=t.squash||i.squash,i.type=t.type||i.type):this.isGroup(i)&&i.set(t)}}disconnect(t,e){e=e||!1;let i,o,s;if(t instanceof mt)for(i=0;i<this.nodes.length;i++)for(o=0;o<t.nodes.length;o++){for(this.nodes[i].disconnect(t.nodes[o],e),s=this.connections.out.length-1;s>=0;s--){let r=this.connections.out[s];if(r.from===this.nodes[i]&&r.to===t.nodes[o]){this.connections.out.splice(s,1);break}}if(e)for(s=this.connections.in.length-1;s>=0;s--){let r=this.connections.in[s];if(r.from===t.nodes[o]&&r.to===this.nodes[i]){this.connections.in.splice(s,1);break}}}else if(t instanceof pt)for(i=0;i<this.nodes.length;i++){for(this.nodes[i].disconnect(t,e),o=this.connections.out.length-1;o>=0;o--){let r=this.connections.out[o];if(r.from===this.nodes[i]&&r.to===t){this.connections.out.splice(o,1);break}}if(e)for(s=this.connections.in.length-1;s>=0;s--){let r=this.connections.in[s];if(r.from===t&&r.to===this.nodes[i]){this.connections.in.splice(s,1);break}}}}clear(){for(let t=0;t<this.nodes.length;t++)this.nodes[t].clear()}input(t,e,i){if(t instanceof n&&(t=t.output),e=e||ut.ALL_TO_ALL,!this.output)throw new Error("Layer output (acting as input target) is not defined.");return t.connect(this.output,e,i)}static dense(t){let e=new n,i=new mt(t);return e.nodes.push(...i.nodes),e.output=i,e.input=(o,s,r)=>(o instanceof n&&(o=o.output),s=s||ut.ALL_TO_ALL,o.connect(i,s,r)),e}static lstm(t){let e=new n,i=new mt(t),o=new mt(t),s=new mt(t),r=new mt(t),a=new mt(t);i.set({bias:1}),o.set({bias:1}),r.set({bias:1}),s.set({bias:0}),a.set({bias:0}),s.connect(i,ut.ALL_TO_ALL),s.connect(o,ut.ALL_TO_ALL),s.connect(r,ut.ALL_TO_ALL),s.connect(s,ut.ONE_TO_ONE);let c=s.connect(a,ut.ALL_TO_ALL);return r.gate(c,St.OUTPUT),s.nodes.forEach((l,u)=>{let h=l.connections.self.find(d=>d.to===l&&d.from===l);h?(h.gater=o.nodes[u],o.nodes[u].connections.gated.includes(h)||o.nodes[u].connections.gated.push(h)):console.warn(`LSTM Warning: No self-connection found for memory cell node ${u}`)}),e.nodes=[...i.nodes,...o.nodes,...s.nodes,...r.nodes,...a.nodes],e.output=a,e.input=(l,u,h)=>{l instanceof n&&(l=l.output),u=u||ut.ALL_TO_ALL;let d=[],f=l.connect(s,u,h);return d=d.concat(f),d=d.concat(l.connect(i,u,h)),d=d.concat(l.connect(r,u,h)),d=d.concat(l.connect(o,u,h)),i.gate(f,St.INPUT),d},e}static gru(t){let e=new n,i=new mt(t),o=new mt(t),s=new mt(t),r=new mt(t),a=new mt(t),c=new mt(t);c.set({bias:0,squash:st.identity,type:"variant"}),r.set({squash:st.tanh}),o.set({bias:0,squash:st.inverse,type:"variant"}),i.set({bias:1}),s.set({bias:0}),c.connect(i,ut.ALL_TO_ALL),c.connect(s,ut.ALL_TO_ALL),i.connect(o,ut.ONE_TO_ONE,1);let l=c.connect(r,ut.ALL_TO_ALL);s.gate(l,St.OUTPUT);let u=c.connect(a,ut.ALL_TO_ALL),h=r.connect(a,ut.ALL_TO_ALL);return i.gate(u,St.OUTPUT),o.gate(h,St.OUTPUT),a.connect(c,ut.ONE_TO_ONE,1),e.nodes=[...i.nodes,...o.nodes,...s.nodes,...r.nodes,...a.nodes,...c.nodes],e.output=a,e.input=(d,f,m)=>{d instanceof n&&(d=d.output),f=f||ut.ALL_TO_ALL;let g=[];return g=g.concat(d.connect(i,f,m)),g=g.concat(d.connect(s,f,m)),g=g.concat(d.connect(r,f,m)),g},e}static memory(t,e){let i=new n,o=null;for(let r=0;r<e;r++){let a=new mt(t);a.set({squash:st.identity,bias:0,type:"variant"}),o?.connect(a,ut.ONE_TO_ONE,1),i.nodes.push(a),o=a}i.nodes.reverse();let s=new mt(0);for(let r of i.nodes)this.prototype.isGroup(r)?s.nodes=s.nodes.concat(r.nodes):console.warn("Unexpected Node type found directly in Memory layer nodes list during output group creation.");return i.output=s,i.input=(r,a,c)=>{r instanceof n&&(r=r.output),a=a||ut.ALL_TO_ALL;let l=i.nodes[i.nodes.length-1];if(!this.prototype.isGroup(l))throw new Error("Memory layer input block is not a Group.");if(r.nodes.length!==l.nodes.length)throw new Error(`Previous layer size (${r.nodes.length}) must be same as memory size (${l.nodes.length})`);return r.connect(l,ut.ONE_TO_ONE,1)},i}static batchNorm(t){let e=n.dense(t);e.batchNorm=!0;let i=e.activate.bind(e);return e.activate=function(o,s=!1){let r=i(o,s),a=r.reduce((u,h)=>u+h,0)/r.length,c=r.reduce((u,h)=>u+Math.pow(h-a,2),0)/r.length,l=(Ft(),ct(We)).NORM_EPSILON;return r.map(u=>(u-a)/Math.sqrt(c+l))},e}static layerNorm(t){let e=n.dense(t);e.layerNorm=!0;let i=e.activate.bind(e);return e.activate=function(o,s=!1){let r=i(o,s),a=r.reduce((u,h)=>u+h,0)/r.length,c=r.reduce((u,h)=>u+Math.pow(h-a,2),0)/r.length,l=(Ft(),ct(We)).NORM_EPSILON;return r.map(u=>(u-a)/Math.sqrt(c+l))},e}static conv1d(t,e,i=1,o=0){let s=new n;return s.nodes=Array.from({length:t},()=>new pt),s.output=new mt(t),s.conv1d={kernelSize:e,stride:i,padding:o},s.activate=function(r){return r?r.slice(0,t):this.nodes.map(a=>a.activate())},s}static attention(t,e=1){let i=new n;return i.nodes=Array.from({length:t},()=>new pt),i.output=new mt(t),i.attention={heads:e},i.activate=function(o){if(!o)return this.nodes.map(r=>r.activate());let s=o.reduce((r,a)=>r+a,0)/o.length;return Array(t).fill(s)},i}isGroup(t){return!!t&&typeof t.set=="function"&&Array.isArray(t.nodes)}}});var bi={};vt(bi,{mutateImpl:()=>_s});function _s(n){var t,e;if(n==null)throw new Error("No (correct) mutate method given!");let i;if(typeof n=="string"?i=n:i=(e=(t=n?.name)!==null&&t!==void 0?t:n?.type)!==null&&e!==void 0?e:n?.identity,!i){for(let s in zt)if(n===zt[s]){i=s;break}}let o=i?gs[i]:void 0;if(!o){at.warnings&&console.warn("[mutate] Unknown mutation method ignored:",i);return}o.call(this,n),this._topoDirty=!0}function ys(){let n=this;if(n._enforceAcyclic&&(n._topoDirty=!0),at.deterministicChainMode){let c=this.nodes.find(v=>v.type==="input"),l=this.nodes.find(v=>v.type==="output");if(!c||!l)return;n._detChain||(this.connections.some(v=>v.from===c&&v.to===l)||this.connect(c,l),n._detChain=[c]);let u=n._detChain,h=u[u.length-1],d=this.connections.find(v=>v.from===h&&v.to===l);d||(d=this.connect(h,l)[0]);let f=d.gater;this.disconnect(d.from,d.to);let m=new pt("hidden",void 0,n._rand);m.mutate(zt.MOD_ACTIVATION);let g=this.nodes.indexOf(l),w=Math.min(g,this.nodes.length-this.output);this.nodes.splice(w,0,m),n._nodeIndexDirty=!0;let M=this.connect(h,m)[0],_=this.connect(m,l)[0];u.push(m),n._preferredChainEdge=_,f&&this.gate(f,n._rand()>=.5?M:_);for(let v=0;v<u.length;v++){let b=u[v],A=v+1<u.length?u[v+1]:l,p=b.connections.out.find(S=>S.to===A);if(p){for(let S of b.connections.out.slice())if(S!==p)try{this.disconnect(S.from,S.to)}catch{}}}return}if(this.connections.length===0){let c=this.nodes.find(u=>u.type==="input"),l=this.nodes.find(u=>u.type==="output");if(c&&l)this.connect(c,l);else return}let t=this.connections[Math.floor(n._rand()*this.connections.length)];if(!t)return;let e=t.gater;this.disconnect(t.from,t.to);let i=new pt("hidden",void 0,n._rand);i.mutate(zt.MOD_ACTIVATION);let o=this.nodes.indexOf(t.to),s=Math.min(o,this.nodes.length-this.output);this.nodes.splice(s,0,i),n._nodeIndexDirty=!0;let r=this.connect(t.from,i)[0],a=this.connect(i,t.to)[0];n._preferredChainEdge=a,e&&this.gate(e,n._rand()>=.5?r:a)}function vs(){let n=this.nodes.filter(o=>o.type==="hidden");if(n.length===0){at.warnings&&console.warn("No hidden nodes left to remove!");return}let e=n[Math.floor(this._rand()*n.length)];this.remove(e);let i=this.connections[0];i&&(i.weight+=1e-4)}function bs(){let n=this;n._enforceAcyclic&&(n._topoDirty=!0);let t=[];for(let i=0;i<this.nodes.length-this.output;i++){let o=this.nodes[i];for(let s=Math.max(i+1,this.input);s<this.nodes.length;s++){let r=this.nodes[s];o.isProjectingTo(r)||t.push([o,r])}}if(t.length===0)return;let e=t[Math.floor(n._rand()*t.length)];this.connect(e[0],e[1])}function ws(){let n=this,t=this.connections.filter(i=>{let o=i.from.connections.out.length>1,s=i.to.connections.in.length>1,r=this.nodes.filter(c=>c.type===i.to.type&&Math.abs(this.nodes.indexOf(c)-this.nodes.indexOf(i.to))<Math.max(this.input,this.output)),a=!1;return r.length>0&&this.connections.filter(l=>l.from===i.from&&r.includes(l.to)).length<=1&&(a=!0),o&&s&&this.nodes.indexOf(i.to)>this.nodes.indexOf(i.from)&&!a});if(t.length===0)return;let e=t[Math.floor(n._rand()*t.length)];this.disconnect(e.from,e.to)}function Ms(n){let t=this.connections.concat(this.selfconns);if(t.length===0)return;let e=t[Math.floor(this._rand()*t.length)],i=this._rand()*(n.max-n.min)+n.min;e.weight+=i}function xs(n){if(this.nodes.length<=this.input)return;let t=Math.floor(this._rand()*(this.nodes.length-this.input)+this.input);this.nodes[t].mutate(n)}function Ss(n){var t;let e=(t=n.mutateOutput)!==null&&t!==void 0?t:!0,i=this.nodes.length-this.input-(e?0:this.output);if(i<=0){at.warnings&&console.warn("No nodes available for activation function mutation based on config.");return}let o=Math.floor(this._rand()*i+this.input);this.nodes[o].mutate(n)}function Ns(){let n=this;if(n._enforceAcyclic)return;let t=this.nodes.filter((i,o)=>o>=this.input&&i.connections.self.length===0);if(t.length===0){at.warnings&&console.warn("All eligible nodes already have self-connections.");return}let e=t[Math.floor(n._rand()*t.length)];this.connect(e,e)}function As(){if(this.selfconns.length===0){at.warnings&&console.warn("No self-connections exist to remove.");return}let n=this.selfconns[Math.floor(this._rand()*this.selfconns.length)];this.disconnect(n.from,n.to)}function Os(){let n=this,e=this.connections.concat(this.selfconns).filter(r=>r.gater===null);if(e.length===0||this.nodes.length<=this.input){at.warnings&&console.warn("All connections are already gated.");return}let i=Math.floor(n._rand()*(this.nodes.length-this.input)+this.input),o=this.nodes[i],s=e[Math.floor(n._rand()*e.length)];this.gate(o,s)}function Es(){if(this.gates.length===0){at.warnings&&console.warn("No gated connections to ungate.");return}let n=Math.floor(this._rand()*this.gates.length),t=this.gates[n];this.ungate(t)}function Cs(){let n=this;if(n._enforceAcyclic)return;let t=[];for(let i=this.input;i<this.nodes.length;i++){let o=this.nodes[i];for(let s=this.input;s<i;s++){let r=this.nodes[s];o.isProjectingTo(r)||t.push([o,r])}}if(t.length===0)return;let e=t[Math.floor(n._rand()*t.length)];this.connect(e[0],e[1])}function Is(){let n=this.connections.filter(e=>e.from.connections.out.length>1&&e.to.connections.in.length>1&&this.nodes.indexOf(e.from)>this.nodes.indexOf(e.to));if(n.length===0)return;let t=n[Math.floor(this._rand()*n.length)];this.disconnect(t.from,t.to)}function Ts(n){var t;let e=this,i=(t=n.mutateOutput)!==null&&t!==void 0?t:!0,o=this.nodes.length-this.input-(i?0:this.output);if(o<2)return;let s=Math.floor(e._rand()*o+this.input),r=Math.floor(e._rand()*o+this.input);for(;s===r;)r=Math.floor(e._rand()*o+this.input);let a=this.nodes[s],c=this.nodes[r],l=a.bias,u=a.squash;a.bias=c.bias,a.squash=c.squash,c.bias=l,c.squash=u}function Ds(){if(this._enforceAcyclic||this.connections.length===0)return;let t=this.connections[Math.floor(Math.random()*this.connections.length)],e=t.gater;this.disconnect(t.from,t.to);let o=(Jt(),ct(He)).default.lstm(1);o.nodes.forEach(s=>{s.type="hidden",this.nodes.push(s)}),this.connect(t.from,o.nodes[0]),this.connect(o.output.nodes[0],t.to),e&&this.gate(e,this.connections[this.connections.length-1])}function ks(){if(this._enforceAcyclic||this.connections.length===0)return;let t=this.connections[Math.floor(Math.random()*this.connections.length)],e=t.gater;this.disconnect(t.from,t.to);let o=(Jt(),ct(He)).default.gru(1);o.nodes.forEach(s=>{s.type="hidden",this.nodes.push(s)}),this.connect(t.from,o.nodes[0]),this.connect(o.output.nodes[0],t.to),e&&this.gate(e,this.connections[this.connections.length-1])}function js(n){var t,e;if(this.nodes.length<=this.input)return;let i=this,o=Math.floor(i._rand()*(this.nodes.length-this.input)+this.input),s=this.nodes[o],r=(t=n?.min)!==null&&t!==void 0?t:-1,a=(e=n?.max)!==null&&e!==void 0?e:1,c=()=>i._rand()*(a-r)+r;for(let l of s.connections.in)l.weight=c();for(let l of s.connections.out)l.weight=c();for(let l of s.connections.self)l.weight=c()}function Ls(){let n=this.nodes.filter(i=>i.type==="hidden");if(!n.length)return;let e=n[Math.floor(this._rand()*n.length)];e._batchNorm=!0}var gs,wi=Y(()=>{"use strict";Nt();me();Dt();gs={ADD_NODE:ys,SUB_NODE:vs,ADD_CONN:bs,SUB_CONN:ws,MOD_WEIGHT:Ms,MOD_BIAS:xs,MOD_ACTIVATION:Ss,ADD_SELF_CONN:Ns,SUB_SELF_CONN:As,ADD_GATE:Os,SUB_GATE:Es,ADD_BACK_CONN:Cs,SUB_BACK_CONN:Is,SWAP_NODES:Ts,ADD_LSTM_NODE:Ds,ADD_GRU_NODE:ks,REINIT_WEIGHT:js,BATCH_NORM:Ls}});var qe={};vt(qe,{__trainingInternals:()=>Ws,applyGradientClippingImpl:()=>Mi,trainImpl:()=>Us,trainSetImpl:()=>xi});function Ps(n,t,e,i){if(e.window<=1&&e.type!=="ema"&&e.type!=="adaptive-ema")return n;let o=e.type;if(o==="median"){let s=[...t].sort((a,c)=>a-c),r=Math.floor(s.length/2);return s.length%2?s[r]:(s[r-1]+s[r])/2}if(o==="ema")return i.emaValue==null?i.emaValue=n:i.emaValue=i.emaValue+e.emaAlpha*(n-i.emaValue),i.emaValue;if(o==="adaptive-ema"){let s=t.reduce((u,h)=>u+h,0)/t.length,r=t.reduce((u,h)=>u+(h-s)*(h-s),0)/t.length,a=e.emaAlpha||2/(e.window+1),c=r/Math.max(s*s,1e-8),l=Math.min(.95,Math.max(a,a*(1+2*c)));return i.adaptiveBaseEmaValue==null?(i.adaptiveBaseEmaValue=n,i.adaptiveEmaValue=n):(i.adaptiveBaseEmaValue=i.adaptiveBaseEmaValue+a*(n-i.adaptiveBaseEmaValue),i.adaptiveEmaValue=i.adaptiveEmaValue+l*(n-i.adaptiveEmaValue)),Math.min(i.adaptiveEmaValue,i.adaptiveBaseEmaValue)}if(o==="gaussian"){let s=e.window/3||1,r=0,a=0,c=t.length;for(let l=0;l<c;l++){let u=Math.exp(-.5*Math.pow((l-(c-1))/s,2));r+=u,a+=u*t[l]}return a/(r||1)}if(o==="trimmed"){let s=Math.min(.49,Math.max(0,e.trimmedRatio||.1)),r=[...t].sort((l,u)=>l-u),a=Math.floor(r.length*s),c=r.slice(a,r.length-a);return c.reduce((l,u)=>l+u,0)/(c.length||1)}if(o==="wma"){let s=0,r=0;for(let a=0;a<t.length;a++){let c=a+1;s+=c,r+=c*t[a]}return r/(s||1)}return t.reduce((s,r)=>s+r,0)/t.length}function Rs(n,t,e,i){if(e.window<=1&&e.type!=="ema")return n;if(e.type==="median"){let o=[...t].sort((r,a)=>r-a),s=Math.floor(o.length/2);return o.length%2?o[s]:(o[s-1]+o[s])/2}return e.type==="ema"?(i.plateauEmaValue==null?i.plateauEmaValue=n:i.plateauEmaValue=i.plateauEmaValue+e.emaAlpha*(n-i.plateauEmaValue),i.plateauEmaValue):t.reduce((o,s)=>o+s,0)/t.length}function Bs(n,t){if(!t._mixedPrecision.enabled)return!1;if(t._forceNextOverflow)return t._forceNextOverflow=!1,!0;let e=!1;return n.nodes.forEach(i=>{i._fp32Bias!==void 0&&(Number.isFinite(i.bias)||(e=!0))}),e}function Gs(n){n.nodes.forEach(t=>{t.connections.in.forEach(e=>{e.totalDeltaWeight=0}),t.connections.self.forEach(e=>{e.totalDeltaWeight=0}),typeof t.totalDeltaBias=="number"&&(t.totalDeltaBias=0),t.previousDeltaBias=0})}function Fs(n,t){t<=1||n.nodes.forEach(e=>{e.connections.in.forEach(i=>{typeof i.totalDeltaWeight=="number"&&(i.totalDeltaWeight/=t)}),e.connections.self.forEach(i=>{typeof i.totalDeltaWeight=="number"&&(i.totalDeltaWeight/=t)}),typeof e.totalDeltaBias=="number"&&(e.totalDeltaBias/=t)})}function $s(n,t,e,i,o){let s=0;return n.nodes.forEach(r=>{var a;r.type!=="input"&&(r.applyBatchUpdatesWithOptimizer({type:t.type,baseType:t.baseType,beta1:t.beta1,beta2:t.beta2,eps:t.eps,weightDecay:t.weightDecay,momentum:(a=t.momentum)!==null&&a!==void 0?a:i,lrScale:e,t:o._optimizerStep,la_k:t.la_k,la_alpha:t.la_alpha}),r.connections.in.forEach(c=>{typeof c.previousDeltaWeight=="number"&&(s+=c.previousDeltaWeight*c.previousDeltaWeight)}),r.connections.self.forEach(c=>{typeof c.previousDeltaWeight=="number"&&(s+=c.previousDeltaWeight*c.previousDeltaWeight)}))}),Math.sqrt(s)}function Hs(n){n._mixedPrecisionState.goodSteps++;let t=n._mpIncreaseEvery||200;n._mixedPrecisionState.goodSteps>=t&&n._mixedPrecision.lossScale<n._mixedPrecisionState.maxLossScale&&(n._mixedPrecision.lossScale*=2,n._mixedPrecisionState.goodSteps=0,n._mixedPrecisionState.scaleUpEvents=(n._mixedPrecisionState.scaleUpEvents||0)+1)}function qs(n){n._mixedPrecisionState.badSteps++,n._mixedPrecisionState.goodSteps=0,n._mixedPrecision.lossScale=Math.max(n._mixedPrecisionState.minLossScale,Math.floor(n._mixedPrecision.lossScale/2)||1),n._mixedPrecisionState.overflowCount=(n._mixedPrecisionState.overflowCount||0)+1,n._mixedPrecisionState.scaleDownEvents=(n._mixedPrecisionState.scaleDownEvents||0)+1,n._lastOverflowStep=n._optimizerStep}function Mi(n,t){let e=n,o=(()=>{let a=[];if(t.mode.startsWith("layerwise"))if(n.layers&&n.layers.length>0)for(let c=0;c<n.layers.length;c++){let l=n.layers[c];if(!l||!l.nodes)continue;let u=[];l.nodes.forEach(h=>{!h||h.type==="input"||(h.connections.in.forEach(d=>{typeof d.totalDeltaWeight=="number"&&u.push(d.totalDeltaWeight)}),h.connections.self.forEach(d=>{typeof d.totalDeltaWeight=="number"&&u.push(d.totalDeltaWeight)}),typeof h.totalDeltaBias=="number"&&u.push(h.totalDeltaBias))}),u.length&&a.push(u)}else n.nodes.forEach(c=>{if(c.type==="input")return;let l=[];c.connections.in.forEach(u=>{typeof u.totalDeltaWeight=="number"&&l.push(u.totalDeltaWeight)}),c.connections.self.forEach(u=>{typeof u.totalDeltaWeight=="number"&&l.push(u.totalDeltaWeight)}),typeof c.totalDeltaBias=="number"&&l.push(c.totalDeltaBias),l.length&&a.push(l)});else{let c=[];n.nodes.forEach(l=>{l.connections.in.forEach(u=>{typeof u.totalDeltaWeight=="number"&&c.push(u.totalDeltaWeight)}),l.connections.self.forEach(u=>{typeof u.totalDeltaWeight=="number"&&c.push(u.totalDeltaWeight)}),typeof l.totalDeltaBias=="number"&&c.push(l.totalDeltaBias)}),c.length&&a.push(c)}return a})();e._lastGradClipGroupCount=o.length;let s=(a,c)=>{if(!a.length)return 0;let l=[...a].sort((h,d)=>Math.abs(h)-Math.abs(d)),u=Math.min(l.length-1,Math.max(0,Math.floor(c/100*l.length-1)));return Math.abs(l[u])},r=a=>{let c=0;n.nodes.forEach(l=>{if(t.mode.startsWith("layerwise")&&l.type==="input")return;let u=t.mode.startsWith("layerwise")?o[c++]:o[0];l.connections.in.forEach(h=>{typeof h.totalDeltaWeight=="number"&&(h.totalDeltaWeight=a(h.totalDeltaWeight,u))}),l.connections.self.forEach(h=>{typeof h.totalDeltaWeight=="number"&&(h.totalDeltaWeight=a(h.totalDeltaWeight,u))}),typeof l.totalDeltaBias=="number"&&(l.totalDeltaBias=a(l.totalDeltaBias,u))})};if(t.mode==="norm"||t.mode==="layerwiseNorm"){let a=t.maxNorm||1;o.forEach(c=>{let l=Math.sqrt(c.reduce((u,h)=>u+h*h,0));if(l>a&&l>0){let u=a/l;r((h,d)=>d===c?h*u:h)}})}else if(t.mode==="percentile"||t.mode==="layerwisePercentile"){let a=t.percentile||99;o.forEach(c=>{let l=s(c,a);l<=0||r((u,h)=>h===c&&Math.abs(u)>l?l*Math.sign(u):u)})}}function xi(n,t,e,i,o,s,r,a,c){let l=n,u=0,h=0;l._gradAccumMicroBatches=0;let d=0,f=n.nodes.filter(g=>g.type==="output"),m;typeof a=="function"?m=a:a&&typeof a.fn=="function"?m=a.fn:a&&typeof a.calculate=="function"?m=a.calculate:m=()=>0;for(let g=0;g<t.length;g++){let w=t[g],M=w.input,_=w.output;if(M.length!==n.input||_.length!==n.output){at.warnings&&console.warn(`Data point ${g} has incorrect dimensions (input: ${M.length}/${n.input}, output: ${_.length}/${n.output}), skipping.`);continue}try{let v=n.activate(M,!0);if(c&&c.type&&c.type!=="sgd"){for(let b=0;b<f.length;b++)f[b].propagate(o,s,!1,r,_[b]);for(let b=n.nodes.length-1;b>=0;b--){let A=n.nodes[b];A.type==="output"||A.type==="input"||A.propagate(o,s,!1,r)}}else{for(let b=0;b<f.length;b++)f[b].propagate(o,s,!0,r,_[b]);for(let b=n.nodes.length-1;b>=0;b--){let A=n.nodes[b];A.type==="output"||A.type==="input"||A.propagate(o,s,!0,r)}}u+=m(_,v),h++,d++}catch(v){at.warnings&&console.warn(`Error processing data point ${g} (input: ${JSON.stringify(M)}): ${v.message}. Skipping.`)}h>0&&((g+1)%e===0||g===t.length-1)&&c&&c.type&&c.type!=="sgd"&&(l._gradAccumMicroBatches++,(l._gradAccumMicroBatches%i===0||g===t.length-1)&&(l._optimizerStep=(l._optimizerStep||0)+1,Bs(n,l)?(Gs(n),l._mixedPrecision.enabled&&qs(l),l._lastGradNorm=0):(l._currentGradClip&&Mi(n,l._currentGradClip),i>1&&l._accumulationReduction==="average"&&Fs(n,i),l._lastGradNorm=$s(n,c,o,s,l),l._mixedPrecision.enabled&&Hs(l))),h=0)}return l._lastGradNorm==null&&(l._lastGradNorm=0),d>0?u/d:0}function Us(n,t,e){var i,o,s,r,a;let c=n;if(!t||t.length===0||t[0].input.length!==n.input||t[0].output.length!==n.output)throw new Error("Dataset is invalid or dimensions do not match network input/output size!");if(e=e||{},typeof e.iterations>"u"&&typeof e.error>"u")throw at.warnings&&console.warn("Missing `iterations` or `error` option."),new Error("Missing `iterations` or `error` option. Training requires a stopping condition.");at.warnings&&(typeof e.rate>"u"&&(console.warn("Missing `rate` option"),console.warn("Missing `rate` option, using default learning rate 0.3.")),typeof e.iterations>"u"&&console.warn("Missing `iterations` option. Training will run potentially indefinitely until `error` threshold is met."));let l=(i=e.error)!==null&&i!==void 0?i:-1/0,u=e.cost||Et.mse;if(typeof u!="function"&&!(typeof u=="object"&&(typeof u.fn=="function"||typeof u.calculate=="function")))throw new Error("Invalid cost function provided to Network.train.");let h=(o=e.rate)!==null&&o!==void 0?o:.3,d=e.dropout||0;if(d<0||d>=1)throw new Error("dropout must be in [0,1)");let f=e.momentum||0,m=e.batchSize||1;if(m>t.length)throw new Error("Batch size cannot be larger than the dataset length.");let g=e.accumulationSteps||1;if(c._accumulationReduction=e.accumulationReduction==="sum"?"sum":"average",g<1||!Number.isFinite(g))throw new Error("accumulationSteps must be >=1");if(e.gradientClip){let D=e.gradientClip;D.mode?c._currentGradClip={mode:D.mode,maxNorm:D.maxNorm,percentile:D.percentile}:typeof D.maxNorm=="number"?c._currentGradClip={mode:"norm",maxNorm:D.maxNorm}:typeof D.percentile=="number"&&(c._currentGradClip={mode:"percentile",percentile:D.percentile}),c._gradClipSeparateBias=!!D.separateBias}else c._currentGradClip=void 0,c._gradClipSeparateBias=!1;if(e.mixedPrecision){let D=e.mixedPrecision===!0?{lossScale:1024}:e.mixedPrecision;c._mixedPrecision.enabled=!0,c._mixedPrecision.lossScale=D.lossScale||1024;let X=D.dynamic||{};c._mixedPrecisionState.minLossScale=X.minScale||1,c._mixedPrecisionState.maxLossScale=X.maxScale||65536,c._mpIncreaseEvery=X.increaseEvery||X.stableStepsForIncrease||200,n.connections.forEach(U=>{U._fp32Weight=U.weight}),n.nodes.forEach(U=>{U.type!=="input"&&(U._fp32Bias=U.bias)})}else c._mixedPrecision.enabled=!1,c._mixedPrecision.lossScale=1,c._mpIncreaseEvery=200;let w=new Set(["sgd","rmsprop","adagrad","adam","adamw","amsgrad","adamax","nadam","radam","lion","adabelief","lookahead"]),M;if(typeof e.optimizer<"u"){if(typeof e.optimizer=="string")M={type:e.optimizer.toLowerCase()};else if(typeof e.optimizer=="object"&&e.optimizer!==null)M=Object.assign({},e.optimizer),typeof M.type=="string"&&(M.type=M.type.toLowerCase());else throw new Error("Invalid optimizer option; must be string or object");if(!w.has(M.type))throw new Error(`Unknown optimizer type: ${M.type}`);if(M.type==="lookahead"){if(M.baseType||(M.baseType="adam"),M.baseType==="lookahead")throw new Error("Nested lookahead (baseType lookahead) is not supported");if(!w.has(M.baseType))throw new Error(`Unknown baseType for lookahead: ${M.baseType}`);M.la_k=M.la_k||5,M.la_alpha=(s=M.la_alpha)!==null&&s!==void 0?s:.5}}let _=(r=e.iterations)!==null&&r!==void 0?r:Number.MAX_SAFE_INTEGER,v=Date.now(),b=1/0,A=Math.max(1,e.movingAverageWindow||1),p=e.movingAverageType||"sma",S=(()=>{if(p==="ema")return e.emaAlpha&&e.emaAlpha>0&&e.emaAlpha<=1?e.emaAlpha:2/(A+1)})(),x=Math.max(1,e.plateauMovingAverageWindow||A),y=e.plateauMovingAverageType||p,N=(()=>{if(y==="ema")return e.plateauEmaAlpha&&e.plateauEmaAlpha>0&&e.plateauEmaAlpha<=1?e.plateauEmaAlpha:2/(x+1)})(),k=e.earlyStopPatience,L=e.earlyStopMinDelta||0,I=1/0,E=0,T=A,P=new Array(T),R=0,$=0,W=D=>{if(T===1){P[0]=D,R=1,$=0;return}P[$]=D,$=($+1)%T,R<T&&R++},K=()=>{if(R===0)return[];if(R<T)return P.slice(0,R);let D=new Array(R),X=$;for(let U=0;U<R;U++)D[U]=P[(X+U)%T];return D},B,Z,G,tt=x,F=new Array(tt),C=0,j=0,V=D=>{if(tt===1){F[0]=D,C=1,j=0;return}F[j]=D,j=(j+1)%tt,C<tt&&C++},O=()=>{if(C===0)return[];if(C<tt)return F.slice(0,C);let D=new Array(C),X=j;for(let U=0;U<C;U++)D[U]=F[(X+U)%tt];return D},q;n.dropout=d;let et=0;for(let D=1;D<=_;D++){n._maybePrune&&n._maybePrune((c._globalEpoch||0)+D);let X=xi(n,t,m,g,h,f,{},u,M);et=D,W(X);let U=X;if(A>1||p==="ema"||p==="adaptive-ema"){let z=K();if(p==="median"){let H=[...z].sort((ot,ft)=>ot-ft),J=Math.floor(H.length/2);U=H.length%2?H[J]:(H[J-1]+H[J])/2}else if(p==="ema")B==null?B=X:B=B+S*(X-B),U=B;else if(p==="adaptive-ema"){let H=z.reduce((rt,nt)=>rt+nt,0)/z.length,J=z.reduce((rt,nt)=>rt+(nt-H)*(nt-H),0)/z.length,ot=S||2/(A+1),ft=J/Math.max(H*H,1e-8),ht=Math.min(.95,Math.max(ot,ot*(1+2*ft)));Z==null?(Z=X,G=X):(Z=Z+ot*(X-Z),G=G+ht*(X-G)),U=Math.min(G,Z)}else if(p==="gaussian"){let H=z,J=H.length,ot=A/3||1,ft=0,ht=0;for(let rt=0;rt<J;rt++){let nt=Math.exp(-.5*Math.pow((rt-(J-1))/ot,2));ft+=nt,ht+=nt*H[rt]}U=ht/(ft||1)}else if(p==="trimmed"){let H=Math.min(.49,Math.max(0,e.trimmedRatio||.1)),J=[...z].sort((ht,rt)=>ht-rt),ot=Math.floor(J.length*H),ft=J.slice(ot,J.length-ot);U=ft.reduce((ht,rt)=>ht+rt,0)/(ft.length||1)}else if(p==="wma"){let H=0,J=0;for(let ot=0;ot<z.length;ot++){let ft=ot+1;H+=ft,J+=ft*z[ot]}U=J/(H||1)}else U=z.reduce((H,J)=>H+J,0)/z.length}b=U,V(X);let Q=X;if(x>1||y==="ema")if(y==="median"){let z=[...O()].sort((J,ot)=>J-ot),H=Math.floor(z.length/2);Q=z.length%2?z[H]:(z[H-1]+z[H])/2}else if(y==="ema")q==null?q=X:q=q+N*(X-q),Q=q;else{let z=O();Q=z.reduce((H,J)=>H+J,0)/z.length}if(typeof e.metricsHook=="function")try{e.metricsHook({iteration:D,error:b,plateauError:Q,gradNorm:(a=c._lastGradNorm)!==null&&a!==void 0?a:0})}catch{}if(e.checkpoint&&typeof e.checkpoint.save=="function"){if(e.checkpoint.last)try{e.checkpoint.save({type:"last",iteration:D,error:b,network:n.toJSON()})}catch{}if(e.checkpoint.best&&(b<n._checkpointBestError||n._checkpointBestError==null)){n._checkpointBestError=b;try{e.checkpoint.save({type:"best",iteration:D,error:b,network:n.toJSON()})}catch{}}}if(e.schedule&&e.schedule.iterations&&D%e.schedule.iterations===0)try{e.schedule.function({error:b,iteration:D})}catch{}if(b<I-L?(I=b,E=0):k&&E++,k&&E>=k||b<=l)break}return n.nodes.forEach(D=>{D.type==="hidden"&&(D.mask=1)}),n.dropout=0,c._globalEpoch=(c._globalEpoch||0)+et,{error:b,iterations:et,time:Date.now()-v}}var Ws,Ue=Y(()=>{"use strict";Mt();Dt();Ws={computeMonitoredError:Ps,computePlateauMetric:Rs}});var Ni=Qt((Ha,Si)=>{Si.exports=function(t){return t&&typeof t=="object"&&typeof t.copy=="function"&&typeof t.fill=="function"&&typeof t.readUInt8=="function"}});var Ai=Qt((qa,ze)=>{typeof Object.create=="function"?ze.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:ze.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}});var Ii=Qt(dt=>{var zs=/%[sdj%]/g;dt.format=function(n){if(!Oe(n)){for(var t=[],e=0;e<arguments.length;e++)t.push(Rt(arguments[e]));return t.join(" ")}for(var e=1,i=arguments,o=i.length,s=String(n).replace(zs,function(a){if(a==="%%")return"%";if(e>=o)return a;switch(a){case"%s":return String(i[e++]);case"%d":return Number(i[e++]);case"%j":try{return JSON.stringify(i[e++])}catch{return"[Circular]"}default:return a}}),r=i[e];e<o;r=i[++e])Ae(r)||!Vt(r)?s+=" "+r:s+=" "+Rt(r);return s};dt.deprecate=function(n,t){if(kt(global.process))return function(){return dt.deprecate(n,t).apply(this,arguments)};if(process.noDeprecation===!0)return n;var e=!1;function i(){if(!e){if(process.throwDeprecation)throw new Error(t);process.traceDeprecation?console.trace(t):console.error(t),e=!0}return n.apply(this,arguments)}return i};var we={},Je;dt.debuglog=function(n){if(kt(Je)&&(Je=process.env.NODE_DEBUG||""),n=n.toUpperCase(),!we[n])if(new RegExp("\\b"+n+"\\b","i").test(Je)){var t=process.pid;we[n]=function(){var e=dt.format.apply(dt,arguments);console.error("%s %d: %s",n,t,e)}}else we[n]=function(){};return we[n]};function Rt(n,t){var e={seen:[],stylize:Vs};return arguments.length>=3&&(e.depth=arguments[2]),arguments.length>=4&&(e.colors=arguments[3]),Ze(t)?e.showHidden=t:t&&dt._extend(e,t),kt(e.showHidden)&&(e.showHidden=!1),kt(e.depth)&&(e.depth=2),kt(e.colors)&&(e.colors=!1),kt(e.customInspect)&&(e.customInspect=!0),e.colors&&(e.stylize=Js),Ne(e,n,e.depth)}dt.inspect=Rt;Rt.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};Rt.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function Js(n,t){var e=Rt.styles[t];return e?"\x1B["+Rt.colors[e][0]+"m"+n+"\x1B["+Rt.colors[e][1]+"m":n}function Vs(n,t){return n}function Ks(n){var t={};return n.forEach(function(e,i){t[e]=!0}),t}function Ne(n,t,e){if(n.customInspect&&t&&Se(t.inspect)&&t.inspect!==dt.inspect&&!(t.constructor&&t.constructor.prototype===t)){var i=t.inspect(e,n);return Oe(i)||(i=Ne(n,i,e)),i}var o=Xs(n,t);if(o)return o;var s=Object.keys(t),r=Ks(s);if(n.showHidden&&(s=Object.getOwnPropertyNames(t)),xe(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return Ve(t);if(s.length===0){if(Se(t)){var a=t.name?": "+t.name:"";return n.stylize("[Function"+a+"]","special")}if(Me(t))return n.stylize(RegExp.prototype.toString.call(t),"regexp");if(Ye(t))return n.stylize(Date.prototype.toString.call(t),"date");if(xe(t))return Ve(t)}var c="",l=!1,u=["{","}"];if(Oi(t)&&(l=!0,u=["[","]"]),Se(t)){var h=t.name?": "+t.name:"";c=" [Function"+h+"]"}if(Me(t)&&(c=" "+RegExp.prototype.toString.call(t)),Ye(t)&&(c=" "+Date.prototype.toUTCString.call(t)),xe(t)&&(c=" "+Ve(t)),s.length===0&&(!l||t.length==0))return u[0]+c+u[1];if(e<0)return Me(t)?n.stylize(RegExp.prototype.toString.call(t),"regexp"):n.stylize("[Object]","special");n.seen.push(t);var d;return l?d=Ys(n,t,e,r,s):d=s.map(function(f){return Xe(n,t,e,r,f,l)}),n.seen.pop(),Zs(d,c,u)}function Xs(n,t){if(kt(t))return n.stylize("undefined","undefined");if(Oe(t)){var e="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return n.stylize(e,"string")}if(Ei(t))return n.stylize(""+t,"number");if(Ze(t))return n.stylize(""+t,"boolean");if(Ae(t))return n.stylize("null","null")}function Ve(n){return"["+Error.prototype.toString.call(n)+"]"}function Ys(n,t,e,i,o){for(var s=[],r=0,a=t.length;r<a;++r)Ci(t,String(r))?s.push(Xe(n,t,e,i,String(r),!0)):s.push("");return o.forEach(function(c){c.match(/^\d+$/)||s.push(Xe(n,t,e,i,c,!0))}),s}function Xe(n,t,e,i,o,s){var r,a,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?c.set?a=n.stylize("[Getter/Setter]","special"):a=n.stylize("[Getter]","special"):c.set&&(a=n.stylize("[Setter]","special")),Ci(i,o)||(r="["+o+"]"),a||(n.seen.indexOf(c.value)<0?(Ae(e)?a=Ne(n,c.value,null):a=Ne(n,c.value,e-1),a.indexOf(`
`)>-1&&(s?a=a.split(`
`).map(function(l){return"  "+l}).join(`
`).substr(2):a=`
`+a.split(`
`).map(function(l){return"   "+l}).join(`
`))):a=n.stylize("[Circular]","special")),kt(r)){if(s&&o.match(/^\d+$/))return a;r=JSON.stringify(""+o),r.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=n.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=n.stylize(r,"string"))}return r+": "+a}function Zs(n,t,e){var i=0,o=n.reduce(function(s,r){return i++,r.indexOf(`
`)>=0&&i++,s+r.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?e[0]+(t===""?"":t+`
 `)+" "+n.join(`,
  `)+" "+e[1]:e[0]+t+" "+n.join(", ")+" "+e[1]}function Oi(n){return Array.isArray(n)}dt.isArray=Oi;function Ze(n){return typeof n=="boolean"}dt.isBoolean=Ze;function Ae(n){return n===null}dt.isNull=Ae;function Qs(n){return n==null}dt.isNullOrUndefined=Qs;function Ei(n){return typeof n=="number"}dt.isNumber=Ei;function Oe(n){return typeof n=="string"}dt.isString=Oe;function tr(n){return typeof n=="symbol"}dt.isSymbol=tr;function kt(n){return n===void 0}dt.isUndefined=kt;function Me(n){return Vt(n)&&Qe(n)==="[object RegExp]"}dt.isRegExp=Me;function Vt(n){return typeof n=="object"&&n!==null}dt.isObject=Vt;function Ye(n){return Vt(n)&&Qe(n)==="[object Date]"}dt.isDate=Ye;function xe(n){return Vt(n)&&(Qe(n)==="[object Error]"||n instanceof Error)}dt.isError=xe;function Se(n){return typeof n=="function"}dt.isFunction=Se;function er(n){return n===null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||typeof n=="symbol"||typeof n>"u"}dt.isPrimitive=er;dt.isBuffer=Ni();function Qe(n){return Object.prototype.toString.call(n)}function Ke(n){return n<10?"0"+n.toString(10):n.toString(10)}var nr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ir(){var n=new Date,t=[Ke(n.getHours()),Ke(n.getMinutes()),Ke(n.getSeconds())].join(":");return[n.getDate(),nr[n.getMonth()],t].join(" ")}dt.log=function(){console.log("%s - %s",ir(),dt.format.apply(dt,arguments))};dt.inherits=Ai();dt._extend=function(n,t){if(!t||!Vt(t))return n;for(var e=Object.keys(t),i=e.length;i--;)n[e[i]]=t[e[i]];return n};function Ci(n,t){return Object.prototype.hasOwnProperty.call(n,t)}});var ki=Qt((za,ae)=>{"use strict";var or=process.platform==="win32",Ct=Ii();function Ee(n,t){for(var e=[],i=0;i<n.length;i++){var o=n[i];!o||o==="."||(o===".."?e.length&&e[e.length-1]!==".."?e.pop():t&&e.push(".."):e.push(o))}return e}function re(n){for(var t=n.length-1,e=0;e<=t&&!n[e];e++);for(var i=t;i>=0&&!n[i];i--);return e===0&&i===t?n:e>i?[]:n.slice(e,i+1)}var Ti=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,sr=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,gt={};function Ce(n){var t=Ti.exec(n),e=(t[1]||"")+(t[2]||""),i=t[3]||"",o=sr.exec(i),s=o[1],r=o[2],a=o[3];return[e,s,r,a]}function tn(n){var t=Ti.exec(n),e=t[1]||"",i=!!e&&e[1]!==":";return{device:e,isUnc:i,isAbsolute:i||!!t[2],tail:t[3]}}function Di(n){return"\\\\"+n.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}gt.resolve=function(){for(var n="",t="",e=!1,i=arguments.length-1;i>=-1;i--){var o;if(i>=0?o=arguments[i]:n?(o=process.env["="+n],(!o||o.substr(0,3).toLowerCase()!==n.toLowerCase()+"\\")&&(o=n+"\\")):o=process.cwd(),Ct.isString(o)){if(!o)continue}else throw new TypeError("Arguments to path.resolve must be strings");var s=tn(o),r=s.device,a=s.isUnc,c=s.isAbsolute,l=s.tail;if(!(r&&n&&r.toLowerCase()!==n.toLowerCase())&&(n||(n=r),e||(t=l+"\\"+t,e=c),n&&e))break}return a&&(n=Di(n)),t=Ee(t.split(/[\\\/]+/),!e).join("\\"),n+(e?"\\":"")+t||"."};gt.normalize=function(n){var t=tn(n),e=t.device,i=t.isUnc,o=t.isAbsolute,s=t.tail,r=/[\\\/]$/.test(s);return s=Ee(s.split(/[\\\/]+/),!o).join("\\"),!s&&!o&&(s="."),s&&r&&(s+="\\"),i&&(e=Di(e)),e+(o?"\\":"")+s};gt.isAbsolute=function(n){return tn(n).isAbsolute};gt.join=function(){for(var n=[],t=0;t<arguments.length;t++){var e=arguments[t];if(!Ct.isString(e))throw new TypeError("Arguments to path.join must be strings");e&&n.push(e)}var i=n.join("\\");return/^[\\\/]{2}[^\\\/]/.test(n[0])||(i=i.replace(/^[\\\/]{2,}/,"\\")),gt.normalize(i)};gt.relative=function(n,t){n=gt.resolve(n),t=gt.resolve(t);for(var e=n.toLowerCase(),i=t.toLowerCase(),o=re(t.split("\\")),s=re(e.split("\\")),r=re(i.split("\\")),a=Math.min(s.length,r.length),c=a,l=0;l<a;l++)if(s[l]!==r[l]){c=l;break}if(c==0)return t;for(var u=[],l=c;l<s.length;l++)u.push("..");return u=u.concat(o.slice(c)),u.join("\\")};gt._makeLong=function(n){if(!Ct.isString(n))return n;if(!n)return"";var t=gt.resolve(n);return/^[a-zA-Z]\:\\/.test(t)?"\\\\?\\"+t:/^\\\\[^?.]/.test(t)?"\\\\?\\UNC\\"+t.substring(2):n};gt.dirname=function(n){var t=Ce(n),e=t[0],i=t[1];return!e&&!i?".":(i&&(i=i.substr(0,i.length-1)),e+i)};gt.basename=function(n,t){var e=Ce(n)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e};gt.extname=function(n){return Ce(n)[3]};gt.format=function(n){if(!Ct.isObject(n))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof n);var t=n.root||"";if(!Ct.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof n.root);var e=n.dir,i=n.base||"";return e?e[e.length-1]===gt.sep?e+i:e+gt.sep+i:i};gt.parse=function(n){if(!Ct.isString(n))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof n);var t=Ce(n);if(!t||t.length!==4)throw new TypeError("Invalid path '"+n+"'");return{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}};gt.sep="\\";gt.delimiter=";";var rr=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,yt={};function Ie(n){return rr.exec(n).slice(1)}yt.resolve=function(){for(var n="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var i=e>=0?arguments[e]:process.cwd();if(Ct.isString(i)){if(!i)continue}else throw new TypeError("Arguments to path.resolve must be strings");n=i+"/"+n,t=i[0]==="/"}return n=Ee(n.split("/"),!t).join("/"),(t?"/":"")+n||"."};yt.normalize=function(n){var t=yt.isAbsolute(n),e=n&&n[n.length-1]==="/";return n=Ee(n.split("/"),!t).join("/"),!n&&!t&&(n="."),n&&e&&(n+="/"),(t?"/":"")+n};yt.isAbsolute=function(n){return n.charAt(0)==="/"};yt.join=function(){for(var n="",t=0;t<arguments.length;t++){var e=arguments[t];if(!Ct.isString(e))throw new TypeError("Arguments to path.join must be strings");e&&(n?n+="/"+e:n+=e)}return yt.normalize(n)};yt.relative=function(n,t){n=yt.resolve(n).substr(1),t=yt.resolve(t).substr(1);for(var e=re(n.split("/")),i=re(t.split("/")),o=Math.min(e.length,i.length),s=o,r=0;r<o;r++)if(e[r]!==i[r]){s=r;break}for(var a=[],r=s;r<e.length;r++)a.push("..");return a=a.concat(i.slice(s)),a.join("/")};yt._makeLong=function(n){return n};yt.dirname=function(n){var t=Ie(n),e=t[0],i=t[1];return!e&&!i?".":(i&&(i=i.substr(0,i.length-1)),e+i)};yt.basename=function(n,t){var e=Ie(n)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e};yt.extname=function(n){return Ie(n)[3]};yt.format=function(n){if(!Ct.isObject(n))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof n);var t=n.root||"";if(!Ct.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof n.root);var e=n.dir?n.dir+yt.sep:"",i=n.base||"";return e+i};yt.parse=function(n){if(!Ct.isString(n))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof n);var t=Ie(n);if(!t||t.length!==4)throw new TypeError("Invalid path '"+n+"'");return t[1]=t[1]||"",t[2]=t[2]||"",t[3]=t[3]||"",{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}};yt.sep="/";yt.delimiter=":";or?ae.exports=gt:ae.exports=yt;ae.exports.posix=yt;ae.exports.win32=gt});var en={};vt(en,{TestWorker:()=>Te,default:()=>ar});var ji,Li,Te,ar,nn=Y(()=>{"use strict";ji=Zo("child_process"),Li=Qo(ki(),1),Te=class{constructor(t,e){this.worker=(0,ji.fork)(Li.default.join(__dirname,"/worker")),this.worker.send({set:t,cost:e.name})}evaluate(t){return new Promise(e=>{let i=t.serialize(),o={activations:i[0],states:i[1],conns:i[2]},s=this.worker;this.worker.on("message",function r(a){s.removeListener("message",r),e(a)}),this.worker.send(o)})}terminate(){this.worker.kill()}},ar=Te});var sn={};vt(sn,{TestWorker:()=>on});var on,rn=Y(()=>{"use strict";De();on=class n{constructor(t,e){let i=new Blob([n._createBlobString(e)]);this.url=window.URL.createObjectURL(i),this.worker=new Worker(this.url);let o={set:new Float64Array(t).buffer};this.worker.postMessage(o,[o.set])}evaluate(t){return new Promise((e,i)=>{let o=t.serialize(),s={activations:new Float64Array(o[0]).buffer,states:new Float64Array(o[1]).buffer,conns:new Float64Array(o[2]).buffer};this.worker.onmessage=function(r){let a=new Float64Array(r.data.buffer)[0];e(a)},this.worker.postMessage(s,[s.activations,s.states,s.conns])})}terminate(){this.worker.terminate(),window.URL.revokeObjectURL(this.url)}static _createBlobString(t){return`
      const F = [${It.activations.toString()}];
      const cost = ${t.toString()};
      const multi = {
        deserializeDataSet: ${It.deserializeDataSet.toString()},
        testSerializedSet: ${It.testSerializedSet.toString()},
        activateSerializedNetwork: ${It.activateSerializedNetwork.toString()}
      };

      let set;

      this.onmessage = function (e) {
        if (typeof e.data.set === 'undefined') {
          const A = new Float64Array(e.data.activations);
          const S = new Float64Array(e.data.states);
          const data = new Float64Array(e.data.conns);

          const error = multi.testSerializedSet(set, cost, A, S, data, F);

          const answer = { buffer: new Float64Array([error]).buffer };
          postMessage(answer, [answer.buffer]);
        } else {
          set = multi.deserializeDataSet(new Float64Array(e.data.set));
        }
      };`}}});var Pi,ke,Ri=Y(()=>{"use strict";Pi=function(n,t,e,i){function o(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function a(u){try{l(i.next(u))}catch(h){r(h)}}function c(u){try{l(i.throw(u))}catch(h){r(h)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})},ke=class{static getNodeTestWorker(){return Pi(this,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(nn(),en))).TestWorker})}static getBrowserTestWorker(){return Pi(this,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(rn(),sn))).TestWorker})}}});var Wi,ce,It,De=Y(()=>{"use strict";Ri();Wi=function(n,t,e,i){function o(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function a(u){try{l(i.next(u))}catch(h){r(h)}}function c(u){try{l(i.throw(u))}catch(h){r(h)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})},ce=class n{static serializeDataSet(t){let e=[t[0].input.length,t[0].output.length];for(let i=0;i<t.length;i++){for(let o=0;o<e[0];o++)e.push(t[i].input[o]);for(let o=0;o<e[1];o++)e.push(t[i].output[o])}return e}static activateSerializedNetwork(t,e,i,o,s){for(let a=0;a<o[0];a++)e[a]=t[a];for(let a=2;a<o.length;a++){let c=o[a++],l=o[a++],u=o[a++],h=o[a++],d=o[a++];for(i[c]=(d===-1?1:e[d])*h*i[c]+l;o[a]!==-2;)i[c]+=e[o[a++]]*o[a++]*(o[a++]===-1?1:e[o[a-1]]);e[c]=s[u](i[c])}let r=[];for(let a=e.length-o[1];a<e.length;a++)r.push(e[a]);return r}static deserializeDataSet(t){let e=[],i=t[0]+t[1];for(let o=0;o<(t.length-2)/i;o++){let s=[];for(let a=2+o*i;a<2+o*i+t[0];a++)s.push(t[a]);let r=[];for(let a=2+o*i+t[0];a<2+o*i+i;a++)r.push(t[a]);e.push({input:s,output:r})}return e}static logistic(t){return 1/(1+Math.exp(-t))}static tanh(t){return Math.tanh(t)}static identity(t){return t}static step(t){return t>0?1:0}static relu(t){return t>0?t:0}static softsign(t){return t/(1+Math.abs(t))}static sinusoid(t){return Math.sin(t)}static gaussian(t){return Math.exp(-Math.pow(t,2))}static bentIdentity(t){return(Math.sqrt(Math.pow(t,2)+1)-1)/2+t}static bipolar(t){return t>0?1:-1}static bipolarSigmoid(t){return 2/(1+Math.exp(-t))-1}static hardTanh(t){return Math.max(-1,Math.min(1,t))}static absolute(t){return Math.abs(t)}static inverse(t){return 1-t}static selu(t){let e=1.6732632423543772;return(t>0?t:e*Math.exp(t)-e)*1.0507009873554805}static softplus(t){return Math.log(1+Math.exp(t))}static testSerializedSet(t,e,i,o,s,r){let a=0;for(let c=0;c<t.length;c++){let l=n.activateSerializedNetwork(t[c].input,i,o,s,r);a+=e(t[c].output,l)}return a/t.length}static getBrowserTestWorker(){return Wi(this,void 0,void 0,function*(){let{TestWorker:t}=yield Promise.resolve().then(()=>(rn(),sn));return t})}static getNodeTestWorker(){return Wi(this,void 0,void 0,function*(){let{TestWorker:t}=yield Promise.resolve().then(()=>(nn(),en));return t})}};ce.workers=ke;ce.activations=[n=>1/(1+Math.exp(-n)),n=>Math.tanh(n),n=>n,n=>n>0?1:0,n=>n>0?n:0,n=>n/(1+Math.abs(n)),n=>Math.sin(n),n=>Math.exp(-Math.pow(n,2)),n=>(Math.sqrt(Math.pow(n,2)+1)-1)/2+n,n=>n>0?1:-1,n=>2/(1+Math.exp(-n))-1,n=>Math.max(-1,Math.min(1,n)),n=>Math.abs(n),n=>1-n,n=>{let t=1.6732632423543772;return(n>0?n:t*Math.exp(n)-t)*1.0507009873554805},n=>Math.log(1+Math.exp(n))];It=ce});var $i={};vt($i,{evolveNetwork:()=>hr});function an(n,t){let e=n.nodes.length,i=n.connections.length,o=n.gates.length,s=Bi.get(n);if(s&&s.nodes===e&&s.conns===i&&s.gates===o)return s.value*t;let r=e-n.input-n.output+i+o;return Bi.set(n,{nodes:e,conns:i,gates:o,value:r}),r*t}function Fi(n,t,e,i){return o=>{let s=0;for(let r=0;r<e;r++)try{s-=o.test(n,t).error}catch(a){return at.warnings&&console.warn(`Genome evaluation failed: ${a&&a.message||a}. Penalizing with -Infinity fitness.`),-1/0}return s-=an(o,i),s=isNaN(s)?-1/0:s,s/e}}function lr(n,t,e,i,o,s){return Gi(this,void 0,void 0,function*(){var r,a,c,l;let u=It.serializeDataSet(n),h=[],d=null;try{let m=typeof process<"u"&&!!(!((r=process.versions)===null||r===void 0)&&r.node);m&&(!((a=It.workers)===null||a===void 0)&&a.getNodeTestWorker)?d=yield It.workers.getNodeTestWorker():!m&&(!((c=It.workers)===null||c===void 0)&&c.getBrowserTestWorker)&&(d=yield It.workers.getBrowserTestWorker())}catch(m){at.warnings&&console.warn("Failed to load worker class; falling back to single-thread path:",m?.message||m)}if(!d)return{fitnessFunction:Fi(n,t,e,i),threads:1};for(let m=0;m<o;m++)try{h.push(new d(u,{name:t.name||((l=t.toString)===null||l===void 0?void 0:l.call(t))||"cost"}))}catch(g){at.warnings&&console.warn("Worker spawn failed",g)}let f=m=>new Promise(g=>{if(!h.length){g();return}let w=m.slice(),M=h.length,_=v=>{if(!w.length){--M===0&&g();return}let b=w.shift();v.evaluate(b).then(A=>{typeof b<"u"&&typeof A=="number"&&(b.score=-A-an(b,i),b.score=isNaN(A)?-1/0:b.score),_(v)}).catch(()=>_(v))};h.forEach(v=>_(v))});return s.fitnessPopulation=!0,s._workerTerminators=()=>{h.forEach(m=>{try{m.terminate&&m.terminate()}catch{}})},{fitnessFunction:f,threads:o}})}function hr(n,t){return Gi(this,void 0,void 0,function*(){var e,i,o,s,r;if(!n||n.length===0||n[0].input.length!==this.input||n[0].output.length!==this.output)throw new Error("Dataset is invalid or dimensions do not match network input/output size!");t=t||{};let a=(e=t.error)!==null&&e!==void 0?e:.05,c=(i=t.growth)!==null&&i!==void 0?i:1e-4,l=t.cost||Et.mse,u=t.amount||1,h=t.log||0,d=t.schedule,f=t.clear||!1,m=typeof t.threads>"u"?1:t.threads,g=Date.now(),w={targetError:a,growth:c,cost:l,amount:u,log:h,schedule:d,clear:f,threads:m};if(typeof t.iterations>"u"&&typeof t.error>"u")throw new Error("At least one stopping condition (`iterations` or `error`) must be specified for evolution.");typeof t.error>"u"?a=-1:typeof t.iterations>"u"&&(t.iterations=0);let M;if(m===1)M=Fi(n,l,u,c);else{let N=yield lr(n,l,u,c,m,t);M=N.fitnessFunction,m=N.threads}t.network=this,t.populationSize!=null&&t.popsize==null&&(t.popsize=t.populationSize),typeof t.speciation>"u"&&(t.speciation=!1);let{default:_}=yield Promise.resolve().then(()=>(cn(),qi)),v=new _(this.input,this.output,M,t);if(typeof t.iterations=="number"&&t.iterations===0&&v._warnIfNoBestGenome)try{v._warnIfNoBestGenome()}catch{}t.popsize&&t.popsize<=10&&(v.options.mutationRate=(o=v.options.mutationRate)!==null&&o!==void 0?o:.5,v.options.mutationAmount=(s=v.options.mutationAmount)!==null&&s!==void 0?s:1);let b=1/0,A=-1/0,p,S=0,x=5,y=typeof t.iterations=="number";for(;(a===-1||b>a)&&(!y||v.generation<t.iterations);){let N=yield v.evolve(),k=(r=N.score)!==null&&r!==void 0?r:-1/0;if(b=-(k-an(N,c))||1/0,k>A&&(A=k,p=N),!isFinite(b)||isNaN(b)){if(++S>=x)break}else S=0;if(d&&v.generation%d.iterations===0)try{d.function({fitness:A,error:b,iteration:v.generation})}catch{}}if(typeof p<"u")this.nodes=p.nodes,this.connections=p.connections,this.selfconns=p.selfconns,this.gates=p.gates,f&&this.clear();else if(v._warnIfNoBestGenome)try{v._warnIfNoBestGenome()}catch{}try{t._workerTerminators&&t._workerTerminators()}catch{}return{error:b,iterations:v.generation,time:Date.now()-g}})}var Gi,Bi,Hi=Y(()=>{"use strict";Mt();Dt();De();Gi=function(n,t,e,i){function o(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function a(u){try{l(i.next(u))}catch(h){r(h)}}function c(u){try{l(i.throw(u))}catch(h){r(h)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})},Bi=new WeakMap});var $t={};vt($t,{default:()=>_t});var ur,_t,At=Y(()=>{"use strict";Nt();Mt();Dt();oe();jn();Rn();Gn();Un();Xn();Qn();si();ai();li();di();_i();vi();ur=function(n,t,e,i){function o(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function a(u){try{l(i.next(u))}catch(h){r(h)}}function c(u){try{l(i.throw(u))}catch(h){r(h)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})},_t=class n{_canUseFastSlab(t){return qn.call(this,t)}_fastSlabActivate(t){return Hn.call(this,t)}rebuildConnectionSlab(t=!1){return _e.call(this,t)}getConnectionSlab(){return Fn.call(this)}constructor(t,e,i){if(this.dropout=0,this._dropConnectProb=0,this._optimizerStep=0,this._weightNoiseStd=0,this._weightNoisePerHidden=[],this._stochasticDepth=[],this._trainingStep=0,this._rand=Math.random,this._lastStats=null,this._mixedPrecision={enabled:!1,lossScale:1},this._mixedPrecisionState={goodSteps:0,badSteps:0,minLossScale:1,maxLossScale:65536,overflowCount:0,scaleUpEvents:0,scaleDownEvents:0},this._gradAccumMicroBatches=0,this._lastRawGradNorm=0,this._accumulationReduction="average",this._gradClipSeparateBias=!1,this._lastGradClipGroupCount=0,this._lastOverflowStep=-1,this._forceNextOverflow=!1,this._enforceAcyclic=!1,this._topoOrder=null,this._topoDirty=!0,this._globalEpoch=0,this._activationPrecision="f64",this._reuseActivationArrays=!1,this._returnTypedActivations=!1,this._slabDirty=!0,this._useFloat32Weights=!0,this._nodeIndexDirty=!0,this._adjDirty=!0,typeof t>"u"||typeof e>"u")throw new Error("No input or output size given");this.input=t,this.output=e,this.nodes=[],this.connections=[],this.gates=[],this.selfconns=[],this.dropout=0,this._enforceAcyclic=i?.enforceAcyclic||!1,i?.activationPrecision?this._activationPrecision=i.activationPrecision:at.float32Mode&&(this._activationPrecision="f32"),i?.reuseActivationArrays&&(this._reuseActivationArrays=!0),i?.returnTypedActivations&&(this._returnTypedActivations=!0);try{typeof at.poolMaxPerBucket=="number"&&xt.setMaxPerBucket(at.poolMaxPerBucket);let s=typeof at.poolPrewarmCount=="number"?at.poolPrewarmCount:2;xt.prewarm(this.output,s)}catch{}i?.seed!==void 0&&this.setSeed(i.seed);for(let s=0;s<this.input+this.output;s++){let r=s<this.input?"input":"output";this.nodes.push(new pt(r,void 0,this._rand))}for(let s=0;s<this.input;s++)for(let r=this.input;r<this.input+this.output;r++){let a=this._rand()*this.input*Math.sqrt(2/this.input);this.connect(this.nodes[s],this.nodes[r],a)}let o=i?.minHidden||0;if(o>0)for(;this.nodes.length<this.input+this.output+o;)this.addNodeBetween()}addNodeBetween(){if(this.connections.length===0)return;let t=Math.floor(this._rand()*this.connections.length),e=this.connections[t];if(!e)return;this.disconnect(e.from,e.to);let i=new pt("hidden",void 0,this._rand);this.nodes.push(i),this.connect(e.from,i,e.weight),this.connect(i,e.to,1),this._topoDirty=!0,this._nodeIndexDirty=!0}enableDropConnect(t){if(t<0||t>=1)throw new Error("DropConnect probability must be in [0,1)");this._dropConnectProb=t}disableDropConnect(){this._dropConnectProb=0}setEnforceAcyclic(t){this._enforceAcyclic=!!t}_computeTopoOrder(){return Wn.call(this)}_hasPath(t,e){return Bn.call(this,t,e)}configurePruning(t){var e,i;let{start:o,end:s,targetSparsity:r}=t;if(o<0||s<o)throw new Error("Invalid pruning schedule window");if(r<=0||r>=1)throw new Error("targetSparsity must be in (0,1)");this._pruningConfig={start:o,end:s,targetSparsity:r,regrowFraction:(e=t.regrowFraction)!==null&&e!==void 0?e:0,frequency:(i=t.frequency)!==null&&i!==void 0?i:1,method:t.method||"magnitude",lastPruneIter:void 0},this._initialConnectionCount=this.connections.length}getCurrentSparsity(){return Kn.call(this)}_maybePrune(t){return Jn.call(this,t)}pruneToSparsity(t,e="magnitude"){return Vn.call(this,t,e)}enableWeightNoise(t){if(typeof t=="number"){if(t<0)throw new Error("Weight noise stdDev must be >= 0");this._weightNoiseStd=t,this._weightNoisePerHidden=[]}else if(t&&Array.isArray(t.perHiddenLayer)){if(!this.layers||this.layers.length<3)throw new Error("Per-hidden-layer weight noise requires a layered network with at least one hidden layer");let e=this.layers.length-2;if(t.perHiddenLayer.length!==e)throw new Error(`Expected ${e} std dev entries (one per hidden layer), got ${t.perHiddenLayer.length}`);if(t.perHiddenLayer.some(i=>i<0))throw new Error("Weight noise std devs must be >= 0");this._weightNoiseStd=0,this._weightNoisePerHidden=t.perHiddenLayer.slice()}else throw new Error("Invalid weight noise configuration")}disableWeightNoise(){this._weightNoiseStd=0,this._weightNoisePerHidden=[]}setWeightNoiseSchedule(t){this._weightNoiseSchedule=t}clearWeightNoiseSchedule(){this._weightNoiseSchedule=void 0}setRandom(t){this._rand=t}setSeed(t){ti.call(this,t)}testForceOverflow(){this._forceNextOverflow=!0}get trainingStep(){return this._trainingStep}get lastSkippedLayers(){return this._lastSkippedLayers||[]}snapshotRNG(){return ei.call(this)}restoreRNG(t){ni.call(this,t)}getRNGState(){return ii.call(this)}setRNGState(t){oi.call(this,t)}setStochasticDepthSchedule(t){this._stochasticDepthSchedule=t}clearStochasticDepthSchedule(){this._stochasticDepthSchedule=void 0}getRegularizationStats(){return ri.call(this)}setStochasticDepth(t){if(!Array.isArray(t))throw new Error("survival must be an array");if(t.some(i=>i<=0||i>1))throw new Error("Stochastic depth survival probs must be in (0,1]");if(!this.layers||this.layers.length===0)throw new Error("Stochastic depth requires layer-based network");let e=Math.max(0,this.layers.length-2);if(t.length!==e)throw new Error(`Expected ${e} survival probabilities for hidden layers, got ${t.length}`);this._stochasticDepth=t.slice()}disableStochasticDepth(){this._stochasticDepth=[]}clone(){return n.fromJSON(this.toJSON())}resetDropoutMasks(){if(this.layers&&this.layers.length>0){for(let t of this.layers)if(typeof t.nodes<"u")for(let e of t.nodes)typeof e.mask<"u"&&(e.mask=1)}else for(let t of this.nodes)typeof t.mask<"u"&&(t.mask=1)}standalone(){return Pn(this)}activate(t,e=!1,i=1e3){if(this._enforceAcyclic&&this._topoDirty&&this._computeTopoOrder(),!Array.isArray(t)||t.length!==this.input)throw new Error(`Input size mismatch: expected ${this.input}, got ${t?t.length:"undefined"}`);if(this._canUseFastSlab(e))try{return this._fastSlabActivate(t)}catch{}let o=xt.acquire(this.output);if(!this.nodes||this.nodes.length===0)throw new Error("Network structure is corrupted or empty. No nodes found.");let s=o;this._lastSkippedLayers=[];let r={droppedHiddenNodes:0,totalHiddenNodes:0,droppedConnections:0,totalConnections:this.connections.length,skippedLayers:[],weightNoise:{count:0,sumAbs:0,maxAbs:0,meanAbs:0}},a=!1,c=this._weightNoiseStd;if(e&&(this._weightNoiseSchedule&&(c=this._weightNoiseSchedule(this._trainingStep)),c>0||this._weightNoisePerHidden.length>0))for(let u of this.connections){if(u._origWeightNoise!=null)continue;u._origWeightNoise=u.weight;let h=c;if(this._weightNoisePerHidden.length>0&&this.layers){let d=-1;for(let f=0;f<this.layers.length;f++)if(this.layers[f].nodes.includes(u.from)){d=f;break}if(d>0&&d<this.layers.length){let f=d-1;f>=0&&f<this._weightNoisePerHidden.length&&(h=this._weightNoisePerHidden[f])}}if(h>0){let d=h*n._gaussianRand(this._rand);u.weight+=d,u._wnLast=d,a=!0}else u._wnLast=0}if(e&&this._stochasticDepthSchedule&&this._stochasticDepth.length>0){let u=this._stochasticDepthSchedule(this._trainingStep,this._stochasticDepth.slice());Array.isArray(u)&&u.length===this._stochasticDepth.length&&!u.some(h=>h<=0||h>1)&&(this._stochasticDepth=u.slice())}if(this.layers&&this.layers.length>0&&this._stochasticDepth.length>0){let u;for(let h=0;h<this.layers.length;h++){let d=this.layers[h],f=h>0&&h<this.layers.length-1,m=!1;if(e&&f){let w=h-1;if(w<this._stochasticDepth.length){let M=this._stochasticDepth[w];if(m=this._rand()>=M,m&&(!u||u.length!==d.nodes.length)&&(m=!1),!m){let _=h===0?d.activate(t,e):d.activate(void 0,e);u=M<1?_.map(v=>v*(1/M)):_;continue}}}if(m){this._lastSkippedLayers.push(h),r.skippedLayers.push(h);continue}u=h===0?d.activate(t,e):d.activate(void 0,e)}if(u)for(let h=0;h<u.length&&h<this.output;h++)s[h]=u[h]}else if(this.layers&&this.layers.length>0){let u;for(let h=0;h<this.layers.length;h++){let d=this.layers[h],f=h>0&&h<this.layers.length-1,m=h===0?d.activate(t,!1):d.activate(void 0,!1);if(f&&e&&this.dropout>0){let g=0;for(let w of d.nodes)w.mask=this._rand()<this.dropout?0:1,r.totalHiddenNodes++,w.mask===0&&r.droppedHiddenNodes++,w.mask===0&&(w.activation=0,g++);if(g===d.nodes.length&&d.nodes.length>0){let w=Math.floor(this._rand()*d.nodes.length);d.nodes[w].mask=1,d.nodes[w].activation=m[w]}}else if(f)for(let g of d.nodes)g.mask=1;u=m}if(u)if(this._reuseActivationArrays)for(let h=0;h<u.length&&h<this.output;h++)s[h]=u[h];else for(let h=0;h<u.length&&h<this.output;h++)s[h]=u[h]}else{let u=this.nodes.filter(f=>f.type==="hidden"),h=0;if(e&&this.dropout>0){for(let f of u)f.mask=this._rand()<this.dropout?0:1,r.totalHiddenNodes++,f.mask===0&&(h++,r.droppedHiddenNodes++);if(h===u.length&&u.length>0){let f=Math.floor(this._rand()*u.length);u[f].mask=1}}else for(let f of u)f.mask=1;if(e&&this._weightNoiseStd>0){this._wnOrig||(this._wnOrig=new Array(this.connections.length));for(let f=0;f<this.connections.length;f++){let m=this.connections[f];if(m._origWeightNoise!=null)continue;m._origWeightNoise=m.weight;let g=this._weightNoiseStd*n._gaussianRand(this._rand);m.weight+=g}}let d=0;if(this.nodes.forEach((f,m)=>{if(f.type==="input")f.activate(t[m]);else if(f.type==="output"){let g=f.activate();s[d++]=g}else f.activate()}),e&&this._dropConnectProb>0)for(let f of this.connections){let m=this._rand()<this._dropConnectProb?0:1;m===0&&r.droppedConnections++,f.dcMask=m,m===0?(f._origWeight==null&&(f._origWeight=f.weight),f.weight=0):f._origWeight!=null&&(f.weight=f._origWeight,delete f._origWeight)}else for(let f of this.connections)f._origWeight!=null&&(f.weight=f._origWeight,delete f._origWeight),f.dcMask=1;if(e&&a)for(let f of this.connections)f._origWeightNoise!=null&&(f.weight=f._origWeightNoise,delete f._origWeightNoise)}e&&this._trainingStep++,r.weightNoise.count>0&&(r.weightNoise.meanAbs=r.weightNoise.sumAbs/r.weightNoise.count),this._lastStats=r;let l=Array.from(s);return xt.release(s),l}static _gaussianRand(t=Math.random){let e=0,i=0;for(;e===0;)e=t();for(;i===0;)i=t();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*i)}noTraceActivate(t){let{noTraceActivate:e}=(ve(),ct(ye));return e.call(this,t)}activateRaw(t,e=!1,i=1e3){let{activateRaw:o}=(ve(),ct(ye));return o.call(this,t,e,i)}activateBatch(t,e=!1){let{activateBatch:i}=(ve(),ct(ye));return i.call(this,t,e)}propagate(t,e,i,o,s=0,r){if(!o||o.length!==this.output)throw new Error("Output target length should match network output length");let a=o.length;for(let c=this.nodes.length-1;c>=this.nodes.length-this.output;c--)r?this.nodes[c].propagate(t,e,i,s,o[--a],r):this.nodes[c].propagate(t,e,i,s,o[--a]);for(let c=this.nodes.length-this.output-1;c>=this.input;c--)this.nodes[c].propagate(t,e,i,s)}clear(){this.nodes.forEach(t=>t.clear())}mutate(t){let{mutateImpl:e}=(wi(),ct(bi));return e.call(this,t)}connect(t,e,i){return hi.call(this,t,e,i)}gate(t,e){return Yn.call(this,t,e)}remove(t){return ci.call(this,t)}disconnect(t,e){return ui.call(this,t,e)}ungate(t){return Zn.call(this,t)}_applyGradientClipping(t){let{applyGradientClippingImpl:e}=(Ue(),ct(qe));e(this,t)}train(t,e){let{trainImpl:i}=(Ue(),ct(qe));return i(this,t,e)}getRawGradientNorm(){return this._lastRawGradNorm}getLossScale(){return this._mixedPrecision.lossScale}getLastGradClipGroupCount(){return this._lastGradClipGroupCount}getTrainingStats(){var t;return{gradNorm:(t=this._lastGradNorm)!==null&&t!==void 0?t:0,gradNormRaw:this._lastRawGradNorm,lossScale:this._mixedPrecision.lossScale,optimizerStep:this._optimizerStep,mp:{good:this._mixedPrecisionState.goodSteps,bad:this._mixedPrecisionState.badSteps,overflowCount:this._mixedPrecisionState.overflowCount||0,scaleUps:this._mixedPrecisionState.scaleUpEvents||0,scaleDowns:this._mixedPrecisionState.scaleDownEvents||0,lastOverflowStep:this._lastOverflowStep}}}static adjustRateForAccumulation(t,e,i){return i==="sum"&&e>1?t/e:t}evolve(t,e){return ur(this,void 0,void 0,function*(){let{evolveNetwork:i}=yield Promise.resolve().then(()=>(Hi(),$i));return i.call(this,t,e)})}test(t,e){if(!Array.isArray(t)||t.length===0)throw new Error("Test set is empty or not an array.");for(let a of t){if(!Array.isArray(a.input)||a.input.length!==this.input)throw new Error(`Test sample input size mismatch: expected ${this.input}, got ${a.input?a.input.length:"undefined"}`);if(!Array.isArray(a.output)||a.output.length!==this.output)throw new Error(`Test sample output size mismatch: expected ${this.output}, got ${a.output?a.output.length:"undefined"}`)}let i=0,o=e||Et.mse,s=Date.now();this.nodes.forEach(a=>{a.type==="hidden"&&(a.mask=1)});let r=this.dropout;return this.dropout>0&&(this.dropout=0),t.forEach(a=>{let c=this.noTraceActivate(a.input);i+=o(a.output,c)}),this.dropout=r,{error:i/t.length,time:Date.now()-s}}serialize(){return pi.call(this)}static deserialize(t,e,i){return fi(t,e,i)}toJSON(){return mi.call(this)}static fromJSON(t){return gi(t)}static crossOver(t,e,i=!1){return yi(t,e,i)}set(t){this.nodes.forEach(e=>{typeof t.bias<"u"&&(e.bias=t.bias),typeof t.squash<"u"&&(e.squash=t.squash)})}toONNX(){return kn(this)}static createMLP(t,e,i){let o=Array.from({length:t},()=>new pt("input")),s=e.map(u=>Array.from({length:u},()=>new pt("hidden"))),r=Array.from({length:i},()=>new pt("output")),a=[...o,...s.flat(),...r],c=new n(t,i);c.nodes=a;let l=o;for(let u of s){for(let h of u)for(let d of l)d.connect(h);l=u}for(let u of r)for(let h of l)h.connect(u);return c.connections=c.nodes.flatMap(u=>u.connections.out),c._topoDirty=!0,c}static rebuildConnections(t){let e=new Set;t.nodes.forEach(i=>{i.connections.out.forEach(o=>{e.add(o)})}),t.connections=Array.from(e)}}});function Ui(){var n,t,e,i,o,s;let r=(Mt(),ct(wt));for(let a of this.population){!((n=this.options.adaptiveMutation)===null||n===void 0)&&n.enabled&&a._mutRate===void 0&&(a._mutRate=this.options.mutationRate!==void 0?this.options.mutationRate:(t=this.options.adaptiveMutation.initialRate)!==null&&t!==void 0?t:this.options.mutationRate||.7,this.options.adaptiveMutation.adaptAmount&&(a._mutAmount=this.options.mutationAmount||1));let c=this.options.mutationRate!==void 0?this.options.mutationRate:!((e=this.options.adaptiveMutation)===null||e===void 0)&&e.enabled?a._mutRate:this.options.mutationRate||.7,l=!((i=this.options.adaptiveMutation)===null||i===void 0)&&i.enabled&&this.options.adaptiveMutation.adaptAmount?(o=a._mutAmount)!==null&&o!==void 0?o:this.options.mutationAmount||1:this.options.mutationAmount||1;if(this._getRNG()()<=c)for(let u=0;u<l;u++){let h=this.selectMutationMethod(a,!1);if(Array.isArray(h)){let d=h;h=d[Math.floor(this._getRNG()()*d.length)]}if(h&&h.name){let d=a.nodes.length,f=a.connections.length;if(h===r.mutation.ADD_NODE){this._mutateAddNodeReuse(a);try{a.mutate(r.mutation.MOD_WEIGHT)}catch{}this._invalidateGenomeCaches(a)}else if(h===r.mutation.ADD_CONN){this._mutateAddConnReuse(a);try{a.mutate(r.mutation.MOD_WEIGHT)}catch{}this._invalidateGenomeCaches(a)}else a.mutate(h),(h===r.mutation.ADD_GATE||h===r.mutation.SUB_NODE||h===r.mutation.SUB_CONN||h===r.mutation.ADD_SELF_CONN||h===r.mutation.ADD_BACK_CONN)&&this._invalidateGenomeCaches(a);if(this._getRNG()()<.5&&this._mutateAddConnReuse(a),!((s=this.options.operatorAdaptation)===null||s===void 0)&&s.enabled){let m=this._operatorStats.get(h.name)||{success:0,attempts:0};m.attempts++;let g=a.nodes.length,w=a.connections.length;(g>d||w>f)&&m.success++,this._operatorStats.set(h.name,m)}}}}}function zi(n){if(n.connections.length===0){let l=n.nodes.find(h=>h.type==="input"),u=n.nodes.find(h=>h.type==="output");if(l&&u)try{n.connect(l,u,1)}catch{}}let t=n.connections.filter(l=>l.enabled!==!1);if(!t.length)return;let e=t[Math.floor(this._getRNG()()*t.length)],i=e.from.geneId,o=e.to.geneId,s=i+"->"+o,r=e.weight;n.disconnect(e.from,e.to);let a=this._nodeSplitInnovations.get(s),c=(Nt(),ct(ge)).default;if(a){let l=new c("hidden");l.geneId=a.newNodeGeneId;let u=n.nodes.indexOf(e.to),h=Math.min(u,n.nodes.length-n.output);n.nodes.splice(h,0,l);let d=n.connect(e.from,l,1)[0],f=n.connect(l,e.to,r)[0];d&&(d.innovation=a.inInnov),f&&(f.innovation=a.outInnov)}else{let l=new c("hidden"),u=n.connect(e.from,l,1)[0],h=n.connect(l,e.to,r)[0];u&&(u.innovation=this._nextGlobalInnovation++),h&&(h.innovation=this._nextGlobalInnovation++),a={newNodeGeneId:l.geneId,inInnov:u?.innovation,outInnov:h?.innovation},this._nodeSplitInnovations.set(s,a);let d=n.nodes.indexOf(e.to),f=Math.min(d,n.nodes.length-n.output);n.nodes.splice(f,0,l)}}function Ji(n){let t=[];for(let d=0;d<n.nodes.length-n.output;d++){let f=n.nodes[d];for(let m=Math.max(d+1,n.input);m<n.nodes.length;m++){let g=n.nodes[m];f.isProjectingTo(g)||t.push([f,g])}}if(!t.length)return;let e=t.filter(d=>{let f=d[0].geneId,m=d[1].geneId,g=f<m?f+"::"+m:m+"::"+f;return this._connInnovations.has(g)}),i=e.length?[]:t.filter(d=>d[0].type==="hidden"&&d[1].type==="hidden"),o=e.length?e:i.length?i:t,s=o.length===1?o[0]:o[Math.floor(this._getRNG()()*o.length)],r=s[0],a=s[1],c=r.geneId,l=a.geneId,u=c<l?c+"::"+l:l+"::"+c;if(n._enforceAcyclic&&(()=>{let f=[a],m=new Set;for(;f.length;){let g=f.pop();if(g===r)return!0;if(!m.has(g)){m.add(g);for(let w of g.connections.out)f.push(w.to)}}return!1})())return;let h=n.connect(r,a)[0];if(h)if(this._connInnovations.has(u))h.innovation=this._connInnovations.get(u);else{let d=this._nextGlobalInnovation++;h.innovation=d,this._connInnovations.set(u,d);let f=c+"::"+l,m=l+"::"+c;this._connInnovations.set(f,d),this._connInnovations.set(m,d)}}function Vi(n,t){let e=this.options.maxNodes||1/0,i=Math.min(this.getMinimumHiddenSize(t),e-n.nodes.filter(l=>l.type!=="hidden").length),o=n.nodes.filter(l=>l.type==="input"),s=n.nodes.filter(l=>l.type==="output"),r=n.nodes.filter(l=>l.type==="hidden");if(o.length===0||s.length===0){try{console.warn("Network is missing input or output nodes \u2014 skipping minHidden enforcement")}catch{}return}let a=r.length;for(let l=a;l<i&&n.nodes.length<e;l++){let u=(Nt(),ct(ge)).default,h=new u("hidden");n.nodes.push(h),r.push(h)}for(let l of r){if(l.connections.in.length===0){let u=o.concat(r.filter(h=>h!==l));if(u.length>0){let h=this._getRNG(),d=u[Math.floor(h()*u.length)];try{n.connect(d,l)}catch{}}}if(l.connections.out.length===0){let u=s.concat(r.filter(h=>h!==l));if(u.length>0){let h=this._getRNG(),d=u[Math.floor(h()*u.length)];try{n.connect(l,d)}catch{}}}}(At(),ct($t)).default.rebuildConnections(n)}function Ki(n){let t=n.nodes.filter(r=>r.type==="input"),e=n.nodes.filter(r=>r.type==="output"),i=n.nodes.filter(r=>r.type==="hidden"),o=r=>r.connections&&r.connections.out&&r.connections.out.length>0,s=r=>r.connections&&r.connections.in&&r.connections.in.length>0;for(let r of t)if(!o(r)){let a=i.length>0?i:e;if(a.length>0){let c=this._getRNG(),l=a[Math.floor(c()*a.length)];try{n.connect(r,l)}catch{}}}for(let r of e)if(!s(r)){let a=i.length>0?i:t;if(a.length>0){let c=this._getRNG(),l=a[Math.floor(c()*a.length)];try{n.connect(l,r)}catch{}}}for(let r of i){if(!s(r)){let a=t.concat(i.filter(c=>c!==r));if(a.length>0){let c=this._getRNG(),l=a[Math.floor(c()*a.length)];try{n.connect(l,r)}catch{}}}if(!o(r)){let a=e.concat(i.filter(c=>c!==r));if(a.length>0){let c=this._getRNG(),l=a[Math.floor(c()*a.length)];try{n.connect(r,l)}catch{}}}}}function Xi(n,t=!0){var e,i,o,s,r,a;let c=(Mt(),ct(wt)),l=this.options.mutation===c.mutation.FFW,u=Array.isArray(this.options.mutation)&&this.options.mutation.length===1&&this.options.mutation[0]===c.mutation.FFW;if((l||u)&&t)return c.mutation.FFW;if(l)return c.mutation.FFW[Math.floor(this._getRNG()()*c.mutation.FFW.length)];if(u)return c.mutation.FFW[Math.floor(this._getRNG()()*c.mutation.FFW.length)];let h=this.options.mutation;if(t&&Array.isArray(h)&&h.length===c.mutation.FFW.length&&h.every((f,m)=>f&&f.name===c.mutation.FFW[m].name))return c.mutation.FFW;if(h.length===1&&Array.isArray(h[0])&&h[0].length&&(h=h[0]),!((e=this.options.phasedComplexity)===null||e===void 0)&&e.enabled&&this._phase){if(h=h.filter(f=>!!f),this._phase==="simplify"){let f=h.filter(m=>m&&m.name&&m.name.startsWith&&m.name.startsWith("SUB_"));f.length&&(h=[...h,...f])}else if(this._phase==="complexify"){let f=h.filter(m=>m&&m.name&&m.name.startsWith&&m.name.startsWith("ADD_"));f.length&&(h=[...h,...f])}}if(!((i=this.options.operatorAdaptation)===null||i===void 0)&&i.enabled){let f=(o=this.options.operatorAdaptation.boost)!==null&&o!==void 0?o:2,m=this._operatorStats,g=[];for(let w of h){g.push(w);let M=m.get(w.name);if(M&&M.attempts>5){let _=M.success/M.attempts;if(_>.55)for(let v=0;v<Math.min(f,Math.floor(_*f));v++)g.push(w)}}h=g}let d=h[Math.floor(this._getRNG()()*h.length)];if(d===c.mutation.ADD_GATE&&n.gates.length>=(this.options.maxGates||1/0)||d===c.mutation.ADD_NODE&&n.nodes.length>=(this.options.maxNodes||1/0)||d===c.mutation.ADD_CONN&&n.connections.length>=(this.options.maxConns||1/0))return null;if(!((s=this.options.operatorBandit)===null||s===void 0)&&s.enabled){let f=(r=this.options.operatorBandit.c)!==null&&r!==void 0?r:1.4,m=(a=this.options.operatorBandit.minAttempts)!==null&&a!==void 0?a:5,g=this._operatorStats;for(let v of h)g.has(v.name)||g.set(v.name,{success:0,attempts:0});let w=Array.from(g.values()).reduce((v,b)=>v+b.attempts,0)+1e-9,M=d,_=-1/0;for(let v of h){let b=g.get(v.name),A=b.attempts>0?b.success/b.attempts:0,p=b.attempts<m?1/0:f*Math.sqrt(Math.log(w)/(b.attempts+1e-9)),S=A+p;S>_&&(_=S,M=v)}d=M}return d===c.mutation.ADD_GATE&&n.gates.length>=(this.options.maxGates||1/0)||!this.options.allowRecurrent&&(d===c.mutation.ADD_BACK_CONN||d===c.mutation.ADD_SELF_CONN)?null:d}var Yi=Y(()=>{"use strict";Ft()});function Zi(n){var t;let e=this._getObjectives(),i=n.map(h=>e.map(d=>{try{return d.accessor(h)}catch{return 0}})),o=(h,d)=>{let f=!1;for(let m=0;m<h.length;m++)if((e[m].direction||"max")==="max"){if(h[m]<d[m])return!1;h[m]>d[m]&&(f=!0)}else{if(h[m]>d[m])return!1;h[m]<d[m]&&(f=!0)}return f},s=[],r=new Array(n.length).fill(0),a=n.map(()=>[]),c=[];for(let h=0;h<n.length;h++){for(let d=0;d<n.length;d++)h!==d&&(o(i[h],i[d])?a[h].push(d):o(i[d],i[h])&&r[h]++);r[h]===0&&c.push(h)}let l=c,u=0;for(;l.length;){let h=[];for(let d of l){n[d]._moRank=u;for(let f of a[d])r[f]--,r[f]===0&&h.push(f)}if(s.push(l.map(d=>n[d])),l=h,u++,u>50)break}for(let h of s)if(h.length!==0){for(let d of h)d._moCrowd=0;for(let d=0;d<e.length;d++){let f=h.slice().sort((M,_)=>{let v=e[d].accessor(M),b=e[d].accessor(_);return v-b});f[0]._moCrowd=1/0,f[f.length-1]._moCrowd=1/0;let m=e[d].accessor(f[0]),w=e[d].accessor(f[f.length-1])-m||1;for(let M=1;M<f.length-1;M++){let _=e[d].accessor(f[M-1]),v=e[d].accessor(f[M+1]);f[M]._moCrowd+=(v-_)/w}}}return!((t=this.options.multiObjective)===null||t===void 0)&&t.enabled&&(this._paretoArchive.push({generation:this.generation,fronts:s.slice(0,3).map(h=>h.map(d=>d._id))}),this._paretoArchive.length>100&&this._paretoArchive.shift()),s}var Qi=Y(()=>{"use strict"});var Ht={};vt(Ht,{applyAdaptiveMutation:()=>gr,applyAncestorUniqAdaptive:()=>mr,applyComplexityBudget:()=>dr,applyMinimalCriterionAdaptive:()=>fr,applyOperatorAdaptation:()=>_r,applyPhasedComplexity:()=>pr});function dr(){var n,t,e,i,o,s,r,a,c,l,u,h;if(!(!((n=this.options.complexityBudget)===null||n===void 0)&&n.enabled))return;let d=this.options.complexityBudget;if(d.mode==="adaptive"){this._cbHistory||(this._cbHistory=[]),this._cbHistory.push(((t=this.population[0])===null||t===void 0?void 0:t.score)||0);let f=(e=d.improvementWindow)!==null&&e!==void 0?e:10;this._cbHistory.length>f&&this._cbHistory.shift();let m=this._cbHistory,g=m.length>1?m[m.length-1]-m[0]:0,w=0;if(m.length>2){let S=m.length,x=0,y=0,N=0,k=0;for(let I=0;I<S;I++)x+=I,y+=m[I],N+=I*m[I],k+=I*I;let L=S*k-x*x||1;w=(S*N-x*y)/L}this._cbMaxNodes===void 0&&(this._cbMaxNodes=(i=d.maxNodesStart)!==null&&i!==void 0?i:this.input+this.output+2);let M=(o=d.increaseFactor)!==null&&o!==void 0?o:1.1,_=(s=d.stagnationFactor)!==null&&s!==void 0?s:.95,v=Math.min(2,Math.max(-2,w/(Math.abs(m[0])+1e-9))),b=M+.05*Math.max(0,v),A=_-.03*Math.max(0,-v),p=this._noveltyArchive.length>5?1:.9;g>0||w>0?this._cbMaxNodes=Math.min((r=d.maxNodesEnd)!==null&&r!==void 0?r:this._cbMaxNodes*4,Math.floor(this._cbMaxNodes*b*p)):m.length===f&&(this._cbMaxNodes=Math.max((a=d.minNodes)!==null&&a!==void 0?a:this.input+this.output+2,Math.floor(this._cbMaxNodes*A))),d.minNodes!==void 0&&(this._cbMaxNodes=Math.max(d.minNodes,this._cbMaxNodes)),this.options.maxNodes=this._cbMaxNodes,d.maxConnsStart&&(this._cbMaxConns===void 0&&(this._cbMaxConns=d.maxConnsStart),g>0||w>0?this._cbMaxConns=Math.min((c=d.maxConnsEnd)!==null&&c!==void 0?c:this._cbMaxConns*4,Math.floor(this._cbMaxConns*b*p)):m.length===f&&(this._cbMaxConns=Math.max(d.maxConnsStart,Math.floor(this._cbMaxConns*A))),this.options.maxConns=this._cbMaxConns)}else{let f=(l=d.maxNodesStart)!==null&&l!==void 0?l:this.input+this.output+2,m=(u=d.maxNodesEnd)!==null&&u!==void 0?u:f*4,g=(h=d.horizon)!==null&&h!==void 0?h:100,w=Math.min(1,this.generation/g);this.options.maxNodes=Math.floor(f+(m-f)*w)}}function pr(){var n,t,e;if(!(!((n=this.options.phasedComplexity)===null||n===void 0)&&n.enabled))return;let i=(t=this.options.phasedComplexity.phaseLength)!==null&&t!==void 0?t:10;this._phase||(this._phase=(e=this.options.phasedComplexity.initialPhase)!==null&&e!==void 0?e:"complexify",this._phaseStartGeneration=this.generation),this.generation-this._phaseStartGeneration>=i&&(this._phase=this._phase==="complexify"?"simplify":"complexify",this._phaseStartGeneration=this.generation)}function fr(){var n,t,e,i;if(!(!((n=this.options.minimalCriterionAdaptive)===null||n===void 0)&&n.enabled))return;let o=this.options.minimalCriterionAdaptive;this._mcThreshold===void 0&&(this._mcThreshold=(t=o.initialThreshold)!==null&&t!==void 0?t:0);let s=this.population.map(u=>u.score||0),r=s.filter(u=>u>=this._mcThreshold).length,a=s.length?r/s.length:0,c=(e=o.targetAcceptance)!==null&&e!==void 0?e:.5,l=(i=o.adjustRate)!==null&&i!==void 0?i:.1;a>c*1.05?this._mcThreshold*=1+l:a<c*.95&&(this._mcThreshold*=1-l);for(let u of this.population)(u.score||0)<this._mcThreshold&&(u.score=0)}function mr(){var n,t,e,i,o,s,r,a;if(!(!((n=this.options.ancestorUniqAdaptive)===null||n===void 0)&&n.enabled))return;let c=this.options.ancestorUniqAdaptive,l=(t=c.cooldown)!==null&&t!==void 0?t:5;if(this.generation-this._lastAncestorUniqAdjustGen<l)return;let u=(e=this._telemetry[this._telemetry.length-1])===null||e===void 0?void 0:e.lineage,h=u?u.ancestorUniq:void 0;if(typeof h!="number")return;let d=(i=c.lowThreshold)!==null&&i!==void 0?i:.25,f=(o=c.highThreshold)!==null&&o!==void 0?o:.55,m=(s=c.adjust)!==null&&s!==void 0?s:.01;if(c.mode==="epsilon"&&(!((a=(r=this.options.multiObjective)===null||r===void 0?void 0:r.adaptiveEpsilon)===null||a===void 0)&&a.enabled))h<d?(this.options.multiObjective.dominanceEpsilon=(this.options.multiObjective.dominanceEpsilon||0)+m,this._lastAncestorUniqAdjustGen=this.generation):h>f&&(this.options.multiObjective.dominanceEpsilon=Math.max(0,(this.options.multiObjective.dominanceEpsilon||0)-m),this._lastAncestorUniqAdjustGen=this.generation);else if(c.mode==="lineagePressure"){this.options.lineagePressure||(this.options.lineagePressure={enabled:!0,mode:"spread",strength:.01});let g=this.options.lineagePressure;h<d?(g.strength=(g.strength||.01)*1.15,g.mode="spread",this._lastAncestorUniqAdjustGen=this.generation):h>f&&(g.strength=(g.strength||.01)*.9,this._lastAncestorUniqAdjustGen=this.generation)}}function gr(){var n,t,e,i,o,s,r,a,c,l,u,h;if(!(!((n=this.options.adaptiveMutation)===null||n===void 0)&&n.enabled))return;let d=this.options.adaptiveMutation,f=(t=d.adaptEvery)!==null&&t!==void 0?t:1;if(!(f<=1||this.generation%f===0))return;let m=this.population.filter(x=>typeof x.score=="number");m.sort((x,y)=>(x.score||0)-(y.score||0));let g=Math.floor(m.length/2),w=m.slice(g),M=m.slice(0,g),_=((e=d.sigma)!==null&&e!==void 0?e:.05)*1.5,v=(i=d.minRate)!==null&&i!==void 0?i:.01,b=(o=d.maxRate)!==null&&o!==void 0?o:1,A=d.strategy||"twoTier",p=!1,S=!1;for(let x=0;x<this.population.length;x++){let y=this.population[x];if(y._mutRate===void 0)continue;let N=y._mutRate,k=this._getRNG()()*2-1;if(k*=_,A==="twoTier")w.length===0||M.length===0?k=x%2===0?Math.abs(k):-Math.abs(k):w.includes(y)?k=-Math.abs(k):M.includes(y)&&(k=Math.abs(k));else if(A==="exploreLow")k=M.includes(y)?Math.abs(k*1.5):-Math.abs(k*.5);else if(A==="anneal"){let L=Math.min(1,this.generation/(50+this.population.length));k*=1-L}if(N+=k,N<v&&(N=v),N>b&&(N=b),N>((s=this.options.adaptiveMutation.initialRate)!==null&&s!==void 0?s:.5)&&(p=!0),N<((r=this.options.adaptiveMutation.initialRate)!==null&&r!==void 0?r:.5)&&(S=!0),y._mutRate=N,d.adaptAmount){let L=(a=d.amountSigma)!==null&&a!==void 0?a:.25,I=(this._getRNG()()*2-1)*L;A==="twoTier"&&(w.length===0||M.length===0?I=x%2===0?Math.abs(I):-Math.abs(I):I=M.includes(y)?Math.abs(I):-Math.abs(I));let E=(c=y._mutAmount)!==null&&c!==void 0?c:this.options.mutationAmount||1;E+=I,E=Math.round(E);let T=(l=d.minAmount)!==null&&l!==void 0?l:1,P=(u=d.maxAmount)!==null&&u!==void 0?u:10;E<T&&(E=T),E>P&&(E=P),y._mutAmount=E}}if(A==="twoTier"&&!(p&&S)){let x=(h=this.options.adaptiveMutation.initialRate)!==null&&h!==void 0?h:.5,y=Math.floor(this.population.length/2);for(let N=0;N<this.population.length;N++){let k=this.population[N];k._mutRate!==void 0&&(N<y?k._mutRate=Math.min(k._mutRate+_,1):k._mutRate=Math.max(k._mutRate-_,.01))}}}function _r(){var n,t;if(!(!((n=this.options.operatorAdaptation)===null||n===void 0)&&n.enabled))return;let e=(t=this.options.operatorAdaptation.decay)!==null&&t!==void 0?t:.9;for(let[i,o]of this._operatorStats.entries())o.success*=e,o.attempts*=e,this._operatorStats.set(i,o)}var qt=Y(()=>{"use strict";Ft()});var ln={};vt(ln,{buildAnc:()=>to,computeAncestorUniqueness:()=>vr});function to(n){let t=new Set;if(!Array.isArray(n._parents))return t;let e=[];for(let i of n._parents)e.push({id:i,depth:1,genomeRef:this.population.find(o=>o._id===i)});for(;e.length;){let i=e.shift();if(!(i.depth>4)&&(i.id!=null&&t.add(i.id),i.genomeRef&&Array.isArray(i.genomeRef._parents)))for(let o of i.genomeRef._parents)e.push({id:o,depth:i.depth+1,genomeRef:this.population.find(s=>s._id===o)})}return t}function vr(){let n=to.bind(this),t=0,e=0,i=Math.min(yr,this.population.length*(this.population.length-1)/2);for(let s=0;s<i&&!(this.population.length<2);s++){let r=Math.floor(this._getRNG()()*this.population.length),a=Math.floor(this._getRNG()()*this.population.length);a===r&&(a=(a+1)%this.population.length);let c=n(this.population[r]),l=n(this.population[a]);if(c.size===0&&l.size===0)continue;let u=0;for(let f of c)l.has(f)&&u++;let h=c.size+l.size-u||1,d=1-u/h;e+=d,t++}return t?+(e/t).toFixed(3):0}var yr,hn=Y(()=>{"use strict";yr=30});var no={};vt(no,{applyTelemetrySelect:()=>eo,buildTelemetryEntry:()=>xr,computeDiversityStats:()=>wr,recordTelemetryEntry:()=>Mr,structuralEntropy:()=>br});function eo(n){if(!this._telemetrySelect||!this._telemetrySelect.size)return n;let t=this._telemetrySelect,e={gen:n.gen,best:n.best,species:n.species};for(let i of Object.keys(n))i in e||t.has(i)||delete n[i];return Object.assign(n,e)}function br(n){let t=n;if(t._entropyGen===this.generation&&typeof t._entropyVal=="number")return t._entropyVal;let e={};for(let r of n.nodes)e[r.geneId]=0;for(let r of n.connections)if(r.enabled){let a=r.from.geneId,c=r.to.geneId;e[a]!==void 0&&e[a]++,e[c]!==void 0&&e[c]++}let i={},o=n.nodes.length||1;for(let r in e){let a=e[r];i[a]=(i[a]||0)+1}let s=0;for(let r in i){let a=i[r]/o;a>0&&(s-=a*Math.log(a+1e-9))}return t._entropyGen=this.generation,t._entropyVal=s,s}function wr(){var n,t,e,i;if(!(!((n=this.options.diversityMetrics)===null||n===void 0)&&n.enabled))return;if(this.options.fastMode&&!this._fastModeTuned){let A=this.options.diversityMetrics;A&&(A.pairSample==null&&(A.pairSample=20),A.graphletSample==null&&(A.graphletSample=30)),!((t=this.options.novelty)===null||t===void 0)&&t.enabled&&this.options.novelty.k==null&&(this.options.novelty.k=5),this._fastModeTuned=!0}let o=(e=this.options.diversityMetrics.pairSample)!==null&&e!==void 0?e:40,s=(i=this.options.diversityMetrics.graphletSample)!==null&&i!==void 0?i:60,r=this.population,a=r.length,c=0,l=0,u=0;for(let A=0;A<o&&!(a<2);A++){let p=Math.floor(this._getRNG()()*a),S=Math.floor(this._getRNG()()*a);S===p&&(S=(S+1)%a);let x=this._compatibilityDistance(r[p],r[S]);c+=x,l+=x*x,u++}let h=u?c/u:0,d=u?Math.max(0,l/u-h*h):0,f=r.map(A=>this._structuralEntropy(A)),m=f.reduce((A,p)=>A+p,0)/(f.length||1),g=f.length?f.reduce((A,p)=>A+(p-m)*(p-m),0)/f.length:0,w=[0,0,0,0];for(let A=0;A<s;A++){let p=r[Math.floor(this._getRNG()()*a)];if(!p)break;if(p.nodes.length<3)continue;let S=new Set;for(;S.size<3;)S.add(Math.floor(this._getRNG()()*p.nodes.length));let x=Array.from(S).map(N=>p.nodes[N]),y=0;for(let N of p.connections)N.enabled&&x.includes(N.from)&&x.includes(N.to)&&y++;y>3&&(y=3),w[y]++}let M=w.reduce((A,p)=>A+p,0)||1,_=0;for(let A=0;A<w.length;A++){let p=w[A]/M;p>0&&(_-=p*Math.log(p))}let v=0,b=0;if(this._lineageEnabled&&a>0){let A=r.map(x=>{var y;return(y=x._depth)!==null&&y!==void 0?y:0});v=A.reduce((x,y)=>x+y,0)/a;let p=0,S=0;for(let x=0;x<Math.min(o,a*(a-1)/2)&&!(a<2);x++){let y=Math.floor(this._getRNG()()*a),N=Math.floor(this._getRNG()()*a);N===y&&(N=(N+1)%a),p+=Math.abs(A[y]-A[N]),S++}b=S?p/S:0}this._diversityStats={meanCompat:h,varCompat:d,meanEntropy:m,varEntropy:g,graphletEntropy:_,lineageMeanDepth:v,lineageMeanPairDist:b}}function Mr(n){var t;try{eo.call(this,n)}catch{}this._telemetry||(this._telemetry=[]),this._telemetry.push(n);try{!((t=this.options.telemetryStream)===null||t===void 0)&&t.enabled&&this.options.telemetryStream.onEntry&&this.options.telemetryStream.onEntry(n)}catch{}this._telemetry.length>500&&this._telemetry.shift()}function xr(n){var t,e,i,o,s,r,a,c,l,u,h,d,f,m,g,w,M,_;let v=this.generation,b=0;if(!((t=this.options.multiObjective)===null||t===void 0)&&t.enabled){let S=this.options.multiObjective.complexityMetric||"connections",x=this.population.map(E=>E.score||0),y=Math.min(...x),N=Math.max(...x),k=[];for(let E=0;E<5;E++){let T=this.population.filter(P=>{var R;return((R=P._moRank)!==null&&R!==void 0?R:0)===E}).length;if(!T)break;k.push(T)}for(let E of this.population){if(((e=E._moRank)!==null&&e!==void 0?e:0)!==0)continue;let P=N>y?((E.score||0)-y)/(N-y):0,R=S==="nodes"?E.nodes.length:E.connections.length;b+=P*(1/(R+1))}let L=Array.from(this._operatorStats.entries()).map(([E,T])=>({op:E,succ:T.success,att:T.attempts})),I={gen:v,best:n.score,species:this._species.length,hyper:b,fronts:k,diversity:this._diversityStats,ops:L};if(I.objImportance||(I.objImportance={}),this._lastObjImportance&&(I.objImportance=this._lastObjImportance),!((i=this._objectiveAges)===null||i===void 0)&&i.size&&(I.objAges=Array.from(this._objectiveAges.entries()).reduce((E,T)=>(E[T[0]]=T[1],E),{})),!((o=this._pendingObjectiveAdds)===null||o===void 0)&&o.length||!((s=this._pendingObjectiveRemoves)===null||s===void 0)&&s.length){I.objEvents=[];for(let E of this._pendingObjectiveAdds)I.objEvents.push({type:"add",key:E});for(let E of this._pendingObjectiveRemoves)I.objEvents.push({type:"remove",key:E});this._objectiveEvents.push(...I.objEvents.map(E=>({gen:v,type:E.type,key:E.key}))),this._pendingObjectiveAdds=[],this._pendingObjectiveRemoves=[]}this._lastOffspringAlloc&&(I.speciesAlloc=this._lastOffspringAlloc.slice());try{I.objectives=this._getObjectives().map(E=>E.key)}catch{}if(this.options.rngState&&this._rngState!==void 0&&(I.rng=this._rngState),this._lineageEnabled){let E=this.population[0],T=this.population.map($=>{var W;return(W=$._depth)!==null&&W!==void 0?W:0});this._lastMeanDepth=T.reduce(($,W)=>$+W,0)/(T.length||1);let{computeAncestorUniqueness:P}=(hn(),ct(ln)),R=P.call(this);I.lineage={parents:Array.isArray(E._parents)?E._parents.slice():[],depthBest:(r=E._depth)!==null&&r!==void 0?r:0,meanDepth:+this._lastMeanDepth.toFixed(2),inbreeding:this._prevInbreedingCount,ancestorUniq:R}}if(!((a=this.options.telemetry)===null||a===void 0)&&a.hypervolume&&(!((c=this.options.multiObjective)===null||c===void 0)&&c.enabled)&&(I.hv=+b.toFixed(4)),!((l=this.options.telemetry)===null||l===void 0)&&l.complexity){let E=this.population.map(tt=>tt.nodes.length),T=this.population.map(tt=>tt.connections.length),P=E.reduce((tt,F)=>tt+F,0)/(E.length||1),R=T.reduce((tt,F)=>tt+F,0)/(T.length||1),$=E.length?Math.max(...E):0,W=T.length?Math.max(...T):0,K=this.population.map(tt=>{let F=0,C=0;for(let j of tt.connections)j.enabled===!1?C++:F++;return F+C?F/(F+C):0}),B=K.reduce((tt,F)=>tt+F,0)/(K.length||1),Z=this._lastMeanNodes!==void 0?P-this._lastMeanNodes:0,G=this._lastMeanConns!==void 0?R-this._lastMeanConns:0;this._lastMeanNodes=P,this._lastMeanConns=R,I.complexity={meanNodes:+P.toFixed(2),meanConns:+R.toFixed(2),maxNodes:$,maxConns:W,meanEnabledRatio:+B.toFixed(3),growthNodes:+Z.toFixed(2),growthConns:+G.toFixed(2),budgetMaxNodes:this.options.maxNodes,budgetMaxConns:this.options.maxConns}}return!((u=this.options.telemetry)===null||u===void 0)&&u.performance&&(I.perf={evalMs:this._lastEvalDuration,evolveMs:this._lastEvolveDuration}),I}let A=Array.from(this._operatorStats.entries()).map(([S,x])=>({op:S,succ:x.success,att:x.attempts})),p={gen:v,best:n.score,species:this._species.length,hyper:b,diversity:this._diversityStats,ops:A,objImportance:{}};if(this._lastObjImportance&&(p.objImportance=this._lastObjImportance),!((h=this._objectiveAges)===null||h===void 0)&&h.size&&(p.objAges=Array.from(this._objectiveAges.entries()).reduce((S,x)=>(S[x[0]]=x[1],S),{})),!((d=this._pendingObjectiveAdds)===null||d===void 0)&&d.length||!((f=this._pendingObjectiveRemoves)===null||f===void 0)&&f.length){p.objEvents=[];for(let S of this._pendingObjectiveAdds)p.objEvents.push({type:"add",key:S});for(let S of this._pendingObjectiveRemoves)p.objEvents.push({type:"remove",key:S});this._objectiveEvents.push(...p.objEvents.map(S=>({gen:v,type:S.type,key:S.key}))),this._pendingObjectiveAdds=[],this._pendingObjectiveRemoves=[]}this._lastOffspringAlloc&&(p.speciesAlloc=this._lastOffspringAlloc.slice());try{p.objectives=this._getObjectives().map(S=>S.key)}catch{}if(this.options.rngState&&this._rngState!==void 0&&(p.rng=this._rngState),this._lineageEnabled){let S=this.population[0],x=this.population.map(E=>{var T;return(T=E._depth)!==null&&T!==void 0?T:0});this._lastMeanDepth=x.reduce((E,T)=>E+T,0)/(x.length||1);let{buildAnc:y}=(hn(),ct(ln)),N=0,k=0,L=Math.min(30,this.population.length*(this.population.length-1)/2);for(let E=0;E<L&&!(this.population.length<2);E++){let T=Math.floor(this._getRNG()()*this.population.length),P=Math.floor(this._getRNG()()*this.population.length);P===T&&(P=(P+1)%this.population.length);let R=y.call(this,this.population[T]),$=y.call(this,this.population[P]);if(R.size===0&&$.size===0)continue;let W=0;for(let Z of R)$.has(Z)&&W++;let K=R.size+$.size-W||1,B=1-W/K;k+=B,N++}let I=N?+(k/N).toFixed(3):0;p.lineage={parents:Array.isArray(S._parents)?S._parents.slice():[],depthBest:(m=S._depth)!==null&&m!==void 0?m:0,meanDepth:+this._lastMeanDepth.toFixed(2),inbreeding:this._prevInbreedingCount,ancestorUniq:I}}if(!((g=this.options.telemetry)===null||g===void 0)&&g.hypervolume&&(!((w=this.options.multiObjective)===null||w===void 0)&&w.enabled)&&(p.hv=+b.toFixed(4)),!((M=this.options.telemetry)===null||M===void 0)&&M.complexity){let S=this.population.map(R=>R.nodes.length),x=this.population.map(R=>R.connections.length),y=S.reduce((R,$)=>R+$,0)/(S.length||1),N=x.reduce((R,$)=>R+$,0)/(x.length||1),k=S.length?Math.max(...S):0,L=x.length?Math.max(...x):0,I=this.population.map(R=>{let $=0,W=0;for(let K of R.connections)K.enabled===!1?W++:$++;return $+W?$/($+W):0}),E=I.reduce((R,$)=>R+$,0)/(I.length||1),T=this._lastMeanNodes!==void 0?y-this._lastMeanNodes:0,P=this._lastMeanConns!==void 0?N-this._lastMeanConns:0;this._lastMeanNodes=y,this._lastMeanConns=N,p.complexity={meanNodes:+y.toFixed(2),meanConns:+N.toFixed(2),maxNodes:k,maxConns:L,meanEnabledRatio:+E.toFixed(3),growthNodes:+T.toFixed(2),growthConns:+P.toFixed(2),budgetMaxNodes:this.options.maxNodes,budgetMaxConns:this.options.maxConns}}return!((_=this.options.telemetry)===null||_===void 0)&&_.performance&&(p.perf={evalMs:this._lastEvalDuration,evolveMs:this._lastEvolveDuration}),p}var io=Y(()=>{"use strict";Ft()});var le={};vt(le,{applyAdaptivePruning:()=>Nr,applyEvolutionPruning:()=>Sr});function Sr(){let n=this.options.evolutionPruning;if(!n||this.generation<(n.startGeneration||0))return;let t=n.interval||1;if((this.generation-n.startGeneration)%t!==0)return;let e=n.rampGenerations||0,i=1;e>0&&(i=Math.min(1,Math.max(0,(this.generation-n.startGeneration)/e)));let o=(n.targetSparsity||0)*i;for(let s of this.population)s&&typeof s.pruneToSparsity=="function"&&s.pruneToSparsity(o,n.method||"magnitude")}function Nr(){var n,t,e,i;if(!(!((n=this.options.adaptivePruning)===null||n===void 0)&&n.enabled))return;let o=this.options.adaptivePruning;this._adaptivePruneLevel===void 0&&(this._adaptivePruneLevel=0);let s=o.metric||"connections",r=this.population.reduce((g,w)=>g+w.nodes.length,0)/(this.population.length||1),a=this.population.reduce((g,w)=>g+w.connections.length,0)/(this.population.length||1),c=s==="nodes"?r:a;this._adaptivePruneBaseline===void 0&&(this._adaptivePruneBaseline=c);let l=this._adaptivePruneBaseline,u=(t=o.targetSparsity)!==null&&t!==void 0?t:.5,h=l*(1-u),d=(e=o.tolerance)!==null&&e!==void 0?e:.05,f=(i=o.adjustRate)!==null&&i!==void 0?i:.02,m=(c-h)/(l||1);if(Math.abs(m)>d){this._adaptivePruneLevel=Math.max(0,Math.min(u,this._adaptivePruneLevel+f*(m>0?1:-1)));for(let g of this.population)typeof g.pruneToSparsity=="function"&&g.pruneToSparsity(this._adaptivePruneLevel,"magnitude")}}var he=Y(()=>{"use strict"});function oo(){return Ar(this,void 0,void 0,function*(){var n,t,e,i,o,s,r,a,c,l,u,h,d,f,m,g,w,M,_,v,b,A,p,S,x,y,N,k,L,I,E,T,P,R,$,W;let K=typeof performance<"u"&&performance.now?performance.now():Date.now();this.population[this.population.length-1].score===void 0&&(yield this.evaluate()),this._objectivesList=void 0;try{(qt(),ct(Ht)).applyComplexityBudget.call(this)}catch{}try{(qt(),ct(Ht)).applyPhasedComplexity.call(this)}catch{}this.sort();try{let O=(n=this.population[0])===null||n===void 0?void 0:n.score;typeof O=="number"&&(this._bestScoreLastGen===void 0||O>this._bestScoreLastGen)&&(this._bestScoreLastGen=O,this._lastGlobalImproveGeneration=this.generation)}catch{}try{(qt(),ct(Ht)).applyMinimalCriterionAdaptive.call(this)}catch{}try{this._computeDiversityStats&&this._computeDiversityStats()}catch{}if(!((t=this.options.multiObjective)===null||t===void 0)&&t.enabled){let O=this.population,q=Zi.call(this,O),et=this._getObjectives(),D=new Array(O.length).fill(0),X=et.map(Q=>O.map(z=>Q.accessor(z)));for(let Q of q){let z=Q.map(H=>this.population.indexOf(H));if(z.length<3){z.forEach(H=>D[H]=1/0);continue}for(let H=0;H<et.length;H++){let J=[...z].sort((ht,rt)=>X[H][ht]-X[H][rt]);D[J[0]]=1/0,D[J[J.length-1]]=1/0;let ot=X[H][J[0]],ft=X[H][J[J.length-1]];for(let ht=1;ht<J.length-1;ht++){let rt=X[H][J[ht-1]],nt=X[H][J[ht+1]],lt=ft-ot||1;D[J[ht]]+=(nt-rt)/lt}}}let U=new Map;for(let Q=0;Q<O.length;Q++)U.set(O[Q],Q);this.population.sort((Q,z)=>{var H,J;let ot=(H=Q._moRank)!==null&&H!==void 0?H:0,ft=(J=z._moRank)!==null&&J!==void 0?J:0;if(ot!==ft)return ot-ft;let ht=U.get(Q),rt=U.get(z);return D[rt]-D[ht]});for(let Q=0;Q<O.length;Q++)O[Q]._moCrowd=D[Q];if(q.length){let Q=q[0],z=Q.map(H=>{var J;return{id:(J=H._id)!==null&&J!==void 0?J:-1,score:H.score||0,nodes:H.nodes.length,connections:H.connections.length}});if(this._paretoArchive.push({gen:this.generation,size:Q.length,genomes:z}),this._paretoArchive.length>200&&this._paretoArchive.shift(),et.length){let H=Q.map(J=>{var ot;return{id:(ot=J._id)!==null&&ot!==void 0?ot:-1,values:et.map(ft=>ft.accessor(J))}});this._paretoObjectivesArchive.push({gen:this.generation,vectors:H}),this._paretoObjectivesArchive.length>200&&this._paretoObjectivesArchive.shift()}}if(!((i=(e=this.options.multiObjective)===null||e===void 0?void 0:e.adaptiveEpsilon)===null||i===void 0)&&i.enabled&&q.length){let Q=this.options.multiObjective.adaptiveEpsilon,z=(o=Q.targetFront)!==null&&o!==void 0?o:Math.max(3,Math.floor(Math.sqrt(this.population.length))),H=(s=Q.adjust)!==null&&s!==void 0?s:.002,J=(r=Q.min)!==null&&r!==void 0?r:0,ot=(a=Q.max)!==null&&a!==void 0?a:.5,ft=(c=Q.cooldown)!==null&&c!==void 0?c:2;if(this.generation-this._lastEpsilonAdjustGen>=ft){let ht=q[0].length,rt=this.options.multiObjective.dominanceEpsilon||0;ht>z*1.2?rt=Math.min(ot,rt+H):ht<z*.8&&(rt=Math.max(J,rt-H)),this.options.multiObjective.dominanceEpsilon=rt,this._lastEpsilonAdjustGen=this.generation}}if(!((u=(l=this.options.multiObjective)===null||l===void 0?void 0:l.pruneInactive)===null||u===void 0)&&u.enabled){let Q=this.options.multiObjective.pruneInactive,z=(h=Q.window)!==null&&h!==void 0?h:5,H=(d=Q.rangeEps)!==null&&d!==void 0?d:1e-6,J=new Set(["fitness","complexity",...Q.protect||[]]),ot=this._getObjectives(),ft={};for(let rt of ot){let nt=1/0,lt=-1/0;for(let bt of this.population){let Tt=rt.accessor(bt);Tt<nt&&(nt=Tt),Tt>lt&&(lt=Tt)}ft[rt.key]={min:nt,max:lt}}let ht=[];for(let rt of ot){if(J.has(rt.key))continue;let nt=ft[rt.key];if(nt.max-nt.min<H){let bt=(this._objectiveStale.get(rt.key)||0)+1;this._objectiveStale.set(rt.key,bt),bt>=z&&ht.push(rt.key)}else this._objectiveStale.set(rt.key,0)}ht.length&&(!((f=this.options.multiObjective)===null||f===void 0)&&f.objectives)&&(this.options.multiObjective.objectives=this.options.multiObjective.objectives.filter(rt=>!ht.includes(rt.key)),this._objectivesList=void 0)}}try{(qt(),ct(Ht)).applyAncestorUniqAdaptive.call(this)}catch{}if(this.options.speciation){try{this._speciate()}catch{}try{this._applyFitnessSharing()}catch{}try{let O=this.options;if(!((m=O.autoCompatTuning)===null||m===void 0)&&m.enabled){let q=(w=(g=O.autoCompatTuning.target)!==null&&g!==void 0?g:O.targetSpecies)!==null&&w!==void 0?w:Math.max(2,Math.round(Math.sqrt(this.population.length))),et=this._species.length||1,D=q-et,X=(M=O.autoCompatTuning.adjustRate)!==null&&M!==void 0?M:.01,U=(_=O.autoCompatTuning.minCoeff)!==null&&_!==void 0?_:.1,Q=(v=O.autoCompatTuning.maxCoeff)!==null&&v!==void 0?v:5,z=1-X*Math.sign(D);D===0&&(z=1+(this._getRNG()()-.5)*X*.5),O.excessCoeff=Math.min(Q,Math.max(U,O.excessCoeff*z)),O.disjointCoeff=Math.min(Q,Math.max(U,O.disjointCoeff*z))}}catch{}this.sort();try{!((b=this.options.speciesAllocation)===null||b===void 0)&&b.extendedHistory||(!this._speciesHistory||this._speciesHistory.length===0||this._speciesHistory[this._speciesHistory.length-1].generation!==this.generation)&&(this._speciesHistory.push({generation:this.generation,stats:this._species.map(O=>({id:O.id,size:O.members.length,best:O.bestScore,lastImproved:O.lastImproved}))}),this._speciesHistory.length>200&&this._speciesHistory.shift())}catch{}}let B=_t.fromJSON(this.population[0].toJSON());B.score=this.population[0].score,this._computeDiversityStats();try{let O=this._getObjectives().map(et=>et.key),q=(A=this.options.multiObjective)===null||A===void 0?void 0:A.dynamic;if(!((p=this.options.multiObjective)===null||p===void 0)&&p.enabled)if(q?.enabled){let et=(S=q.addComplexityAt)!==null&&S!==void 0?S:1/0,D=(x=q.addEntropyAt)!==null&&x!==void 0?x:1/0;if(this.generation+1>=et&&!O.includes("complexity")&&(this.registerObjective("complexity","min",X=>X.connections.length),this._pendingObjectiveAdds.push("complexity")),this.generation+1>=D&&!O.includes("entropy")&&(this.registerObjective("entropy","max",X=>this._structuralEntropy(X)),this._pendingObjectiveAdds.push("entropy")),O.includes("entropy")&&q.dropEntropyOnStagnation!=null){let X=q.dropEntropyOnStagnation;this.generation>=X&&!this._entropyDropped&&!((y=this.options.multiObjective)===null||y===void 0)&&y.objectives&&(this.options.multiObjective.objectives=this.options.multiObjective.objectives.filter(U=>U.key!=="entropy"),this._objectivesList=void 0,this._pendingObjectiveRemoves.push("entropy"),this._entropyDropped=this.generation)}else!O.includes("entropy")&&this._entropyDropped&&q.readdEntropyAfter!=null&&this.generation-this._entropyDropped>=q.readdEntropyAfter&&(this.registerObjective("entropy","max",X=>this._structuralEntropy(X)),this._pendingObjectiveAdds.push("entropy"),this._entropyDropped=void 0)}else this.options.multiObjective.autoEntropy&&this.generation>=3&&!O.includes("entropy")&&(this.registerObjective("entropy","max",D=>this._structuralEntropy(D)),this._pendingObjectiveAdds.push("entropy"));for(let et of O)this._objectiveAges.set(et,(this._objectiveAges.get(et)||0)+1);for(let et of this._pendingObjectiveAdds)this._objectiveAges.set(et,0)}catch{}try{let O=this.options.multiObjective;if(O?.enabled&&O.pruneInactive&&O.pruneInactive.enabled===!1){let q=this._getObjectives().map(et=>et.key);q.includes("fitness")&&q.length>1&&!this._fitnessSuppressedOnce&&(this._suppressFitnessObjective=!0,this._fitnessSuppressedOnce=!0,this._objectivesList=void 0)}}catch{}let Z=null;try{let O=this._getObjectives();if(O.length){Z={};let q=this.population;for(let et of O){let D=q.map(H=>et.accessor(H)),X=Math.min(...D),U=Math.max(...D),Q=D.reduce((H,J)=>H+J,0)/D.length,z=D.reduce((H,J)=>H+(J-Q)*(J-Q),0)/(D.length||1);Z[et.key]={range:U-X,var:z}}this._lastObjImportance=Z}}catch{}!((N=this.options.telemetry)===null||N===void 0)&&N.enabled;{let O=(io(),ct(no)),q=O.buildTelemetryEntry.call(this,B);O.recordTelemetryEntry.call(this,q)}((k=B.score)!==null&&k!==void 0?k:-1/0)>this._bestGlobalScore&&(this._bestGlobalScore=(L=B.score)!==null&&L!==void 0?L:-1/0,this._lastGlobalImproveGeneration=this.generation);let G=[],tt=Math.max(0,Math.min(this.options.elitism||0,this.population.length));for(let O=0;O<tt;O++){let q=this.population[O];q&&G.push(q)}let F=Math.max(0,this.options.popsize||0),C=Math.max(0,F-G.length),j=Math.max(0,Math.min(this.options.provenance||0,C));for(let O=0;O<j;O++)this.options.network?G.push(_t.fromJSON(this.options.network.toJSON())):G.push(new _t(this.input,this.output,{minHidden:this.options.minHidden}));if(this.options.speciation&&this._species.length>0){this._suppressTournamentError=!0;let O=F-G.length;if(O>0){let q=this.options.speciesAgeBonus||{},et=(I=q.youngThreshold)!==null&&I!==void 0?I:5,D=(E=q.youngMultiplier)!==null&&E!==void 0?E:1.3,X=(T=q.oldThreshold)!==null&&T!==void 0?T:30,U=(P=q.oldMultiplier)!==null&&P!==void 0?P:.7,Q=this._species.map(nt=>{let lt=nt.members.reduce((Tt,Xt)=>Tt+(Xt.score||0),0),bt=this.generation-nt.lastImproved;return bt<=et?lt*D:bt>=X?lt*U:lt}),z=Q.reduce((nt,lt)=>nt+lt,0)||1,H=($=(R=this.options.speciesAllocation)===null||R===void 0?void 0:R.minOffspring)!==null&&$!==void 0?$:1,J=this._species.map((nt,lt)=>Q[lt]/z*O),ot=J.map(nt=>Math.floor(nt));for(let nt=0;nt<ot.length;nt++)ot[nt]<H&&O>=this._species.length*H&&(ot[nt]=H);let ft=ot.reduce((nt,lt)=>nt+lt,0),ht=O-ft,rt=J.map((nt,lt)=>({i:lt,frac:nt-Math.floor(nt)}));rt.sort((nt,lt)=>lt.frac-nt.frac);for(let nt of rt){if(ht<=0)break;ot[nt.i]++,ht--}if(ht<0){let nt=ot.map((lt,bt)=>({i:bt,v:lt})).sort((lt,bt)=>bt.v-lt.v);for(let lt of nt){if(ht===0)break;ot[lt.i]>H&&(ot[lt.i]--,ht++)}}this._lastOffspringAlloc=this._species.map((nt,lt)=>({id:nt.id,alloc:ot[lt]||0})),this._prevInbreedingCount=this._lastInbreedingCount,this._lastInbreedingCount=0,ot.forEach((nt,lt)=>{var bt,Tt;if(nt<=0)return;let Xt=this._species[lt];this._sortSpeciesMembers(Xt);let de=Xt.members.slice(0,Math.max(1,Math.floor(Xt.members.length*(this.options.survivalThreshold||.5))));for(let Sn=0;Sn<nt;Sn++){let pe=de[Math.floor(this._getRNG()()*de.length)],Ut;if(this.options.crossSpeciesMatingProb&&this._species.length>1&&this._getRNG()()<(this.options.crossSpeciesMatingProb||0)){let Zt=lt,Le=0;for(;Zt===lt&&Le++<5;)Zt=Math.floor(this._getRNG()()*this._species.length);let Pe=this._species[Zt];this._sortSpeciesMembers(Pe);let Nn=Pe.members.slice(0,Math.max(1,Math.floor(Pe.members.length*(this.options.survivalThreshold||.5))));Ut=Nn[Math.floor(this._getRNG()()*Nn.length)]}else Ut=de[Math.floor(this._getRNG()()*de.length)];let Yt=_t.crossOver(pe,Ut,this.options.equal||!1);if(Yt._reenableProb=this.options.reenableProb,Yt._id=this._nextGenomeId++,this._lineageEnabled){Yt._parents=[pe._id,Ut._id];let Zt=(bt=pe._depth)!==null&&bt!==void 0?bt:0,Le=(Tt=Ut._depth)!==null&&Tt!==void 0?Tt:0;Yt._depth=1+Math.max(Zt,Le),pe._id===Ut._id&&this._lastInbreedingCount++}G.push(Yt)}}),this._suppressTournamentError=!1}}else{this._suppressTournamentError=!0;let O=Math.max(0,F-G.length);for(let q=0;q<O;q++)G.push(this.getOffspring());this._suppressTournamentError=!1}for(let O of G)O&&(this.ensureMinHiddenNodes(O),this.ensureNoDeadEnds(O));this.population=G;try{(he(),ct(le)).applyEvolutionPruning.call(this)}catch{}try{(he(),ct(le)).applyAdaptivePruning.call(this)}catch{}this.mutate();try{(qt(),ct(Ht)).applyAdaptiveMutation.call(this)}catch{}if(this.population.forEach(O=>{O._compatCache&&delete O._compatCache}),this.population.forEach(O=>O.score=void 0),this.generation++,this.options.speciation&&this._updateSpeciesStagnation(),(this.options.globalStagnationGenerations||0)>0&&this.generation-this._lastGlobalImproveGeneration>(this.options.globalStagnationGenerations||0)){let q=Math.max(this.options.elitism||0,Math.floor(this.population.length*.8));for(let et=q;et<this.population.length;et++){let D=new _t(this.input,this.output,{minHidden:this.options.minHidden});D.score=void 0,D._reenableProb=this.options.reenableProb,D._id=this._nextGenomeId++,this._lineageEnabled&&(D._parents=[],D._depth=0);try{if(this.ensureMinHiddenNodes(D),this.ensureNoDeadEnds(D),D.nodes.filter(U=>U.type==="hidden").length===0){let U=(Nt(),ct(ge)).default,Q=new U("hidden");D.nodes.splice(D.nodes.length-D.output,0,Q);let z=D.nodes.filter(J=>J.type==="input"),H=D.nodes.filter(J=>J.type==="output");if(z.length&&H.length){try{D.connect(z[0],Q,1)}catch{}try{D.connect(Q,H[0],1)}catch{}}}}catch{}this.population[et]=D}this._lastGlobalImproveGeneration=this.generation}if(this.options.reenableProb!==void 0){let O=0,q=0;for(let et of this.population)O+=et._reenableSuccess||0,q+=et._reenableAttempts||0,et._reenableSuccess=0,et._reenableAttempts=0;if(q>20){let X=O/q-.3;this.options.reenableProb=Math.min(.9,Math.max(.05,this.options.reenableProb-X*.1))}}try{(qt(),ct(Ht)).applyOperatorAdaptation.call(this)}catch{}let V=typeof performance<"u"&&performance.now?performance.now():Date.now();this._lastEvolveDuration=V-K;try{this._speciesHistory||(this._speciesHistory=[]),!((W=this.options.speciesAllocation)===null||W===void 0)&&W.extendedHistory||(this._speciesHistory.length===0||this._speciesHistory[this._speciesHistory.length-1].generation!==this.generation)&&(this._speciesHistory.push({generation:this.generation,stats:this._species.map(O=>({id:O.id,size:O.members.length,best:O.bestScore,lastImproved:O.lastImproved}))}),this._speciesHistory.length>200&&this._speciesHistory.shift())}catch{}return B})}var Ar,so=Y(()=>{"use strict";At();Qi();Ar=function(n,t,e,i){function o(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function a(u){try{l(i.next(u))}catch(h){r(h)}}function c(u){try{l(i.throw(u))}catch(h){r(h)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})}});function ro(){return Or(this,void 0,void 0,function*(){var n,t,e,i,o,s,r,a,c,l,u,h,d,f,m,g,w,M,_;let v=this.options||{};if(v.fitnessPopulation)v.clear&&this.population.forEach(b=>b.clear&&b.clear()),yield this.fitness(this.population);else for(let b of this.population){v.clear&&b.clear&&b.clear();let A=yield this.fitness(b);b.score=A}try{let b=v.novelty;if(b?.enabled&&typeof b.descriptor=="function"){let A=Math.max(1,b.k||3),p=(n=b.blendFactor)!==null&&n!==void 0?n:.3,S=this.population.map(y=>{try{return b.descriptor(y)||[]}catch{return[]}}),x=[];for(let y=0;y<S.length;y++){x[y]=[];for(let N=0;N<S.length;N++){if(y===N){x[y][N]=0;continue}let k=S[y],L=S[N],I=0,E=Math.min(k.length,L.length);for(let T=0;T<E;T++){let P=(k[T]||0)-(L[T]||0);I+=P*P}x[y][N]=Math.sqrt(I)}}for(let y=0;y<this.population.length;y++){let k=x[y].slice().sort((E,T)=>E-T).slice(1,A+1),L=k.length?k.reduce((E,T)=>E+T,0)/k.length:0;this.population[y]._novelty=L,typeof this.population[y].score=="number"&&(this.population[y].score=(1-p)*this.population[y].score+p*L),this._noveltyArchive||(this._noveltyArchive=[]);let I=(t=b.archiveAddThreshold)!==null&&t!==void 0?t:1/0;(b.archiveAddThreshold===0||L>I)&&this._noveltyArchive.length<200&&this._noveltyArchive.push({desc:S[y],novelty:L})}}}catch{}this._diversityStats||(this._diversityStats={});try{let b=v.entropySharingTuning;if(b?.enabled){let A=(e=b.targetEntropyVar)!==null&&e!==void 0?e:.2,p=(i=b.adjustRate)!==null&&i!==void 0?i:.1,S=(o=b.minSigma)!==null&&o!==void 0?o:.1,x=(s=b.maxSigma)!==null&&s!==void 0?s:10,y=this._diversityStats.varEntropy;if(typeof y=="number"){let N=(r=this.options.sharingSigma)!==null&&r!==void 0?r:0;y<A*.9?N=Math.max(S,N*(1-p)):y>A*1.1&&(N=Math.min(x,N*(1+p))),this.options.sharingSigma=N}}}catch{}try{let b=v.entropyCompatTuning;if(b?.enabled){let A=this._diversityStats.meanEntropy,p=(a=b.targetEntropy)!==null&&a!==void 0?a:.5,S=(c=b.deadband)!==null&&c!==void 0?c:.05,x=(l=b.adjustRate)!==null&&l!==void 0?l:.05,y=(u=this.options.compatibilityThreshold)!==null&&u!==void 0?u:3;typeof A=="number"&&(A<p-S?y=Math.max((h=b.minThreshold)!==null&&h!==void 0?h:.5,y*(1-x)):A>p+S&&(y=Math.min((d=b.maxThreshold)!==null&&d!==void 0?d:10,y*(1+x))),this.options.compatibilityThreshold=y)}}catch{}try{this.options.speciation&&(this.options.targetSpecies||this.options.compatAdjust||!((f=this.options.speciesAllocation)===null||f===void 0)&&f.extendedHistory)&&this._speciate()}catch{}try{let b=this.options.autoDistanceCoeffTuning;if(b?.enabled&&this.options.speciation){let A=this.population.map(k=>k.connections.length),p=A.reduce((k,L)=>k+L,0)/(A.length||1),S=A.reduce((k,L)=>k+(L-p)*(L-p),0)/(A.length||1),x=(m=b.adjustRate)!==null&&m!==void 0?m:.05,y=(g=b.minCoeff)!==null&&g!==void 0?g:.05,N=(w=b.maxCoeff)!==null&&w!==void 0?w:8;this._lastConnVar||(this._lastConnVar=S),S<this._lastConnVar*.95?(this.options.excessCoeff=Math.min(N,this.options.excessCoeff*(1+x)),this.options.disjointCoeff=Math.min(N,this.options.disjointCoeff*(1+x))):S>this._lastConnVar*1.05&&(this.options.excessCoeff=Math.max(y,this.options.excessCoeff*(1-x)),this.options.disjointCoeff=Math.max(y,this.options.disjointCoeff*(1-x))),this._lastConnVar=S}}catch{}try{!((M=this.options.multiObjective)===null||M===void 0)&&M.enabled&&this.options.multiObjective.autoEntropy&&(!((_=this.options.multiObjective.dynamic)===null||_===void 0)&&_.enabled||this._getObjectives().map(A=>A.key).includes("entropy")||(this.registerObjective("entropy","max",A=>this._structuralEntropy(A)),this._pendingObjectiveAdds.push("entropy"),this._objectivesList=void 0))}catch{}})}var Or,ao=Y(()=>{"use strict";Or=function(n,t,e,i){function o(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function a(u){try{l(i.next(u))}catch(h){r(h)}}function c(u){try{l(i.throw(u))}catch(h){r(h)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})}});function co(n,t=1){var e;let i=n.clone?n.clone():(At(),ct($t)).default.fromJSON(n.toJSON());i.score=void 0,i._reenableProb=this.options.reenableProb,i._id=this._nextGenomeId++,i._parents=[n._id],i._depth=((e=n._depth)!==null&&e!==void 0?e:0)+1,this.ensureMinHiddenNodes(i),this.ensureNoDeadEnds(i);for(let o=0;o<t;o++)try{let s=this.selectMutationMethod(i,!1);if(Array.isArray(s)){let r=s;s=r[Math.floor(this._getRNG()()*r.length)]}s&&s.name&&i.mutate(s)}catch{}return this._invalidateGenomeCaches(i),i}function lo(n,t){try{if(n.score=void 0,n._reenableProb=this.options.reenableProb,n._id=this._nextGenomeId++,n._parents=Array.isArray(t)?t.slice():[],n._depth=0,n._parents.length){let e=n._parents.map(i=>this.population.find(o=>o._id===i)).filter(Boolean).map(i=>{var o;return(o=i._depth)!==null&&o!==void 0?o:0});n._depth=e.length?Math.max(...e)+1:1}this.ensureMinHiddenNodes(n),this.ensureNoDeadEnds(n),this._invalidateGenomeCaches(n),this.population.push(n)}catch{this.population.push(n)}}function je(n){var t,e;try{this.population=[];let i=((t=this.options)===null||t===void 0?void 0:t.popsize)||50;for(let o=0;o<i;o++){let s=n?_t.fromJSON(n.toJSON()):new _t(this.input,this.output,{minHidden:(e=this.options)===null||e===void 0?void 0:e.minHidden});s.score=void 0;try{this.ensureNoDeadEnds(s)}catch{}s._reenableProb=this.options.reenableProb,s._id=this._nextGenomeId++,this._lineageEnabled&&(s._parents=[],s._depth=0),this.population.push(s)}}catch{}}var ho=Y(()=>{"use strict";At()});function uo(){var n;if(this._objectivesList)return this._objectivesList;let t=[];if(this._suppressFitnessObjective||t.push({key:"fitness",direction:"max",accessor:e=>e.score||0}),!((n=this.options.multiObjective)===null||n===void 0)&&n.enabled&&Array.isArray(this.options.multiObjective.objectives))for(let e of this.options.multiObjective.objectives)!e||!e.key||typeof e.accessor!="function"||t.push(e);return this._objectivesList=t,t}function po(n,t,e){this.options.multiObjective||(this.options.multiObjective={enabled:!0});let i=this.options.multiObjective;i.objectives||(i.objectives=[]),i.objectives=i.objectives.filter(o=>o.key!==n),i.objectives.push({key:n,direction:t,accessor:e}),this._objectivesList=void 0}function fo(){var n;!((n=this.options.multiObjective)===null||n===void 0)&&n.objectives&&(this.options.multiObjective.objectives=[]),this._objectivesList=void 0}var mo=Y(()=>{"use strict"});function un(n){let t=n.nodes.map(s=>s.connections.out.length),e=t.reduce((s,r)=>s+r,0)||1,i=t.map(s=>s/e).filter(s=>s>0),o=0;for(let s of i)o-=s*Math.log(s);return o}function Kt(n){return n.length?n.reduce((t,e)=>t+e,0)/n.length:0}function go(n){if(!n.length)return 0;let t=Kt(n);return Kt(n.map(e=>(e-t)*(e-t)))}function _o(n,t){if(!n.length)return;let e=[];for(let M of n)typeof M._depth=="number"&&e.push(M._depth);let i=Kt(e),o=0,s=0;for(let M=0;M<e.length&&M<30;M++)for(let _=M+1;_<e.length&&_<30;_++)o+=Math.abs(e[M]-e[_]),s++;let r=s?o/s:0,a=n.map(M=>M.nodes.length),c=n.map(M=>M.connections.length),l=Kt(a),u=Kt(c),h=go(a),d=go(c),f=0,m=0;for(let M=0;M<n.length&&M<25;M++)for(let _=M+1;_<n.length&&_<25;_++)f+=t._compatibilityDistance(n[M],n[_]),m++;let g=m?f/m:0,w=Kt(n.map(M=>un(M)));return{lineageMeanDepth:i,lineageMeanPairDist:r,meanNodes:l,meanConns:u,nodeVar:h,connVar:d,meanCompat:g,graphletEntropy:w,population:n.length}}var yo=Y(()=>{"use strict"});function vo(n){var t,e,i,o;let s=(e=(t=n.from)===null||t===void 0?void 0:t.index)!==null&&e!==void 0?e:0,r=(o=(i=n.to)===null||i===void 0?void 0:i.index)!==null&&o!==void 0?o:0;return s*1e5+r}function bo(n,t){(!this._compatCacheGen||this._compatCacheGen!==this.generation)&&(this._compatCacheGen=this.generation,this._compatDistCache=new Map);let e=n._id<t._id?`${n._id}|${t._id}`:`${t._id}|${n._id}`,i=this._compatDistCache;if(i.has(e))return i.get(e);let o=v=>{if(!v._compatCache){let b=v.connections.map(A=>{var p;return[(p=A.innovation)!==null&&p!==void 0?p:this._fallbackInnov(A),A.weight]});b.sort((A,p)=>A[0]-p[0]),v._compatCache=b}return v._compatCache},s=o(n),r=o(t),a=0,c=0,l=0,u=0,h=0,d=0,f=s.length?s[s.length-1][0]:0,m=r.length?r[r.length-1][0]:0;for(;a<s.length&&c<r.length;){let[v,b]=s[a],[A,p]=r[c];v===A?(l++,d+=Math.abs(b-p),a++,c++):v<A?(v>m?h++:u++,a++):(A>f?h++:u++,c++)}a<s.length&&(h+=s.length-a),c<r.length&&(h+=r.length-c);let g=Math.max(1,Math.max(s.length,r.length)),w=l?d/l:0,M=this.options,_=M.excessCoeff*h/g+M.disjointCoeff*u/g+M.weightDiffCoeff*w;return i.set(e,_),_}var wo=Y(()=>{"use strict"});function Mo(){var n,t,e,i,o,s,r,a,c,l;this._prevSpeciesMembers.clear();for(let h of this._species){let d=new Set;for(let f of h.members)d.add(f._id);this._prevSpeciesMembers.set(h.id,d)}this._species.forEach(h=>h.members=[]);for(let h of this.population){let d=!1;for(let f of this._species)if(this._compatibilityDistance(h,f.representative)<(this.options.compatibilityThreshold||3)){f.members.push(h),d=!0;break}if(!d){let f=this._nextSpeciesId++;this._species.push({id:f,members:[h],representative:h,lastImproved:this.generation,bestScore:h.score||-1/0}),this._speciesCreated.set(f,this.generation)}}this._species=this._species.filter(h=>h.members.length>0),this._species.forEach(h=>{h.representative=h.members[0]});let u=this.options.speciesAgeProtection||{grace:3,oldPenalty:.5};for(let h of this._species){let d=(n=this._speciesCreated.get(h.id))!==null&&n!==void 0?n:this.generation;if(this.generation-d>=((t=u.grace)!==null&&t!==void 0?t:3)*10){let m=(e=u.oldPenalty)!==null&&e!==void 0?e:.5;m<1&&h.members.forEach(g=>{typeof g.score=="number"&&(g.score*=m)})}}if(this.options.speciation&&(this.options.targetSpecies||0)>0){let h=this.options.targetSpecies,d=this._species.length,f=this.options.compatAdjust,g=2/(Math.max(1,f.smoothingWindow||1)+1);this._compatSpeciesEMA=this._compatSpeciesEMA===void 0?d:this._compatSpeciesEMA+g*(d-this._compatSpeciesEMA);let w=this._compatSpeciesEMA,M=h-w;this._compatIntegral=this._compatIntegral*(f.decay||.95)+M;let _=(f.kp||0)*M+(f.ki||0)*this._compatIntegral,v=(this.options.compatibilityThreshold||3)-_,b=f.minThreshold||.5,A=f.maxThreshold||10;v<b&&(v=b,this._compatIntegral=0),v>A&&(v=A,this._compatIntegral=0),this.options.compatibilityThreshold=v}if(!((i=this.options.autoCompatTuning)===null||i===void 0)&&i.enabled){let h=(s=(o=this.options.autoCompatTuning.target)!==null&&o!==void 0?o:this.options.targetSpecies)!==null&&s!==void 0?s:Math.max(2,Math.round(Math.sqrt(this.population.length))),d=this._species.length||1,f=h-d,m=(r=this.options.autoCompatTuning.adjustRate)!==null&&r!==void 0?r:.01,g=(a=this.options.autoCompatTuning.minCoeff)!==null&&a!==void 0?a:.1,w=(c=this.options.autoCompatTuning.maxCoeff)!==null&&c!==void 0?c:5,_=1-m*Math.sign(f);f===0&&(_=1+(this._getRNG()()-.5)*m*.5),this.options.excessCoeff=Math.min(w,Math.max(g,this.options.excessCoeff*_)),this.options.disjointCoeff=Math.min(w,Math.max(g,this.options.disjointCoeff*_))}if(!((l=this.options.speciesAllocation)===null||l===void 0)&&l.extendedHistory){let h=this._species.map(d=>{var f,m;let g=d.members.map(C=>({nodes:C.nodes.length,conns:C.connections.length,score:C.score||0,nov:C._novelty||0,ent:this._structuralEntropy(C)})),w=C=>C.length?C.reduce((j,V)=>j+V,0)/C.length:0,M=0,_=0;for(let C=0;C<d.members.length&&C<10;C++)for(let j=C+1;j<d.members.length&&j<10;j++)M+=this._compatibilityDistance(d.members[C],d.members[j]),_++;let v=_?M/_:0,b=this._speciesLastStats.get(d.id),A=w(g.map(C=>C.nodes)),p=w(g.map(C=>C.conns)),S=b?A-b.meanNodes:0,x=b?p-b.meanConns:0,y=b?d.bestScore-b.best:0,N=(f=this._speciesCreated.get(d.id))!==null&&f!==void 0?f:this.generation,k=this.generation-N,L=0,I=this._prevSpeciesMembers.get(d.id);if(I&&d.members.length){let C=0;for(let j of d.members)I.has(j._id)||C++;L=C/d.members.length}let E=C=>{if(!C.length)return 0;let j=w(C);return w(C.map(V=>(V-j)*(V-j)))},T=E(g.map(C=>C.nodes)),P=E(g.map(C=>C.conns)),R=0,$=0,W=-1/0,K=1/0,B=0,Z=0;for(let C of d.members)for(let j of C.connections){let V=(m=j.innovation)!==null&&m!==void 0?m:this._fallbackInnov(j);R+=V,$++,V>W&&(W=V),V<K&&(K=V),j.enabled===!1?Z++:B++}let G=$?R/$:0,tt=isFinite(W)&&isFinite(K)&&W>K?W-K:0,F=B+Z>0?B/(B+Z):0;return{id:d.id,size:d.members.length,best:d.bestScore,lastImproved:d.lastImproved,age:k,meanNodes:A,meanConns:p,meanScore:w(g.map(C=>C.score)),meanNovelty:w(g.map(C=>C.nov)),meanCompat:v,meanEntropy:w(g.map(C=>C.ent)),varNodes:T,varConns:P,deltaMeanNodes:S,deltaMeanConns:x,deltaBestScore:y,turnoverRate:L,meanInnovation:G,innovationRange:tt,enabledRatio:F}});for(let d of h)this._speciesLastStats.set(d.id,{meanNodes:d.meanNodes,meanConns:d.meanConns,best:d.best});this._speciesHistory.push({generation:this.generation,stats:h})}else this._speciesHistory.push({generation:this.generation,stats:this._species.map(h=>({id:h.id,size:h.members.length,best:h.bestScore,lastImproved:h.lastImproved}))});this._speciesHistory.length>200&&this._speciesHistory.shift()}function xo(){let n=this.options.sharingSigma||0;n>0?this._species.forEach(t=>{let e=t.members;for(let i=0;i<e.length;i++){let o=e[i];if(typeof o.score!="number")continue;let s=0;for(let r=0;r<e.length;r++){let a=e[r],c=i===r?0:this._compatibilityDistance(o,a);if(c<n){let l=c/n;s+=1-l*l}}s<=0&&(s=1),o.score=o.score/s}}):this._species.forEach(t=>{let e=t.members.length;t.members.forEach(i=>{typeof i.score=="number"&&(i.score=i.score/e)})})}function So(n){n.members.sort((t,e)=>(e.score||0)-(t.score||0))}function No(){let n=this.options.stagnationGenerations||15;this._species.forEach(e=>{this._sortSpeciesMembers(e);let i=e.members[0];(i.score||-1/0)>e.bestScore&&(e.bestScore=i.score||-1/0,e.lastImproved=this.generation)});let t=this._species.filter(e=>this.generation-e.lastImproved<=n);t.length&&(this._species=t)}var Ao=Y(()=>{"use strict"});function Oo(){return this._species.map(t=>({id:t.id,size:t.members.length,bestScore:t.bestScore,lastImproved:t.lastImproved}))}function Eo(){var n,t,e,i,o,s;let r=this._speciesHistory;if(!((t=(n=this.options)===null||n===void 0?void 0:n.speciesAllocation)===null||t===void 0)&&t.extendedHistory)for(let a of r)for(let c of a.stats){if("innovationRange"in c&&"enabledRatio"in c)continue;let l=this._species.find(u=>u.id===c.id);if(l&&l.members&&l.members.length){let u=-1/0,h=1/0,d=0,f=0;for(let m of l.members)for(let g of m.connections){let w=(s=(e=g.innovation)!==null&&e!==void 0?e:(o=(i=this)._fallbackInnov)===null||o===void 0?void 0:o.call(i,g))!==null&&s!==void 0?s:0;w>u&&(u=w),w<h&&(h=w),g.enabled===!1?f++:d++}c.innovationRange=isFinite(u)&&isFinite(h)&&u>h?u-h:0,c.enabledRatio=d+f?d/(d+f):0}}return r}var Co=Y(()=>{"use strict"});function Io(){return this._telemetry.map(n=>JSON.stringify(n)).join(`
`)}function To(n=500){let t=Array.isArray(this._telemetry)?this._telemetry.slice(-n):[];if(!t.length)return"";let e=Er(t),i=Cr(e),o=[i.join(",")];for(let s of t)o.push(Ir(s,i));return o.join(`
`)}function Er(n){let t=new Set,e=new Set,i=new Set,o=new Set,s=new Set,r=!1,a=!1,c=!1,l=!1,u=!1,h=!1;for(let d of n)Object.keys(d).forEach(f=>{f!=="complexity"&&f!=="perf"&&f!=="ops"&&f!==gn&&t.add(f)}),Array.isArray(d.fronts)&&t.add(gn),d.complexity&&Object.keys(d.complexity).forEach(f=>e.add(f)),d.perf&&Object.keys(d.perf).forEach(f=>i.add(f)),d.lineage&&Object.keys(d.lineage).forEach(f=>o.add(f)),d.diversity&&("lineageMeanDepth"in d.diversity&&s.add("lineageMeanDepth"),"lineageMeanPairDist"in d.diversity&&s.add("lineageMeanPairDist")),"rng"in d&&t.add("rng"),Array.isArray(d.ops)&&d.ops.length&&(r=!0),Array.isArray(d.objectives)&&(a=!0),d.objAges&&(c=!0),Array.isArray(d.speciesAlloc)&&(l=!0),Array.isArray(d.objEvents)&&d.objEvents.length&&(u=!0),d.objImportance&&(h=!0);return{baseKeys:t,complexityKeys:e,perfKeys:i,lineageKeys:o,diversityLineageKeys:s,includeOps:r,includeObjectives:a,includeObjAges:c,includeSpeciesAlloc:l,includeObjEvents:u,includeObjImportance:h}}function Cr(n){let t=[...n.baseKeys,...[...n.complexityKeys].map(e=>`${dn}${e}`),...[...n.perfKeys].map(e=>`${pn}${e}`),...[...n.lineageKeys].map(e=>`${fn}${e}`),...[...n.diversityLineageKeys].map(e=>`${mn}${e}`)];return n.includeOps&&t.push(Do),n.includeObjectives&&t.push(ko),n.includeObjAges&&t.push(jo),n.includeSpeciesAlloc&&t.push(Lo),n.includeObjEvents&&t.push(Po),n.includeObjImportance&&t.push(Ro),t}function Ir(n,t){let e=[];for(let i of t)switch(!0){case i.startsWith(dn):{let o=i.slice(dn.length);e.push(n.complexity&&o in n.complexity?JSON.stringify(n.complexity[o]):"");break}case i.startsWith(pn):{let o=i.slice(pn.length);e.push(n.perf&&o in n.perf?JSON.stringify(n.perf[o]):"");break}case i.startsWith(fn):{let o=i.slice(fn.length);e.push(n.lineage&&o in n.lineage?JSON.stringify(n.lineage[o]):"");break}case i.startsWith(mn):{let o=i.slice(mn.length);e.push(n.diversity&&o in n.diversity?JSON.stringify(n.diversity[o]):"");break}case i===gn:{e.push(Array.isArray(n.fronts)?JSON.stringify(n.fronts):"");break}case i===Do:{e.push(Array.isArray(n.ops)?JSON.stringify(n.ops):"");break}case i===ko:{e.push(Array.isArray(n.objectives)?JSON.stringify(n.objectives):"");break}case i===jo:{e.push(n.objAges?JSON.stringify(n.objAges):"");break}case i===Lo:{e.push(Array.isArray(n.speciesAlloc)?JSON.stringify(n.speciesAlloc):"");break}case i===Po:{e.push(Array.isArray(n.objEvents)?JSON.stringify(n.objEvents):"");break}case i===Ro:{e.push(n.objImportance?JSON.stringify(n.objImportance):"");break}default:{e.push(JSON.stringify(n[i]));break}}return e.join(",")}function Wo(n=200){if(Array.isArray(this._speciesHistory)||(this._speciesHistory=[]),!this._speciesHistory.length&&Array.isArray(this._species)&&this._species.length){let o=this._species.map(s=>{var r,a,c;return{id:(r=s.id)!==null&&r!==void 0?r:-1,size:Array.isArray(s.members)?s.members.length:0,best:(a=s.bestScore)!==null&&a!==void 0?a:0,lastImproved:(c=s.lastImproved)!==null&&c!==void 0?c:0}});this._speciesHistory.push({generation:this.generation||0,stats:o})}let t=this._speciesHistory.slice(-n);if(!t.length)return"generation,id,size,best,lastImproved";let e=new Set(["generation"]);for(let o of t)for(let s of o.stats)Object.keys(s).forEach(r=>e.add(r));let i=Array.from(e);return Dr(t,i)}function Dr(n,t){let e=[t.join(",")];for(let i of n)for(let o of i.stats){let s=[];for(let r of t){if(r===Tr){s.push(JSON.stringify(i.generation));continue}s.push(JSON.stringify(o[r]))}e.push(s.join(","))}return e.join(`
`)}var dn,pn,fn,mn,gn,Do,ko,jo,Lo,Po,Ro,Tr,Bo=Y(()=>{"use strict";dn="complexity.",pn="perf.",fn="lineage.",mn="diversity.",gn="fronts",Do="ops",ko="objectives",jo="objAges",Lo="speciesAlloc",Po="objEvents",Ro="objImportance";Tr="generation"});function Go(){this.population.sort((n,t)=>{var e,i;return((e=t.score)!==null&&e!==void 0?e:0)-((i=n.score)!==null&&i!==void 0?i:0)})}function Fo(){var n,t,e,i;let o=this.options.selection,s=o?.name,r=this._getRNG.bind(this),a=this.population;switch(s){case"POWER":((n=a[0])===null||n===void 0?void 0:n.score)!==void 0&&((t=a[1])===null||t===void 0?void 0:t.score)!==void 0&&a[0].score<a[1].score&&this.sort();let c=Math.floor(Math.pow(r()(),o.power||1)*a.length);return a[c];case"FITNESS_PROPORTIONATE":let l=0,u=0;a.forEach(w=>{var M,_;u=Math.min(u,(M=w.score)!==null&&M!==void 0?M:0),l+=(_=w.score)!==null&&_!==void 0?_:0});let h=Math.abs(u);l+=h*a.length;let d=r()()*l,f=0;for(let w of a)if(f+=((e=w.score)!==null&&e!==void 0?e:0)+h,d<f)return w;return a[Math.floor(r()()*a.length)];case"TOURNAMENT":if((o.size||2)>a.length){if(!this._suppressTournamentError)throw new Error("Tournament size must be less than population size.");return a[Math.floor(r()()*a.length)]}let m=o.size||2,g=[];for(let w=0;w<m;w++)g.push(a[Math.floor(r()()*a.length)]);g.sort((w,M)=>{var _,v;return((_=M.score)!==null&&_!==void 0?_:0)-((v=w.score)!==null&&v!==void 0?v:0)});for(let w=0;w<g.length;w++)if(r()()<((i=o.probability)!==null&&i!==void 0?i:.5)||w===g.length-1)return g[w];break;default:return a[0]}return a[0]}function $o(){var n,t;let e=this.population;return e[e.length-1].score===void 0&&this.evaluate(),e[1]&&((n=e[0].score)!==null&&n!==void 0?n:0)<((t=e[1].score)!==null&&t!==void 0?t:0)&&this.sort(),e[0]}function Ho(){let n=this.population;return n[n.length-1].score===void 0&&this.evaluate(),n.reduce((e,i)=>{var o;return e+((o=i.score)!==null&&o!==void 0?o:0)},0)/n.length}var qo=Y(()=>{"use strict"});var Uo={};vt(Uo,{exportPopulation:()=>_n,exportState:()=>vn,fromJSONImpl:()=>Mn,importPopulation:()=>yn,importStateImpl:()=>bn,toJSONImpl:()=>wn});function _n(){return this.population.map(n=>n.toJSON())}function yn(n){let t=(At(),ct($t)).default;this.population=n.map(e=>t.fromJSON(e)),this.options.popsize=this.population.length}function vn(){let{toJSONImpl:n,exportPopulation:t}=(xn(),ct(Uo));return{neat:n.call(this),population:t.call(this)}}function bn(n,t){if(!n||typeof n!="object")throw new Error("Invalid state bundle");let e=this.fromJSON(n.neat,t);return Array.isArray(n.population)&&e.import(n.population),e}function wn(){return{input:this.input,output:this.output,generation:this.generation,options:this.options,nodeSplitInnovations:Array.from(this._nodeSplitInnovations.entries()),connInnovations:Array.from(this._connInnovations.entries()),nextGlobalInnovation:this._nextGlobalInnovation}}function Mn(n,t){let e=this,i=new e(n.input,n.output,t,n.options||{});return i.generation=n.generation||0,Array.isArray(n.nodeSplitInnovations)&&(i._nodeSplitInnovations=new Map(n.nodeSplitInnovations)),Array.isArray(n.connInnovations)&&(i._connInnovations=new Map(n.connInnovations)),typeof n.nextGlobalInnovation=="number"&&(i._nextGlobalInnovation=n.nextGlobalInnovation),i}var xn=Y(()=>{"use strict"});var qi={};vt(qi,{default:()=>ue});var zo,ue,cn=Y(()=>{"use strict";At();Mt();Ge();Yi();so();ao();ho();mo();yo();wo();Ao();Co();Bo();qo();xn();zo=function(n,t,e,i){function o(s){return s instanceof e?s:new e(function(r){r(s)})}return new(e||(e=Promise))(function(s,r){function a(u){try{l(i.next(u))}catch(h){r(h)}}function c(u){try{l(i.throw(u))}catch(h){r(h)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((i=i.apply(n,t||[])).next())})},ue=class n{_getRNG(){var t;if(!this._rng){let e=(t=this.options)===null||t===void 0?void 0:t.rng;if(typeof e=="function")this._rng=e;else{if(this._rngState===void 0){let i=(Date.now()^(this.population.length+1)*2654435761)>>>0;i===0&&(i=439041101),this._rngState=i>>>0}this._rng=()=>{let i=this._rngState>>>0;return i^=i<<13,i>>>=0,i^=i>>17,i>>>=0,i^=i<<5,i>>>=0,this._rngState=i>>>0,(i>>>0)/4294967295}}}return this._rng}ensureMinHiddenNodes(t,e){return Vi.call(this,t,e)}constructor(t,e,i,o={}){var s,r,a,c;this.population=[],this.generation=0,this._species=[],this._operatorStats=new Map,this._nodeSplitInnovations=new Map,this._connInnovations=new Map,this._nextGlobalInnovation=1,this._nextGenomeId=1,this._lineageEnabled=!1,this._lastInbreedingCount=0,this._prevInbreedingCount=0,this._telemetry=[],this._prevSpeciesMembers=new Map,this._speciesLastStats=new Map,this._speciesHistory=[],this._paretoArchive=[],this._paretoObjectivesArchive=[],this._noveltyArchive=[],this._objectiveStale=new Map,this._objectiveAges=new Map,this._objectiveEvents=[],this._pendingObjectiveAdds=[],this._pendingObjectiveRemoves=[],this._lastGlobalImproveGeneration=0,this._speciesCreated=new Map,this._compatIntegral=0,this._lastEpsilonAdjustGen=-1/0,this._lastAncestorUniqAdjustGen=-1/0,this.input=t??0,this.output=e??0,this.fitness=i??(u=>0),this.options=o||{};let l=this.options;l.popsize===void 0&&(l.popsize=50),l.elitism===void 0&&(l.elitism=0),l.provenance===void 0&&(l.provenance=0),l.mutationRate===void 0&&(l.mutationRate=.7),l.mutationAmount===void 0&&(l.mutationAmount=1),l.fitnessPopulation===void 0&&(l.fitnessPopulation=!1),l.clear===void 0&&(l.clear=!1),l.equal===void 0&&(l.equal=!1),l.compatibilityThreshold===void 0&&(l.compatibilityThreshold=3),l.maxNodes===void 0&&(l.maxNodes=1/0),l.maxConns===void 0&&(l.maxConns=1/0),l.maxGates===void 0&&(l.maxGates=1/0),l.excessCoeff===void 0&&(l.excessCoeff=1),l.disjointCoeff===void 0&&(l.disjointCoeff=1),l.weightDiffCoeff===void 0&&(l.weightDiffCoeff=.5),l.mutation===void 0&&(l.mutation=it.ALL?it.ALL.slice():it.FFW?[it.FFW]:[]),l.selection===void 0&&(l.selection=Lt&&Lt.TOURNAMENT||((s=Lt)===null||s===void 0?void 0:s.TOURNAMENT)||Lt.FITNESS_PROPORTIONATE),l.crossover===void 0&&(l.crossover=ne?ne.SINGLE_POINT:void 0),l.novelty===void 0&&(l.novelty={enabled:!1}),l.diversityMetrics===void 0&&(l.diversityMetrics={enabled:!0}),l.fastMode&&l.diversityMetrics&&(l.diversityMetrics.pairSample==null&&(l.diversityMetrics.pairSample=20),l.diversityMetrics.graphletSample==null&&(l.diversityMetrics.graphletSample=30),!((r=l.novelty)===null||r===void 0)&&r.enabled&&l.novelty.k==null&&(l.novelty.k=5)),this._noveltyArchive=[],l.speciation===void 0&&(l.speciation=!1),l.multiObjective&&l.multiObjective.enabled&&!Array.isArray(l.multiObjective.objectives)&&(l.multiObjective.objectives=[]),this.population=this.population||[];try{this.options.network!==void 0?this.createPool(this.options.network):this.options.popsize&&this.createPool(null)}catch{}(!((a=this.options.lineage)===null||a===void 0)&&a.enabled||this.options.provenance>0)&&(this._lineageEnabled=!0),this.options.lineageTracking===!0&&(this._lineageEnabled=!0),!((c=o.lineagePressure)===null||c===void 0)&&c.enabled&&this._lineageEnabled!==!0&&(this._lineageEnabled=!0)}evolve(){return zo(this,void 0,void 0,function*(){return oo.call(this)})}evaluate(){return zo(this,void 0,void 0,function*(){return ro.call(this)})}createPool(t){try{if(je&&typeof je=="function")return je.call(this,t)}catch{}this.population=[];let e=this.options.popsize||50;for(let i=0;i<e;i++){let o=t?_t.fromJSON(t.toJSON()):new _t(this.input,this.output,{minHidden:this.options.minHidden});o.score=void 0;try{this.ensureNoDeadEnds(o)}catch{}o._reenableProb=this.options.reenableProb,o._id=this._nextGenomeId++,this._lineageEnabled&&(o._parents=[],o._depth=0),this.population.push(o)}}snapshotRNGState(){return this._rngState}restoreRNGState(t){this._rngState=t,this._rng=void 0}importRNGState(t){this._rngState=t,this._rng=void 0}exportRNGState(){return this._rngState}getOffspring(){var t,e;let i,o;try{i=this.getParent()}catch{i=this.population[0]}try{o=this.getParent()}catch{o=this.population[Math.floor(this._getRNG()()*this.population.length)]||this.population[0]}let s=_t.crossOver(i,o,this.options.equal||!1);if(s._reenableProb=this.options.reenableProb,s._id=this._nextGenomeId++,this._lineageEnabled){s._parents=[i._id,o._id];let r=(t=i._depth)!==null&&t!==void 0?t:0,a=(e=o._depth)!==null&&e!==void 0?e:0;s._depth=1+Math.max(r,a),i._id===o._id&&this._lastInbreedingCount++}return this.ensureMinHiddenNodes(s),this.ensureNoDeadEnds(s),s}_warnIfNoBestGenome(){try{console.warn("Evolution completed without finding a valid best genome (no fitness improvements recorded).")}catch{}}spawnFromParent(t,e=1){return co.call(this,t,e)}addGenome(t,e){return lo.call(this,t,e)}selectMutationMethod(t,e=!0){try{return Xi.call(this,t,e)}catch{return null}}ensureNoDeadEnds(t){try{return Ki.call(this,t)}catch{return}}getMinimumHiddenSize(t){let e=this.options;if(typeof e.minHidden=="number")return e.minHidden;let i=t??e.minHiddenMultiplier;return typeof i=="number"&&isFinite(i)?Math.max(0,Math.round(i*(this.input+this.output))):0}sampleRandom(t){let e=this._getRNG(),i=[];for(let o=0;o<t;o++)i.push(e());return i}_getObjectives(){return uo.call(this)}getObjectiveKeys(){return this._getObjectives().map(t=>t.key)}_invalidateGenomeCaches(t){!t||typeof t!="object"||(delete t._compatCache,delete t._outputCache,delete t._traceCache)}_computeDiversityStats(){this._diversityStats=_o(this.population,this)}_structuralEntropy(t){return un(t)}mutate(){return Ui.call(this)}_mutateAddNodeReuse(t){return zi.call(this,t)}_mutateAddConnReuse(t){return Ji.call(this,t)}_fallbackInnov(t){return vo.call(this,t)}_compatibilityDistance(t,e){return bo.call(this,t,e)}_speciate(){return Mo.call(this)}_applyFitnessSharing(){return xo.call(this)}_sortSpeciesMembers(t){return So.call(this,t)}_updateSpeciesStagnation(){return No.call(this)}getSpeciesStats(){return Oo.call(this)}getSpeciesHistory(){return Eo.call(this)}getNoveltyArchiveSize(){return this._noveltyArchive?this._noveltyArchive.length:0}getMultiObjectiveMetrics(){return this.population.map(t=>{var e,i;return{rank:(e=t._moRank)!==null&&e!==void 0?e:0,crowding:(i=t._moCrowd)!==null&&i!==void 0?i:0,score:t.score||0,nodes:t.nodes.length,connections:t.connections.length}})}getOperatorStats(){return Array.from(this._operatorStats.entries()).map(([t,e])=>({name:t,success:e.success,attempts:e.attempts}))}applyEvolutionPruning(){try{(he(),ct(le)).applyEvolutionPruning.call(this)}catch{}}applyAdaptivePruning(){try{(he(),ct(le)).applyAdaptivePruning.call(this)}catch{}}getTelemetry(){return this._telemetry}exportTelemetryJSONL(){return Io.call(this)}exportTelemetryCSV(t=500){return To.call(this,t)}clearTelemetry(){this._telemetry=[]}getObjectives(){return this._getObjectives().map(t=>({key:t.key,direction:t.direction}))}getObjectiveEvents(){return this._objectiveEvents.slice()}getLineageSnapshot(t=20){return this.population.slice(0,t).map(e=>{var i;return{id:(i=e._id)!==null&&i!==void 0?i:-1,parents:Array.isArray(e._parents)?e._parents.slice():[]}})}exportSpeciesHistoryCSV(t=200){return Wo.call(this,t)}getParetoFronts(t=3){var e;if(!(!((e=this.options.multiObjective)===null||e===void 0)&&e.enabled))return[[...this.population]];let i=[];for(let o=0;o<t;o++){let s=this.population.filter(r=>{var a;return((a=r._moRank)!==null&&a!==void 0?a:0)===o});if(!s.length)break;i.push(s)}return i}getDiversityStats(){return this._diversityStats}registerObjective(t,e,i){return po.call(this,t,e,i)}clearObjectives(){return fo.call(this)}getParetoArchive(t=50){return this._paretoArchive.slice(-t)}exportParetoFrontJSONL(t=100){return this._paretoObjectivesArchive.slice(-t).map(i=>JSON.stringify(i)).join(`
`)}getPerformanceStats(){return{lastEvalMs:this._lastEvalDuration,lastEvolveMs:this._lastEvolveDuration}}exportSpeciesHistoryJSONL(t=200){return this._speciesHistory.slice(-t).map(i=>JSON.stringify(i)).join(`
`)}resetNoveltyArchive(){this._noveltyArchive=[]}clearParetoArchive(){this._paretoArchive=[]}sort(){return Go.call(this)}getParent(){return Fo.call(this)}getFittest(){return $o.call(this)}getAverage(){return Ho.call(this)}export(){return _n.call(this)}import(t){return yn.call(this,t)}exportState(){return vn.call(this)}static importState(t,e){return bn.call(n,t,e)}toJSON(){return wn.call(this)}static fromJSON(t,e){return Mn.call(n,t,e)}}});cn();At();Nt();Jt();be();Bt();Nt();Jt();be();At();Mt();Bt();Mt();Dt();De();function kr(n){let t=performance.now(),e=Math.max(1,Math.floor(Math.sqrt(n))),i=Math.max(1,Math.ceil(n/e)),o=new _t(e,i);for(;o.connections.length>n;){let r=Math.floor(Math.random()*o.connections.length),a=o.connections[r];o.disconnect(a.from,a.to)}let s=performance.now();return{net:o,buildMs:s-t}}function jr(n,t){let e=new Array(n.input).fill(0).map(()=>Math.random()),i=performance.now();for(let r=0;r<t;r++)n.activate(e);let s=performance.now()-i;return{totalMs:s,avgMs:s/t}}function Lr(){let n=[1e3,1e4,5e4,1e5],t=[];for(let e of n){let{net:i,buildMs:o}=kr(e),s=e>=1e5?2:e>=5e4?3:5,{totalMs:r,avgMs:a}=jr(i,s);t.push({size:e,buildMs:Number(o.toFixed(3)),fwdAvgMs:Number(a.toFixed(4)),fwdTotalMs:Number(r.toFixed(3)),conn:i.connections.length,nodes:i.nodes.length,iterations:s})}return t}window.__NEATAPTIC_BENCH__={mode:window.__BENCH_MODE__||"__UNDEF__",generatedAt:new Date().toISOString(),results:Lr()};console.log("[NEATAPTIC_BROWSER_BENCH] ready");})();
